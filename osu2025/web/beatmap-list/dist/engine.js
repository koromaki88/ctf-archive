var Ha=Object.defineProperty;var Va=(n,e,t)=>e in n?Ha(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var m=(n,e,t)=>Va(n,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill.js";var Sr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sa(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function yr(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var oa={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(n,e){(function(t){n.exports=t()})(function(){return function t(i,a,s){function o(p,g){if(!a[p]){if(!i[p]){var h=typeof yr=="function"&&yr;if(!g&&h)return h(p,!0);if(l)return l(p,!0);var w=new Error("Cannot find module '"+p+"'");throw w.code="MODULE_NOT_FOUND",w}var d=a[p]={exports:{}};i[p][0].call(d.exports,function(S){var v=i[p][1][S];return o(v||S)},d,d.exports,t,i,a,s)}return a[p].exports}for(var l=typeof yr=="function"&&yr,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(t,i,a){(function(s){var o=s.MutationObserver||s.WebKitMutationObserver,l;if(o){var c=0,p=new o(S),g=s.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=c=++c%2}}else if(!s.setImmediate&&typeof s.MessageChannel<"u"){var h=new s.MessageChannel;h.port1.onmessage=S,l=function(){h.port2.postMessage(0)}}else"document"in s&&"onreadystatechange"in s.document.createElement("script")?l=function(){var y=s.document.createElement("script");y.onreadystatechange=function(){S(),y.onreadystatechange=null,y.parentNode.removeChild(y),y=null},s.document.documentElement.appendChild(y)}:l=function(){setTimeout(S,0)};var w,d=[];function S(){w=!0;for(var y,b,M=d.length;M;){for(b=d,d=[],y=-1;++y<M;)b[y]();M=d.length}w=!1}i.exports=v;function v(y){d.push(y)===1&&!w&&l()}}).call(this,typeof Sr<"u"?Sr:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(t,i,a){var s=t(1);function o(){}var l={},c=["REJECTED"],p=["FULFILLED"],g=["PENDING"];i.exports=h;function h(x){if(typeof x!="function")throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,x!==o&&v(this,x)}h.prototype.catch=function(x){return this.then(null,x)},h.prototype.then=function(x,W){if(typeof x!="function"&&this.state===p||typeof W!="function"&&this.state===c)return this;var H=new this.constructor(o);if(this.state!==g){var K=this.state===p?x:W;d(H,K,this.outcome)}else this.queue.push(new w(H,x,W));return H};function w(x,W,H){this.promise=x,typeof W=="function"&&(this.onFulfilled=W,this.callFulfilled=this.otherCallFulfilled),typeof H=="function"&&(this.onRejected=H,this.callRejected=this.otherCallRejected)}w.prototype.callFulfilled=function(x){l.resolve(this.promise,x)},w.prototype.otherCallFulfilled=function(x){d(this.promise,this.onFulfilled,x)},w.prototype.callRejected=function(x){l.reject(this.promise,x)},w.prototype.otherCallRejected=function(x){d(this.promise,this.onRejected,x)};function d(x,W,H){s(function(){var K;try{K=W(H)}catch(G){return l.reject(x,G)}K===x?l.reject(x,new TypeError("Cannot resolve promise with itself")):l.resolve(x,K)})}l.resolve=function(x,W){var H=y(S,W);if(H.status==="error")return l.reject(x,H.value);var K=H.value;if(K)v(x,K);else{x.state=p,x.outcome=W;for(var G=-1,ee=x.queue.length;++G<ee;)x.queue[G].callFulfilled(W)}return x},l.reject=function(x,W){x.state=c,x.outcome=W;for(var H=-1,K=x.queue.length;++H<K;)x.queue[H].callRejected(W);return x};function S(x){var W=x&&x.then;if(x&&(typeof x=="object"||typeof x=="function")&&typeof W=="function")return function(){W.apply(x,arguments)}}function v(x,W){var H=!1;function K(B){H||(H=!0,l.reject(x,B))}function G(B){H||(H=!0,l.resolve(x,B))}function ee(){W(G,K)}var _e=y(ee);_e.status==="error"&&K(_e.value)}function y(x,W){var H={};try{H.value=x(W),H.status="success"}catch(K){H.status="error",H.value=K}return H}h.resolve=b;function b(x){return x instanceof this?x:l.resolve(new this(o),x)}h.reject=M;function M(x){var W=new this(o);return l.reject(W,x)}h.all=L;function L(x){var W=this;if(Object.prototype.toString.call(x)!=="[object Array]")return this.reject(new TypeError("must be an array"));var H=x.length,K=!1;if(!H)return this.resolve([]);for(var G=new Array(H),ee=0,_e=-1,B=new this(o);++_e<H;)q(x[_e],_e);return B;function q(_,$){W.resolve(_).then(Me,function(ie){K||(K=!0,l.reject(B,ie))});function Me(ie){G[$]=ie,++ee===H&&!K&&(K=!0,l.resolve(B,G))}}}h.race=z;function z(x){var W=this;if(Object.prototype.toString.call(x)!=="[object Array]")return this.reject(new TypeError("must be an array"));var H=x.length,K=!1;if(!H)return this.resolve([]);for(var G=-1,ee=new this(o);++G<H;)_e(x[G]);return ee;function _e(B){W.resolve(B).then(function(q){K||(K=!0,l.resolve(ee,q))},function(q){K||(K=!0,l.reject(ee,q))})}}},{1:1}],3:[function(t,i,a){(function(s){typeof s.Promise!="function"&&(s.Promise=t(2))}).call(this,typeof Sr<"u"?Sr:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(t,i,a){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P};function o(P,R){if(!(P instanceof R))throw new TypeError("Cannot call a class as a function")}function l(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var c=l();function p(){try{if(!c||!c.open)return!1;var P=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),R=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!P||R)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function g(P,R){P=P||[],R=R||{};try{return new Blob(P,R)}catch(F){if(F.name!=="TypeError")throw F;for(var T=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,N=new T,j=0;j<P.length;j+=1)N.append(P[j]);return N.getBlob(R.type)}}typeof Promise>"u"&&t(3);var h=Promise;function w(P,R){R&&P.then(function(T){R(null,T)},function(T){R(T)})}function d(P,R,T){typeof R=="function"&&P.then(R),typeof T=="function"&&P.catch(T)}function S(P){return typeof P!="string"&&(console.warn(P+" used as a key, but it is not a string."),P=String(P)),P}function v(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var y="local-forage-detect-blob-support",b=void 0,M={},L=Object.prototype.toString,z="readonly",x="readwrite";function W(P){for(var R=P.length,T=new ArrayBuffer(R),N=new Uint8Array(T),j=0;j<R;j++)N[j]=P.charCodeAt(j);return T}function H(P){return new h(function(R){var T=P.transaction(y,x),N=g([""]);T.objectStore(y).put(N,"key"),T.onabort=function(j){j.preventDefault(),j.stopPropagation(),R(!1)},T.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),F=navigator.userAgent.match(/Edge\//);R(F||!j||parseInt(j[1],10)>=43)}}).catch(function(){return!1})}function K(P){return typeof b=="boolean"?h.resolve(b):H(P).then(function(R){return b=R,b})}function G(P){var R=M[P.name],T={};T.promise=new h(function(N,j){T.resolve=N,T.reject=j}),R.deferredOperations.push(T),R.dbReady?R.dbReady=R.dbReady.then(function(){return T.promise}):R.dbReady=T.promise}function ee(P){var R=M[P.name],T=R.deferredOperations.pop();if(T)return T.resolve(),T.promise}function _e(P,R){var T=M[P.name],N=T.deferredOperations.pop();if(N)return N.reject(R),N.promise}function B(P,R){return new h(function(T,N){if(M[P.name]=M[P.name]||X(),P.db)if(R)G(P),P.db.close();else return T(P.db);var j=[P.name];R&&j.push(P.version);var F=c.open.apply(c,j);R&&(F.onupgradeneeded=function(C){var ne=F.result;try{ne.createObjectStore(P.storeName),C.oldVersion<=1&&ne.createObjectStore(y)}catch(oe){if(oe.name==="ConstraintError")console.warn('The database "'+P.name+'" has been upgraded from version '+C.oldVersion+" to version "+C.newVersion+', but the storage "'+P.storeName+'" already exists.');else throw oe}}),F.onerror=function(C){C.preventDefault(),N(F.error)},F.onsuccess=function(){var C=F.result;C.onversionchange=function(ne){ne.target.close()},T(C),ee(P)}})}function q(P){return B(P,!1)}function _(P){return B(P,!0)}function $(P,R){if(!P.db)return!0;var T=!P.db.objectStoreNames.contains(P.storeName),N=P.version<P.db.version,j=P.version>P.db.version;if(N&&(P.version!==R&&console.warn('The database "'+P.name+`" can't be downgraded from version `+P.db.version+" to version "+P.version+"."),P.version=P.db.version),j||T){if(T){var F=P.db.version+1;F>P.version&&(P.version=F)}return!0}return!1}function Me(P){return new h(function(R,T){var N=new FileReader;N.onerror=T,N.onloadend=function(j){var F=btoa(j.target.result||"");R({__local_forage_encoded_blob:!0,data:F,type:P.type})},N.readAsBinaryString(P)})}function ie(P){var R=W(atob(P.data));return g([R],{type:P.type})}function xe(P){return P&&P.__local_forage_encoded_blob}function le(P){var R=this,T=R._initReady().then(function(){var N=M[R._dbInfo.name];if(N&&N.dbReady)return N.dbReady});return d(T,P,P),T}function Te(P){G(P);for(var R=M[P.name],T=R.forages,N=0;N<T.length;N++){var j=T[N];j._dbInfo.db&&(j._dbInfo.db.close(),j._dbInfo.db=null)}return P.db=null,q(P).then(function(F){return P.db=F,$(P)?_(P):F}).then(function(F){P.db=R.db=F;for(var C=0;C<T.length;C++)T[C]._dbInfo.db=F}).catch(function(F){throw _e(P,F),F})}function Y(P,R,T,N){N===void 0&&(N=1);try{var j=P.db.transaction(P.storeName,R);T(null,j)}catch(F){if(N>0&&(!P.db||F.name==="InvalidStateError"||F.name==="NotFoundError"))return h.resolve().then(function(){if(!P.db||F.name==="NotFoundError"&&!P.db.objectStoreNames.contains(P.storeName)&&P.version<=P.db.version)return P.db&&(P.version=P.db.version+1),_(P)}).then(function(){return Te(P).then(function(){Y(P,R,T,N-1)})}).catch(T);T(F)}}function X(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function ve(P){var R=this,T={db:null};if(P)for(var N in P)T[N]=P[N];var j=M[T.name];j||(j=X(),M[T.name]=j),j.forages.push(R),R._initReady||(R._initReady=R.ready,R.ready=le);var F=[];function C(){return h.resolve()}for(var ne=0;ne<j.forages.length;ne++){var oe=j.forages[ne];oe!==R&&F.push(oe._initReady().catch(C))}var ue=j.forages.slice(0);return h.all(F).then(function(){return T.db=j.db,q(T)}).then(function(he){return T.db=he,$(T,R._defaultConfig.version)?_(T):he}).then(function(he){T.db=j.db=he,R._dbInfo=T;for(var be=0;be<ue.length;be++){var De=ue[be];De!==R&&(De._dbInfo.db=T.db,De._dbInfo.version=T.version)}})}function me(P,R){var T=this;P=S(P);var N=new h(function(j,F){T.ready().then(function(){Y(T._dbInfo,z,function(C,ne){if(C)return F(C);try{var oe=ne.objectStore(T._dbInfo.storeName),ue=oe.get(P);ue.onsuccess=function(){var he=ue.result;he===void 0&&(he=null),xe(he)&&(he=ie(he)),j(he)},ue.onerror=function(){F(ue.error)}}catch(he){F(he)}})}).catch(F)});return w(N,R),N}function fe(P,R){var T=this,N=new h(function(j,F){T.ready().then(function(){Y(T._dbInfo,z,function(C,ne){if(C)return F(C);try{var oe=ne.objectStore(T._dbInfo.storeName),ue=oe.openCursor(),he=1;ue.onsuccess=function(){var be=ue.result;if(be){var De=be.value;xe(De)&&(De=ie(De));var ze=P(De,be.key,he++);ze!==void 0?j(ze):be.continue()}else j()},ue.onerror=function(){F(ue.error)}}catch(be){F(be)}})}).catch(F)});return w(N,R),N}function Ce(P,R,T){var N=this;P=S(P);var j=new h(function(F,C){var ne;N.ready().then(function(){return ne=N._dbInfo,L.call(R)==="[object Blob]"?K(ne.db).then(function(oe){return oe?R:Me(R)}):R}).then(function(oe){Y(N._dbInfo,x,function(ue,he){if(ue)return C(ue);try{var be=he.objectStore(N._dbInfo.storeName);oe===null&&(oe=void 0);var De=be.put(oe,P);he.oncomplete=function(){oe===void 0&&(oe=null),F(oe)},he.onabort=he.onerror=function(){var ze=De.error?De.error:De.transaction.error;C(ze)}}catch(ze){C(ze)}})}).catch(C)});return w(j,T),j}function lt(P,R){var T=this;P=S(P);var N=new h(function(j,F){T.ready().then(function(){Y(T._dbInfo,x,function(C,ne){if(C)return F(C);try{var oe=ne.objectStore(T._dbInfo.storeName),ue=oe.delete(P);ne.oncomplete=function(){j()},ne.onerror=function(){F(ue.error)},ne.onabort=function(){var he=ue.error?ue.error:ue.transaction.error;F(he)}}catch(he){F(he)}})}).catch(F)});return w(N,R),N}function Be(P){var R=this,T=new h(function(N,j){R.ready().then(function(){Y(R._dbInfo,x,function(F,C){if(F)return j(F);try{var ne=C.objectStore(R._dbInfo.storeName),oe=ne.clear();C.oncomplete=function(){N()},C.onabort=C.onerror=function(){var ue=oe.error?oe.error:oe.transaction.error;j(ue)}}catch(ue){j(ue)}})}).catch(j)});return w(T,P),T}function Ne(P){var R=this,T=new h(function(N,j){R.ready().then(function(){Y(R._dbInfo,z,function(F,C){if(F)return j(F);try{var ne=C.objectStore(R._dbInfo.storeName),oe=ne.count();oe.onsuccess=function(){N(oe.result)},oe.onerror=function(){j(oe.error)}}catch(ue){j(ue)}})}).catch(j)});return w(T,P),T}function $e(P,R){var T=this,N=new h(function(j,F){if(P<0){j(null);return}T.ready().then(function(){Y(T._dbInfo,z,function(C,ne){if(C)return F(C);try{var oe=ne.objectStore(T._dbInfo.storeName),ue=!1,he=oe.openKeyCursor();he.onsuccess=function(){var be=he.result;if(!be){j(null);return}P===0||ue?j(be.key):(ue=!0,be.advance(P))},he.onerror=function(){F(he.error)}}catch(be){F(be)}})}).catch(F)});return w(N,R),N}function et(P){var R=this,T=new h(function(N,j){R.ready().then(function(){Y(R._dbInfo,z,function(F,C){if(F)return j(F);try{var ne=C.objectStore(R._dbInfo.storeName),oe=ne.openKeyCursor(),ue=[];oe.onsuccess=function(){var he=oe.result;if(!he){N(ue);return}ue.push(he.key),he.continue()},oe.onerror=function(){j(oe.error)}}catch(he){j(he)}})}).catch(j)});return w(T,P),T}function Tt(P,R){R=v.apply(this,arguments);var T=this.config();P=typeof P!="function"&&P||{},P.name||(P.name=P.name||T.name,P.storeName=P.storeName||T.storeName);var N=this,j;if(!P.name)j=h.reject("Invalid arguments");else{var F=P.name===T.name&&N._dbInfo.db,C=F?h.resolve(N._dbInfo.db):q(P).then(function(ne){var oe=M[P.name],ue=oe.forages;oe.db=ne;for(var he=0;he<ue.length;he++)ue[he]._dbInfo.db=ne;return ne});P.storeName?j=C.then(function(ne){if(ne.objectStoreNames.contains(P.storeName)){var oe=ne.version+1;G(P);var ue=M[P.name],he=ue.forages;ne.close();for(var be=0;be<he.length;be++){var De=he[be];De._dbInfo.db=null,De._dbInfo.version=oe}var ze=new h(function(je,st){var it=c.open(P.name,oe);it.onerror=function(Et){var ct=it.result;ct.close(),st(Et)},it.onupgradeneeded=function(){var Et=it.result;Et.deleteObjectStore(P.storeName)},it.onsuccess=function(){var Et=it.result;Et.close(),je(Et)}});return ze.then(function(je){ue.db=je;for(var st=0;st<he.length;st++){var it=he[st];it._dbInfo.db=je,ee(it._dbInfo)}}).catch(function(je){throw(_e(P,je)||h.resolve()).catch(function(){}),je})}}):j=C.then(function(ne){G(P);var oe=M[P.name],ue=oe.forages;ne.close();for(var he=0;he<ue.length;he++){var be=ue[he];be._dbInfo.db=null}var De=new h(function(ze,je){var st=c.deleteDatabase(P.name);st.onerror=function(){var it=st.result;it&&it.close(),je(st.error)},st.onblocked=function(){console.warn('dropInstance blocked for database "'+P.name+'" until all open connections are closed')},st.onsuccess=function(){var it=st.result;it&&it.close(),ze(it)}});return De.then(function(ze){oe.db=ze;for(var je=0;je<ue.length;je++){var st=ue[je];ee(st._dbInfo)}}).catch(function(ze){throw(_e(P,ze)||h.resolve()).catch(function(){}),ze})})}return w(j,R),j}var kt={_driver:"asyncStorage",_initStorage:ve,_support:p(),iterate:fe,getItem:me,setItem:Ce,removeItem:lt,clear:Be,length:Ne,key:$e,keys:et,dropInstance:Tt};function f(){return typeof openDatabase=="function"}var Q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Z="~~local_forage_type~",D=/^~~local_forage_type~([^~]+)~/,E="__lfsc__:",U=E.length,te="arbf",re="blob",V="si08",ce="ui08",pe="uic8",se="si16",we="si32",Xe="ur16",Ae="ui32",_t="fl32",Kt="fl64",Mt=U+te.length,qt=Object.prototype.toString;function Je(P){var R=P.length*.75,T=P.length,N,j=0,F,C,ne,oe;P[P.length-1]==="="&&(R--,P[P.length-2]==="="&&R--);var ue=new ArrayBuffer(R),he=new Uint8Array(ue);for(N=0;N<T;N+=4)F=Q.indexOf(P[N]),C=Q.indexOf(P[N+1]),ne=Q.indexOf(P[N+2]),oe=Q.indexOf(P[N+3]),he[j++]=F<<2|C>>4,he[j++]=(C&15)<<4|ne>>2,he[j++]=(ne&3)<<6|oe&63;return ue}function Qt(P){var R=new Uint8Array(P),T="",N;for(N=0;N<R.length;N+=3)T+=Q[R[N]>>2],T+=Q[(R[N]&3)<<4|R[N+1]>>4],T+=Q[(R[N+1]&15)<<2|R[N+2]>>6],T+=Q[R[N+2]&63];return R.length%3===2?T=T.substring(0,T.length-1)+"=":R.length%3===1&&(T=T.substring(0,T.length-2)+"=="),T}function Pr(P,R){var T="";if(P&&(T=qt.call(P)),P&&(T==="[object ArrayBuffer]"||P.buffer&&qt.call(P.buffer)==="[object ArrayBuffer]")){var N,j=E;P instanceof ArrayBuffer?(N=P,j+=te):(N=P.buffer,T==="[object Int8Array]"?j+=V:T==="[object Uint8Array]"?j+=ce:T==="[object Uint8ClampedArray]"?j+=pe:T==="[object Int16Array]"?j+=se:T==="[object Uint16Array]"?j+=Xe:T==="[object Int32Array]"?j+=we:T==="[object Uint32Array]"?j+=Ae:T==="[object Float32Array]"?j+=_t:T==="[object Float64Array]"?j+=Kt:R(new Error("Failed to get type for BinaryArray"))),R(j+Qt(N))}else if(T==="[object Blob]"){var F=new FileReader;F.onload=function(){var C=Z+P.type+"~"+Qt(this.result);R(E+re+C)},F.readAsArrayBuffer(P)}else try{R(JSON.stringify(P))}catch(C){console.error("Couldn't convert value into a JSON string: ",P),R(null,C)}}function At(P){if(P.substring(0,U)!==E)return JSON.parse(P);var R=P.substring(Mt),T=P.substring(U,Mt),N;if(T===re&&D.test(R)){var j=R.match(D);N=j[1],R=R.substring(j[0].length)}var F=Je(R);switch(T){case te:return F;case re:return g([F],{type:N});case V:return new Int8Array(F);case ce:return new Uint8Array(F);case pe:return new Uint8ClampedArray(F);case se:return new Int16Array(F);case Xe:return new Uint16Array(F);case we:return new Int32Array(F);case Ae:return new Uint32Array(F);case _t:return new Float32Array(F);case Kt:return new Float64Array(F);default:throw new Error("Unkown type: "+T)}}var dr={serialize:Pr,deserialize:At,stringToBuffer:Je,bufferToString:Qt};function kr(P,R,T,N){P.executeSql("CREATE TABLE IF NOT EXISTS "+R.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],T,N)}function Hr(P){var R=this,T={db:null};if(P)for(var N in P)T[N]=typeof P[N]!="string"?P[N].toString():P[N];var j=new h(function(F,C){try{T.db=openDatabase(T.name,String(T.version),T.description,T.size)}catch(ne){return C(ne)}T.db.transaction(function(ne){kr(ne,T,function(){R._dbInfo=T,F()},function(oe,ue){C(ue)})},C)});return T.serializer=dr,j}function Bt(P,R,T,N,j,F){P.executeSql(T,N,j,function(C,ne){ne.code===ne.SYNTAX_ERR?C.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[R.storeName],function(oe,ue){ue.rows.length?F(oe,ne):kr(oe,R,function(){oe.executeSql(T,N,j,F)},F)},F):F(C,ne)},F)}function Mr(P,R){var T=this;P=S(P);var N=new h(function(j,F){T.ready().then(function(){var C=T._dbInfo;C.db.transaction(function(ne){Bt(ne,C,"SELECT * FROM "+C.storeName+" WHERE key = ? LIMIT 1",[P],function(oe,ue){var he=ue.rows.length?ue.rows.item(0).value:null;he&&(he=C.serializer.deserialize(he)),j(he)},function(oe,ue){F(ue)})})}).catch(F)});return w(N,R),N}function ir(P,R){var T=this,N=new h(function(j,F){T.ready().then(function(){var C=T._dbInfo;C.db.transaction(function(ne){Bt(ne,C,"SELECT * FROM "+C.storeName,[],function(oe,ue){for(var he=ue.rows,be=he.length,De=0;De<be;De++){var ze=he.item(De),je=ze.value;if(je&&(je=C.serializer.deserialize(je)),je=P(je,ze.key,De+1),je!==void 0){j(je);return}}j()},function(oe,ue){F(ue)})})}).catch(F)});return w(N,R),N}function ar(P,R,T,N){var j=this;P=S(P);var F=new h(function(C,ne){j.ready().then(function(){R===void 0&&(R=null);var oe=R,ue=j._dbInfo;ue.serializer.serialize(R,function(he,be){be?ne(be):ue.db.transaction(function(De){Bt(De,ue,"INSERT OR REPLACE INTO "+ue.storeName+" (key, value) VALUES (?, ?)",[P,he],function(){C(oe)},function(ze,je){ne(je)})},function(De){if(De.code===De.QUOTA_ERR){if(N>0){C(ar.apply(j,[P,oe,T,N-1]));return}ne(De)}})})}).catch(ne)});return w(F,T),F}function ri(P,R,T){return ar.apply(this,[P,R,T,1])}function ni(P,R){var T=this;P=S(P);var N=new h(function(j,F){T.ready().then(function(){var C=T._dbInfo;C.db.transaction(function(ne){Bt(ne,C,"DELETE FROM "+C.storeName+" WHERE key = ?",[P],function(){j()},function(oe,ue){F(ue)})})}).catch(F)});return w(N,R),N}function ii(P){var R=this,T=new h(function(N,j){R.ready().then(function(){var F=R._dbInfo;F.db.transaction(function(C){Bt(C,F,"DELETE FROM "+F.storeName,[],function(){N()},function(ne,oe){j(oe)})})}).catch(j)});return w(T,P),T}function ai(P){var R=this,T=new h(function(N,j){R.ready().then(function(){var F=R._dbInfo;F.db.transaction(function(C){Bt(C,F,"SELECT COUNT(key) as c FROM "+F.storeName,[],function(ne,oe){var ue=oe.rows.item(0).c;N(ue)},function(ne,oe){j(oe)})})}).catch(j)});return w(T,P),T}function mr(P,R){var T=this,N=new h(function(j,F){T.ready().then(function(){var C=T._dbInfo;C.db.transaction(function(ne){Bt(ne,C,"SELECT key FROM "+C.storeName+" WHERE id = ? LIMIT 1",[P+1],function(oe,ue){var he=ue.rows.length?ue.rows.item(0).key:null;j(he)},function(oe,ue){F(ue)})})}).catch(F)});return w(N,R),N}function En(P){var R=this,T=new h(function(N,j){R.ready().then(function(){var F=R._dbInfo;F.db.transaction(function(C){Bt(C,F,"SELECT key FROM "+F.storeName,[],function(ne,oe){for(var ue=[],he=0;he<oe.rows.length;he++)ue.push(oe.rows.item(he).key);N(ue)},function(ne,oe){j(oe)})})}).catch(j)});return w(T,P),T}function si(P){return new h(function(R,T){P.transaction(function(N){N.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(j,F){for(var C=[],ne=0;ne<F.rows.length;ne++)C.push(F.rows.item(ne).name);R({db:P,storeNames:C})},function(j,F){T(F)})},function(N){T(N)})})}function oi(P,R){R=v.apply(this,arguments);var T=this.config();P=typeof P!="function"&&P||{},P.name||(P.name=P.name||T.name,P.storeName=P.storeName||T.storeName);var N=this,j;return P.name?j=new h(function(F){var C;P.name===T.name?C=N._dbInfo.db:C=openDatabase(P.name,"","",0),P.storeName?F({db:C,storeNames:[P.storeName]}):F(si(C))}).then(function(F){return new h(function(C,ne){F.db.transaction(function(oe){function ue(ze){return new h(function(je,st){oe.executeSql("DROP TABLE IF EXISTS "+ze,[],function(){je()},function(it,Et){st(Et)})})}for(var he=[],be=0,De=F.storeNames.length;be<De;be++)he.push(ue(F.storeNames[be]));h.all(he).then(function(){C()}).catch(function(ze){ne(ze)})},function(oe){ne(oe)})})}):j=h.reject("Invalid arguments"),w(j,R),j}var li={_driver:"webSQLStorage",_initStorage:Hr,_support:f(),iterate:ir,getItem:Mr,setItem:ri,removeItem:ni,clear:ii,length:ai,key:mr,keys:En,dropInstance:oi};function ci(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function fn(P,R){var T=P.name+"/";return P.storeName!==R.storeName&&(T+=P.storeName+"/"),T}function In(){var P="_localforage_support_test";try{return localStorage.setItem(P,!0),localStorage.removeItem(P),!1}catch{return!0}}function hn(){return!In()||localStorage.length>0}function ui(P){var R=this,T={};if(P)for(var N in P)T[N]=P[N];return T.keyPrefix=fn(P,R._defaultConfig),hn()?(R._dbInfo=T,T.serializer=dr,h.resolve()):h.reject()}function Dn(P){var R=this,T=R.ready().then(function(){for(var N=R._dbInfo.keyPrefix,j=localStorage.length-1;j>=0;j--){var F=localStorage.key(j);F.indexOf(N)===0&&localStorage.removeItem(F)}});return w(T,P),T}function pr(P,R){var T=this;P=S(P);var N=T.ready().then(function(){var j=T._dbInfo,F=localStorage.getItem(j.keyPrefix+P);return F&&(F=j.serializer.deserialize(F)),F});return w(N,R),N}function fi(P,R){var T=this,N=T.ready().then(function(){for(var j=T._dbInfo,F=j.keyPrefix,C=F.length,ne=localStorage.length,oe=1,ue=0;ue<ne;ue++){var he=localStorage.key(ue);if(he.indexOf(F)===0){var be=localStorage.getItem(he);if(be&&(be=j.serializer.deserialize(be)),be=P(be,he.substring(C),oe++),be!==void 0)return be}}});return w(N,R),N}function hi(P,R){var T=this,N=T.ready().then(function(){var j=T._dbInfo,F;try{F=localStorage.key(P)}catch{F=null}return F&&(F=F.substring(j.keyPrefix.length)),F});return w(N,R),N}function xn(P){var R=this,T=R.ready().then(function(){for(var N=R._dbInfo,j=localStorage.length,F=[],C=0;C<j;C++){var ne=localStorage.key(C);ne.indexOf(N.keyPrefix)===0&&F.push(ne.substring(N.keyPrefix.length))}return F});return w(T,P),T}function dn(P){var R=this,T=R.keys().then(function(N){return N.length});return w(T,P),T}function An(P,R){var T=this;P=S(P);var N=T.ready().then(function(){var j=T._dbInfo;localStorage.removeItem(j.keyPrefix+P)});return w(N,R),N}function di(P,R,T){var N=this;P=S(P);var j=N.ready().then(function(){R===void 0&&(R=null);var F=R;return new h(function(C,ne){var oe=N._dbInfo;oe.serializer.serialize(R,function(ue,he){if(he)ne(he);else try{localStorage.setItem(oe.keyPrefix+P,ue),C(F)}catch(be){(be.name==="QuotaExceededError"||be.name==="NS_ERROR_DOM_QUOTA_REACHED")&&ne(be),ne(be)}})})});return w(j,T),j}function mi(P,R){if(R=v.apply(this,arguments),P=typeof P!="function"&&P||{},!P.name){var T=this.config();P.name=P.name||T.name,P.storeName=P.storeName||T.storeName}var N=this,j;return P.name?j=new h(function(F){P.storeName?F(fn(P,N._defaultConfig)):F(P.name+"/")}).then(function(F){for(var C=localStorage.length-1;C>=0;C--){var ne=localStorage.key(C);ne.indexOf(F)===0&&localStorage.removeItem(ne)}}):j=h.reject("Invalid arguments"),w(j,R),j}var pi={_driver:"localStorageWrapper",_initStorage:ui,_support:ci(),iterate:fi,getItem:pr,setItem:di,removeItem:An,clear:Dn,length:dn,key:hi,keys:xn,dropInstance:mi},_i=function(R,T){return R===T||typeof R=="number"&&typeof T=="number"&&isNaN(R)&&isNaN(T)},gi=function(R,T){for(var N=R.length,j=0;j<N;){if(_i(R[j],T))return!0;j++}return!1},Vr=Array.isArray||function(P){return Object.prototype.toString.call(P)==="[object Array]"},Tr={},Bn={},_r={INDEXEDDB:kt,WEBSQL:li,LOCALSTORAGE:pi},Ln=[_r.INDEXEDDB._driver,_r.WEBSQL._driver,_r.LOCALSTORAGE._driver],Er=["dropInstance"],Ir=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Er),Rn={description:"",driver:Ln.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function sr(P,R){P[R]=function(){var T=arguments;return P.ready().then(function(){return P[R].apply(P,T)})}}function Wr(){for(var P=1;P<arguments.length;P++){var R=arguments[P];if(R)for(var T in R)R.hasOwnProperty(T)&&(Vr(R[T])?arguments[0][T]=R[T].slice():arguments[0][T]=R[T])}return arguments[0]}var vi=function(){function P(R){o(this,P);for(var T in _r)if(_r.hasOwnProperty(T)){var N=_r[T],j=N._driver;this[T]=j,Tr[j]||this.defineDriver(N)}this._defaultConfig=Wr({},Rn),this._config=Wr({},this._defaultConfig,R),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return P.prototype.config=function(T){if((typeof T>"u"?"undefined":s(T))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var N in T){if(N==="storeName"&&(T[N]=T[N].replace(/\W/g,"_")),N==="version"&&typeof T[N]!="number")return new Error("Database version must be a number.");this._config[N]=T[N]}return"driver"in T&&T.driver?this.setDriver(this._config.driver):!0}else return typeof T=="string"?this._config[T]:this._config},P.prototype.defineDriver=function(T,N,j){var F=new h(function(C,ne){try{var oe=T._driver,ue=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!T._driver){ne(ue);return}for(var he=Ir.concat("_initStorage"),be=0,De=he.length;be<De;be++){var ze=he[be],je=!gi(Er,ze);if((je||T[ze])&&typeof T[ze]!="function"){ne(ue);return}}var st=function(){for(var ct=function(tt){return function(){var On=new Error("Method "+tt+" is not implemented by the current driver"),Fn=h.reject(On);return w(Fn,arguments[arguments.length-1]),Fn}},mn=0,bi=Er.length;mn<bi;mn++){var Ge=Er[mn];T[Ge]||(T[Ge]=ct(Ge))}};st();var it=function(ct){Tr[oe]&&console.info("Redefining LocalForage driver: "+oe),Tr[oe]=T,Bn[oe]=ct,C()};"_support"in T?T._support&&typeof T._support=="function"?T._support().then(it,ne):it(!!T._support):it(!0)}catch(Et){ne(Et)}});return d(F,N,j),F},P.prototype.driver=function(){return this._driver||null},P.prototype.getDriver=function(T,N,j){var F=Tr[T]?h.resolve(Tr[T]):h.reject(new Error("Driver not found."));return d(F,N,j),F},P.prototype.getSerializer=function(T){var N=h.resolve(dr);return d(N,T),N},P.prototype.ready=function(T){var N=this,j=N._driverSet.then(function(){return N._ready===null&&(N._ready=N._initDriver()),N._ready});return d(j,T,T),j},P.prototype.setDriver=function(T,N,j){var F=this;Vr(T)||(T=[T]);var C=this._getSupportedDrivers(T);function ne(){F._config.driver=F.driver()}function oe(be){return F._extend(be),ne(),F._ready=F._initStorage(F._config),F._ready}function ue(be){return function(){var De=0;function ze(){for(;De<be.length;){var je=be[De];return De++,F._dbInfo=null,F._ready=null,F.getDriver(je).then(oe).catch(ze)}ne();var st=new Error("No available storage method found.");return F._driverSet=h.reject(st),F._driverSet}return ze()}}var he=this._driverSet!==null?this._driverSet.catch(function(){return h.resolve()}):h.resolve();return this._driverSet=he.then(function(){var be=C[0];return F._dbInfo=null,F._ready=null,F.getDriver(be).then(function(De){F._driver=De._driver,ne(),F._wrapLibraryMethodsWithReady(),F._initDriver=ue(C)})}).catch(function(){ne();var be=new Error("No available storage method found.");return F._driverSet=h.reject(be),F._driverSet}),d(this._driverSet,N,j),this._driverSet},P.prototype.supports=function(T){return!!Bn[T]},P.prototype._extend=function(T){Wr(this,T)},P.prototype._getSupportedDrivers=function(T){for(var N=[],j=0,F=T.length;j<F;j++){var C=T[j];this.supports(C)&&N.push(C)}return N},P.prototype._wrapLibraryMethodsWithReady=function(){for(var T=0,N=Ir.length;T<N;T++)sr(this,Ir[T])},P.prototype.createInstance=function(T){return new P(T)},P}(),gr=new vi;i.exports=gr},{3:3}]},{},[4])(4)})})(oa);var Wa=oa.exports;const Un=sa(Wa);var la={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(n,e){(function(t){n.exports=t()})(function(){return function t(i,a,s){function o(p,g){if(!a[p]){if(!i[p]){var h=typeof yr=="function"&&yr;if(!g&&h)return h(p,!0);if(l)return l(p,!0);var w=new Error("Cannot find module '"+p+"'");throw w.code="MODULE_NOT_FOUND",w}var d=a[p]={exports:{}};i[p][0].call(d.exports,function(S){var v=i[p][1][S];return o(v||S)},d,d.exports,t,i,a,s)}return a[p].exports}for(var l=typeof yr=="function"&&yr,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(t,i,a){var s=t("./utils"),o=t("./support"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(c){for(var p,g,h,w,d,S,v,y=[],b=0,M=c.length,L=M,z=s.getTypeOf(c)!=="string";b<c.length;)L=M-b,h=z?(p=c[b++],g=b<M?c[b++]:0,b<M?c[b++]:0):(p=c.charCodeAt(b++),g=b<M?c.charCodeAt(b++):0,b<M?c.charCodeAt(b++):0),w=p>>2,d=(3&p)<<4|g>>4,S=1<L?(15&g)<<2|h>>6:64,v=2<L?63&h:64,y.push(l.charAt(w)+l.charAt(d)+l.charAt(S)+l.charAt(v));return y.join("")},a.decode=function(c){var p,g,h,w,d,S,v=0,y=0,b="data:";if(c.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var M,L=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===l.charAt(64)&&L--,c.charAt(c.length-2)===l.charAt(64)&&L--,L%1!=0)throw new Error("Invalid base64 input, bad content length.");for(M=o.uint8array?new Uint8Array(0|L):new Array(0|L);v<c.length;)p=l.indexOf(c.charAt(v++))<<2|(w=l.indexOf(c.charAt(v++)))>>4,g=(15&w)<<4|(d=l.indexOf(c.charAt(v++)))>>2,h=(3&d)<<6|(S=l.indexOf(c.charAt(v++))),M[y++]=p,d!==64&&(M[y++]=g),S!==64&&(M[y++]=h);return M}},{"./support":30,"./utils":32}],2:[function(t,i,a){var s=t("./external"),o=t("./stream/DataWorker"),l=t("./stream/Crc32Probe"),c=t("./stream/DataLengthProbe");function p(g,h,w,d,S){this.compressedSize=g,this.uncompressedSize=h,this.crc32=w,this.compression=d,this.compressedContent=S}p.prototype={getContentWorker:function(){var g=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return g.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),g},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},p.createWorkerFrom=function(g,h,w){return g.pipe(new l).pipe(new c("uncompressedSize")).pipe(h.compressWorker(w)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},i.exports=p},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,a){var s=t("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},a.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,a){var s=t("./utils"),o=function(){for(var l,c=[],p=0;p<256;p++){l=p;for(var g=0;g<8;g++)l=1&l?3988292384^l>>>1:l>>>1;c[p]=l}return c}();i.exports=function(l,c){return l!==void 0&&l.length?s.getTypeOf(l)!=="string"?function(p,g,h,w){var d=o,S=w+h;p^=-1;for(var v=w;v<S;v++)p=p>>>8^d[255&(p^g[v])];return-1^p}(0|c,l,l.length,0):function(p,g,h,w){var d=o,S=w+h;p^=-1;for(var v=w;v<S;v++)p=p>>>8^d[255&(p^g.charCodeAt(v))];return-1^p}(0|c,l,l.length,0):0}},{"./utils":32}],5:[function(t,i,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(t,i,a){var s=null;s=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:s}},{lie:37}],7:[function(t,i,a){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=t("pako"),l=t("./utils"),c=t("./stream/GenericWorker"),p=s?"uint8array":"array";function g(h,w){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=w,this.meta={}}a.magic="\b\0",l.inherits(g,c),g.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(l.transformTo(p,h.data),!1)},g.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},g.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},g.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(w){h.push({data:w,meta:h.meta})}},a.compressWorker=function(h){return new g("Deflate",h)},a.uncompressWorker=function(){return new g("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,a){function s(d,S){var v,y="";for(v=0;v<S;v++)y+=String.fromCharCode(255&d),d>>>=8;return y}function o(d,S,v,y,b,M){var L,z,x=d.file,W=d.compression,H=M!==p.utf8encode,K=l.transformTo("string",M(x.name)),G=l.transformTo("string",p.utf8encode(x.name)),ee=x.comment,_e=l.transformTo("string",M(ee)),B=l.transformTo("string",p.utf8encode(ee)),q=G.length!==x.name.length,_=B.length!==ee.length,$="",Me="",ie="",xe=x.dir,le=x.date,Te={crc32:0,compressedSize:0,uncompressedSize:0};S&&!v||(Te.crc32=d.crc32,Te.compressedSize=d.compressedSize,Te.uncompressedSize=d.uncompressedSize);var Y=0;S&&(Y|=8),H||!q&&!_||(Y|=2048);var X=0,ve=0;xe&&(X|=16),b==="UNIX"?(ve=798,X|=function(fe,Ce){var lt=fe;return fe||(lt=Ce?16893:33204),(65535&lt)<<16}(x.unixPermissions,xe)):(ve=20,X|=function(fe){return 63&(fe||0)}(x.dosPermissions)),L=le.getUTCHours(),L<<=6,L|=le.getUTCMinutes(),L<<=5,L|=le.getUTCSeconds()/2,z=le.getUTCFullYear()-1980,z<<=4,z|=le.getUTCMonth()+1,z<<=5,z|=le.getUTCDate(),q&&(Me=s(1,1)+s(g(K),4)+G,$+="up"+s(Me.length,2)+Me),_&&(ie=s(1,1)+s(g(_e),4)+B,$+="uc"+s(ie.length,2)+ie);var me="";return me+=`
\0`,me+=s(Y,2),me+=W.magic,me+=s(L,2),me+=s(z,2),me+=s(Te.crc32,4),me+=s(Te.compressedSize,4),me+=s(Te.uncompressedSize,4),me+=s(K.length,2),me+=s($.length,2),{fileRecord:h.LOCAL_FILE_HEADER+me+K+$,dirRecord:h.CENTRAL_FILE_HEADER+s(ve,2)+me+s(_e.length,2)+"\0\0\0\0"+s(X,4)+s(y,4)+K+$+_e}}var l=t("../utils"),c=t("../stream/GenericWorker"),p=t("../utf8"),g=t("../crc32"),h=t("../signature");function w(d,S,v,y){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=S,this.zipPlatform=v,this.encodeFileName=y,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}l.inherits(w,c),w.prototype.push=function(d){var S=d.meta.percent||0,v=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:v?(S+100*(v-y-1))/v:100}}))},w.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var S=this.streamFiles&&!d.file.dir;if(S){var v=o(d,S,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:v.fileRecord,meta:{percent:0}})}else this.accumulate=!0},w.prototype.closedSource=function(d){this.accumulate=!1;var S=this.streamFiles&&!d.file.dir,v=o(d,S,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(v.dirRecord),S)this.push({data:function(y){return h.DATA_DESCRIPTOR+s(y.crc32,4)+s(y.compressedSize,4)+s(y.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:v.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},w.prototype.flush=function(){for(var d=this.bytesWritten,S=0;S<this.dirRecords.length;S++)this.push({data:this.dirRecords[S],meta:{percent:100}});var v=this.bytesWritten-d,y=function(b,M,L,z,x){var W=l.transformTo("string",x(z));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(b,2)+s(b,2)+s(M,4)+s(L,4)+s(W.length,2)+W}(this.dirRecords.length,v,d,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},w.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},w.prototype.registerPrevious=function(d){this._sources.push(d);var S=this;return d.on("data",function(v){S.processChunk(v)}),d.on("end",function(){S.closedSource(S.previous.streamInfo),S._sources.length?S.prepareNextSource():S.end()}),d.on("error",function(v){S.error(v)}),this},w.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},w.prototype.error=function(d){var S=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var v=0;v<S.length;v++)try{S[v].error(d)}catch{}return!0},w.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,S=0;S<d.length;S++)d[S].lock()},i.exports=w},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,a){var s=t("../compressions"),o=t("./ZipFileWorker");a.generateWorker=function(l,c,p){var g=new o(c.streamFiles,p,c.platform,c.encodeFileName),h=0;try{l.forEach(function(w,d){h++;var S=function(M,L){var z=M||L,x=s[z];if(!x)throw new Error(z+" is not a valid compression method !");return x}(d.options.compression,c.compression),v=d.options.compressionOptions||c.compressionOptions||{},y=d.dir,b=d.date;d._compressWorker(S,v).withStreamInfo("file",{name:w,dir:y,date:b,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(g)}),g.entriesCount=h}catch(w){g.error(w)}return g}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,a){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var l in this)typeof this[l]!="function"&&(o[l]=this[l]);return o}}(s.prototype=t("./object")).loadAsync=t("./load"),s.support=t("./support"),s.defaults=t("./defaults"),s.version="3.10.1",s.loadAsync=function(o,l){return new s().loadAsync(o,l)},s.external=t("./external"),i.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,a){var s=t("./utils"),o=t("./external"),l=t("./utf8"),c=t("./zipEntries"),p=t("./stream/Crc32Probe"),g=t("./nodejsUtils");function h(w){return new o.Promise(function(d,S){var v=w.decompressed.getContentWorker().pipe(new p);v.on("error",function(y){S(y)}).on("end",function(){v.streamInfo.crc32!==w.decompressed.crc32?S(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}i.exports=function(w,d){var S=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:l.utf8decode}),g.isNode&&g.isStream(w)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",w,!0,d.optimizedBinaryString,d.base64).then(function(v){var y=new c(d);return y.load(v),y}).then(function(v){var y=[o.Promise.resolve(v)],b=v.files;if(d.checkCRC32)for(var M=0;M<b.length;M++)y.push(h(b[M]));return o.Promise.all(y)}).then(function(v){for(var y=v.shift(),b=y.files,M=0;M<b.length;M++){var L=b[M],z=L.fileNameStr,x=s.resolve(L.fileNameStr);S.file(x,L.decompressed,{binary:!0,optimizedBinaryString:!0,date:L.date,dir:L.dir,comment:L.fileCommentStr.length?L.fileCommentStr:null,unixPermissions:L.unixPermissions,dosPermissions:L.dosPermissions,createFolders:d.createFolders}),L.dir||(S.file(x).unsafeOriginalName=z)}return y.zipComment.length&&(S.comment=y.zipComment),S})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,a){var s=t("../utils"),o=t("../stream/GenericWorker");function l(c,p){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(p)}s.inherits(l,o),l.prototype._bindStream=function(c){var p=this;(this._stream=c).pause(),c.on("data",function(g){p.push({data:g,meta:{percent:0}})}).on("error",function(g){p.isPaused?this.generatedError=g:p.error(g)}).on("end",function(){p.isPaused?p._upstreamEnded=!0:p.end()})},l.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},l.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=l},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,a){var s=t("readable-stream").Readable;function o(l,c,p){s.call(this,c),this._helper=l;var g=this;l.on("data",function(h,w){g.push(h)||g._helper.pause(),p&&p(w)}).on("error",function(h){g.emit("error",h)}).on("end",function(){g.push(null)})}t("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},i.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,i,a){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(t,i,a){function s(x,W,H){var K,G=l.getTypeOf(W),ee=l.extend(H||{},g);ee.date=ee.date||new Date,ee.compression!==null&&(ee.compression=ee.compression.toUpperCase()),typeof ee.unixPermissions=="string"&&(ee.unixPermissions=parseInt(ee.unixPermissions,8)),ee.unixPermissions&&16384&ee.unixPermissions&&(ee.dir=!0),ee.dosPermissions&&16&ee.dosPermissions&&(ee.dir=!0),ee.dir&&(x=b(x)),ee.createFolders&&(K=y(x))&&M.call(this,K,!0);var _e=G==="string"&&ee.binary===!1&&ee.base64===!1;H&&H.binary!==void 0||(ee.binary=!_e),(W instanceof h&&W.uncompressedSize===0||ee.dir||!W||W.length===0)&&(ee.base64=!1,ee.binary=!0,W="",ee.compression="STORE",G="string");var B=null;B=W instanceof h||W instanceof c?W:S.isNode&&S.isStream(W)?new v(x,W):l.prepareContent(x,W,ee.binary,ee.optimizedBinaryString,ee.base64);var q=new w(x,B,ee);this.files[x]=q}var o=t("./utf8"),l=t("./utils"),c=t("./stream/GenericWorker"),p=t("./stream/StreamHelper"),g=t("./defaults"),h=t("./compressedObject"),w=t("./zipObject"),d=t("./generate"),S=t("./nodejsUtils"),v=t("./nodejs/NodejsStreamInputAdapter"),y=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var W=x.lastIndexOf("/");return 0<W?x.substring(0,W):""},b=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},M=function(x,W){return W=W!==void 0?W:g.createFolders,x=b(x),this.files[x]||s.call(this,x,null,{dir:!0,createFolders:W}),this.files[x]};function L(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var z={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var W,H,K;for(W in this.files)K=this.files[W],(H=W.slice(this.root.length,W.length))&&W.slice(0,this.root.length)===this.root&&x(H,K)},filter:function(x){var W=[];return this.forEach(function(H,K){x(H,K)&&W.push(K)}),W},file:function(x,W,H){if(arguments.length!==1)return x=this.root+x,s.call(this,x,W,H),this;if(L(x)){var K=x;return this.filter(function(ee,_e){return!_e.dir&&K.test(ee)})}var G=this.files[this.root+x];return G&&!G.dir?G:null},folder:function(x){if(!x)return this;if(L(x))return this.filter(function(G,ee){return ee.dir&&x.test(G)});var W=this.root+x,H=M.call(this,W),K=this.clone();return K.root=H.name,K},remove:function(x){x=this.root+x;var W=this.files[x];if(W||(x.slice(-1)!=="/"&&(x+="/"),W=this.files[x]),W&&!W.dir)delete this.files[x];else for(var H=this.filter(function(G,ee){return ee.name.slice(0,x.length)===x}),K=0;K<H.length;K++)delete this.files[H[K].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var W,H={};try{if((H=l.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=H.type.toLowerCase(),H.compression=H.compression.toUpperCase(),H.type==="binarystring"&&(H.type="string"),!H.type)throw new Error("No output type specified.");l.checkSupport(H.type),H.platform!=="darwin"&&H.platform!=="freebsd"&&H.platform!=="linux"&&H.platform!=="sunos"||(H.platform="UNIX"),H.platform==="win32"&&(H.platform="DOS");var K=H.comment||this.comment||"";W=d.generateWorker(this,H,K)}catch(G){(W=new c("error")).error(G)}return new p(W,H.type||"string",H.mimeType)},generateAsync:function(x,W){return this.generateInternalStream(x).accumulate(W)},generateNodeStream:function(x,W){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(W)}};i.exports=z},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,a){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,a){var s=t("./DataReader");function o(l){s.call(this,l);for(var c=0;c<this.data.length;c++)l[c]=255&l[c]}t("../utils").inherits(o,s),o.prototype.byteAt=function(l){return this.data[this.zero+l]},o.prototype.lastIndexOfSignature=function(l){for(var c=l.charCodeAt(0),p=l.charCodeAt(1),g=l.charCodeAt(2),h=l.charCodeAt(3),w=this.length-4;0<=w;--w)if(this.data[w]===c&&this.data[w+1]===p&&this.data[w+2]===g&&this.data[w+3]===h)return w-this.zero;return-1},o.prototype.readAndCheckSignature=function(l){var c=l.charCodeAt(0),p=l.charCodeAt(1),g=l.charCodeAt(2),h=l.charCodeAt(3),w=this.readData(4);return c===w[0]&&p===w[1]&&g===w[2]&&h===w[3]},o.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},i.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,i,a){var s=t("../utils");function o(l){this.data=l,this.length=l.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(l){this.checkIndex(this.index+l)},checkIndex:function(l){if(this.length<this.zero+l||l<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+l+"). Corrupted zip ?")},setIndex:function(l){this.checkIndex(l),this.index=l},skip:function(l){this.setIndex(this.index+l)},byteAt:function(){},readInt:function(l){var c,p=0;for(this.checkOffset(l),c=this.index+l-1;c>=this.index;c--)p=(p<<8)+this.byteAt(c);return this.index+=l,p},readString:function(l){return s.transformTo("string",this.readData(l))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var l=this.readInt(4);return new Date(Date.UTC(1980+(l>>25&127),(l>>21&15)-1,l>>16&31,l>>11&31,l>>5&63,(31&l)<<1))}},i.exports=o},{"../utils":32}],19:[function(t,i,a){var s=t("./Uint8ArrayReader");function o(l){s.call(this,l)}t("../utils").inherits(o,s),o.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},i.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,a){var s=t("./DataReader");function o(l){s.call(this,l)}t("../utils").inherits(o,s),o.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},o.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},o.prototype.readAndCheckSignature=function(l){return l===this.readData(4)},o.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},i.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,i,a){var s=t("./ArrayReader");function o(l){s.call(this,l)}t("../utils").inherits(o,s),o.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},i.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,a){var s=t("../utils"),o=t("../support"),l=t("./ArrayReader"),c=t("./StringReader"),p=t("./NodeBufferReader"),g=t("./Uint8ArrayReader");i.exports=function(h){var w=s.getTypeOf(h);return s.checkSupport(w),w!=="string"||o.uint8array?w==="nodebuffer"?new p(h):o.uint8array?new g(s.transformTo("uint8array",h)):new l(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,a){var s=t("./GenericWorker"),o=t("../utils");function l(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(l,s),l.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},i.exports=l},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,a){var s=t("./GenericWorker"),o=t("../crc32");function l(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(l,s),l.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},i.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,a){var s=t("../utils"),o=t("./GenericWorker");function l(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(l,o),l.prototype.processChunk=function(c){if(c){var p=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=p+c.data.length}o.prototype.processChunk.call(this,c)},i.exports=l},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,a){var s=t("../utils"),o=t("./GenericWorker");function l(c){o.call(this,"DataWorker");var p=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(g){p.dataIsReady=!0,p.data=g,p.max=g&&g.length||0,p.type=s.getTypeOf(g),p.isPaused||p._tickAndRepeat()},function(g){p.error(g)})}s.inherits(l,o),l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,p=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,p);break;case"uint8array":c=this.data.subarray(this.index,p);break;case"array":case"nodebuffer":c=this.data.slice(this.index,p)}return this.index=p,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,a){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,l){return this._listeners[o].push(l),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,l){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,l)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var l=this;return o.on("data",function(c){l.processChunk(c)}),o.on("end",function(){l.end()}),o.on("error",function(c){l.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,l){return this.extraStreamInfo[o]=l,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},i.exports=s},{}],29:[function(t,i,a){var s=t("../utils"),o=t("./ConvertWorker"),l=t("./GenericWorker"),c=t("../base64"),p=t("../support"),g=t("../external"),h=null;if(p.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function w(S,v){return new g.Promise(function(y,b){var M=[],L=S._internalType,z=S._outputType,x=S._mimeType;S.on("data",function(W,H){M.push(W),v&&v(H)}).on("error",function(W){M=[],b(W)}).on("end",function(){try{var W=function(H,K,G){switch(H){case"blob":return s.newBlob(s.transformTo("arraybuffer",K),G);case"base64":return c.encode(K);default:return s.transformTo(H,K)}}(z,function(H,K){var G,ee=0,_e=null,B=0;for(G=0;G<K.length;G++)B+=K[G].length;switch(H){case"string":return K.join("");case"array":return Array.prototype.concat.apply([],K);case"uint8array":for(_e=new Uint8Array(B),G=0;G<K.length;G++)_e.set(K[G],ee),ee+=K[G].length;return _e;case"nodebuffer":return Buffer.concat(K);default:throw new Error("concat : unsupported type '"+H+"'")}}(L,M),x);y(W)}catch(H){b(H)}M=[]}).resume()})}function d(S,v,y){var b=v;switch(v){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=v,this._mimeType=y,s.checkSupport(b),this._worker=S.pipe(new o(b)),S.lock()}catch(M){this._worker=new l("error"),this._worker.error(M)}}d.prototype={accumulate:function(S){return w(this,S)},on:function(S,v){var y=this;return S==="data"?this._worker.on(S,function(b){v.call(y,b.data,b.meta)}):this._worker.on(S,function(){s.delay(v,arguments,y)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(S){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},S)}},i.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var s=new ArrayBuffer(0);try{a.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),a.blob=o.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!t("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,a){for(var s=t("./utils"),o=t("./support"),l=t("./nodejsUtils"),c=t("./stream/GenericWorker"),p=new Array(256),g=0;g<256;g++)p[g]=252<=g?6:248<=g?5:240<=g?4:224<=g?3:192<=g?2:1;p[254]=p[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function w(){c.call(this,"utf-8 encode")}a.utf8encode=function(d){return o.nodebuffer?l.newBufferFrom(d,"utf-8"):function(S){var v,y,b,M,L,z=S.length,x=0;for(M=0;M<z;M++)(64512&(y=S.charCodeAt(M)))==55296&&M+1<z&&(64512&(b=S.charCodeAt(M+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),M++),x+=y<128?1:y<2048?2:y<65536?3:4;for(v=o.uint8array?new Uint8Array(x):new Array(x),M=L=0;L<x;M++)(64512&(y=S.charCodeAt(M)))==55296&&M+1<z&&(64512&(b=S.charCodeAt(M+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),M++),y<128?v[L++]=y:(y<2048?v[L++]=192|y>>>6:(y<65536?v[L++]=224|y>>>12:(v[L++]=240|y>>>18,v[L++]=128|y>>>12&63),v[L++]=128|y>>>6&63),v[L++]=128|63&y);return v}(d)},a.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):function(S){var v,y,b,M,L=S.length,z=new Array(2*L);for(v=y=0;v<L;)if((b=S[v++])<128)z[y++]=b;else if(4<(M=p[b]))z[y++]=65533,v+=M-1;else{for(b&=M===2?31:M===3?15:7;1<M&&v<L;)b=b<<6|63&S[v++],M--;1<M?z[y++]=65533:b<65536?z[y++]=b:(b-=65536,z[y++]=55296|b>>10&1023,z[y++]=56320|1023&b)}return z.length!==y&&(z.subarray?z=z.subarray(0,y):z.length=y),s.applyFromCharCode(z)}(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var S=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var v=S;(S=new Uint8Array(v.length+this.leftOver.length)).set(this.leftOver,0),S.set(v,this.leftOver.length)}else S=this.leftOver.concat(S);this.leftOver=null}var y=function(M,L){var z;for((L=L||M.length)>M.length&&(L=M.length),z=L-1;0<=z&&(192&M[z])==128;)z--;return z<0||z===0?L:z+p[M[z]]>L?z:L}(S),b=S;y!==S.length&&(o.uint8array?(b=S.subarray(0,y),this.leftOver=S.subarray(y,S.length)):(b=S.slice(0,y),this.leftOver=S.slice(y,S.length))),this.push({data:a.utf8decode(b),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=h,s.inherits(w,c),w.prototype.processChunk=function(d){this.push({data:a.utf8encode(d.data),meta:d.meta})},a.Utf8EncodeWorker=w},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,a){var s=t("./support"),o=t("./base64"),l=t("./nodejsUtils"),c=t("./external");function p(v){return v}function g(v,y){for(var b=0;b<v.length;++b)y[b]=255&v.charCodeAt(b);return y}t("setimmediate"),a.newBlob=function(v,y){a.checkSupport("blob");try{return new Blob([v],{type:y})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(v),b.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(v,y,b){var M=[],L=0,z=v.length;if(z<=b)return String.fromCharCode.apply(null,v);for(;L<z;)y==="array"||y==="nodebuffer"?M.push(String.fromCharCode.apply(null,v.slice(L,Math.min(L+b,z)))):M.push(String.fromCharCode.apply(null,v.subarray(L,Math.min(L+b,z)))),L+=b;return M.join("")},stringifyByChar:function(v){for(var y="",b=0;b<v.length;b++)y+=String.fromCharCode(v[b]);return y},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,l.allocBuffer(1)).length===1}catch{return!1}}()}};function w(v){var y=65536,b=a.getTypeOf(v),M=!0;if(b==="uint8array"?M=h.applyCanBeUsed.uint8array:b==="nodebuffer"&&(M=h.applyCanBeUsed.nodebuffer),M)for(;1<y;)try{return h.stringifyByChunk(v,b,y)}catch{y=Math.floor(y/2)}return h.stringifyByChar(v)}function d(v,y){for(var b=0;b<v.length;b++)y[b]=v[b];return y}a.applyFromCharCode=w;var S={};S.string={string:p,array:function(v){return g(v,new Array(v.length))},arraybuffer:function(v){return S.string.uint8array(v).buffer},uint8array:function(v){return g(v,new Uint8Array(v.length))},nodebuffer:function(v){return g(v,l.allocBuffer(v.length))}},S.array={string:w,array:p,arraybuffer:function(v){return new Uint8Array(v).buffer},uint8array:function(v){return new Uint8Array(v)},nodebuffer:function(v){return l.newBufferFrom(v)}},S.arraybuffer={string:function(v){return w(new Uint8Array(v))},array:function(v){return d(new Uint8Array(v),new Array(v.byteLength))},arraybuffer:p,uint8array:function(v){return new Uint8Array(v)},nodebuffer:function(v){return l.newBufferFrom(new Uint8Array(v))}},S.uint8array={string:w,array:function(v){return d(v,new Array(v.length))},arraybuffer:function(v){return v.buffer},uint8array:p,nodebuffer:function(v){return l.newBufferFrom(v)}},S.nodebuffer={string:w,array:function(v){return d(v,new Array(v.length))},arraybuffer:function(v){return S.nodebuffer.uint8array(v).buffer},uint8array:function(v){return d(v,new Uint8Array(v.length))},nodebuffer:p},a.transformTo=function(v,y){if(y=y||"",!v)return y;a.checkSupport(v);var b=a.getTypeOf(y);return S[b][v](y)},a.resolve=function(v){for(var y=v.split("/"),b=[],M=0;M<y.length;M++){var L=y[M];L==="."||L===""&&M!==0&&M!==y.length-1||(L===".."?b.pop():b.push(L))}return b.join("/")},a.getTypeOf=function(v){return typeof v=="string"?"string":Object.prototype.toString.call(v)==="[object Array]"?"array":s.nodebuffer&&l.isBuffer(v)?"nodebuffer":s.uint8array&&v instanceof Uint8Array?"uint8array":s.arraybuffer&&v instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(v){if(!s[v.toLowerCase()])throw new Error(v+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(v){var y,b,M="";for(b=0;b<(v||"").length;b++)M+="\\x"+((y=v.charCodeAt(b))<16?"0":"")+y.toString(16).toUpperCase();return M},a.delay=function(v,y,b){setImmediate(function(){v.apply(b||null,y||[])})},a.inherits=function(v,y){function b(){}b.prototype=y.prototype,v.prototype=new b},a.extend=function(){var v,y,b={};for(v=0;v<arguments.length;v++)for(y in arguments[v])Object.prototype.hasOwnProperty.call(arguments[v],y)&&b[y]===void 0&&(b[y]=arguments[v][y]);return b},a.prepareContent=function(v,y,b,M,L){return c.Promise.resolve(y).then(function(z){return s.blob&&(z instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(z))!==-1)&&typeof FileReader<"u"?new c.Promise(function(x,W){var H=new FileReader;H.onload=function(K){x(K.target.result)},H.onerror=function(K){W(K.target.error)},H.readAsArrayBuffer(z)}):z}).then(function(z){var x=a.getTypeOf(z);return x?(x==="arraybuffer"?z=a.transformTo("uint8array",z):x==="string"&&(L?z=o.decode(z):b&&M!==!0&&(z=function(W){return g(W,s.uint8array?new Uint8Array(W.length):new Array(W.length))}(z))),z):c.Promise.reject(new Error("Can't read the data of '"+v+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,a){var s=t("./reader/readerFor"),o=t("./utils"),l=t("./signature"),c=t("./zipEntry"),p=t("./support");function g(h){this.files=[],this.loadOptions=h}g.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var w=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(w)+", expected "+o.pretty(h)+")")}},isSignature:function(h,w){var d=this.reader.index;this.reader.setIndex(h);var S=this.reader.readString(4)===w;return this.reader.setIndex(d),S},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),w=p.uint8array?"uint8array":"array",d=o.transformTo(w,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,w,d,S=this.zip64EndOfCentralSize-44;0<S;)h=this.reader.readInt(2),w=this.reader.readInt(4),d=this.reader.readData(w),this.zip64ExtensibleData[h]={id:h,length:w,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,w;for(h=0;h<this.files.length;h++)w=this.files[h],this.reader.setIndex(w.localHeaderOffset),this.checkSignature(l.LOCAL_FILE_HEADER),w.readLocalPart(this.reader),w.handleUTF8(),w.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(l.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(l.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,l.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var w=h;if(this.checkSignature(l.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,l.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var S=w-d;if(0<S)this.isSignature(w,l.CENTRAL_FILE_HEADER)||(this.reader.zero=S);else if(S<0)throw new Error("Corrupted zip: missing "+Math.abs(S)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=g},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,a){var s=t("./reader/readerFor"),o=t("./utils"),l=t("./compressedObject"),c=t("./crc32"),p=t("./utf8"),g=t("./compressions"),h=t("./support");function w(d,S){this.options=d,this.loadOptions=S}w.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var S,v;if(d.skip(22),this.fileNameLength=d.readInt(2),v=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(v),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((S=function(y){for(var b in g)if(Object.prototype.hasOwnProperty.call(g,b)&&g[b].magic===y)return g[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new l(this.compressedSize,this.uncompressedSize,this.crc32,S,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var S=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(S),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var S,v,y,b=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<b;)S=d.readInt(2),v=d.readInt(2),y=d.readData(v),this.extraFields[S]={id:S,length:v,value:y};d.setIndex(b)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=p.utf8decode(this.fileName),this.fileCommentStr=p.utf8decode(this.fileComment);else{var S=this.findExtraFieldUnicodePath();if(S!==null)this.fileNameStr=S;else{var v=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(v)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var b=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var S=s(d.value);return S.readInt(1)!==1||c(this.fileName)!==S.readInt(4)?null:p.utf8decode(S.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var S=s(d.value);return S.readInt(1)!==1||c(this.fileComment)!==S.readInt(4)?null:p.utf8decode(S.readData(d.length-5))}return null}},i.exports=w},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,a){function s(S,v,y){this.name=S,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=v,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var o=t("./stream/StreamHelper"),l=t("./stream/DataWorker"),c=t("./utf8"),p=t("./compressedObject"),g=t("./stream/GenericWorker");s.prototype={internalStream:function(S){var v=null,y="string";try{if(!S)throw new Error("No output type specified.");var b=(y=S.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),v=this._decompressWorker();var M=!this._dataBinary;M&&!b&&(v=v.pipe(new c.Utf8EncodeWorker)),!M&&b&&(v=v.pipe(new c.Utf8DecodeWorker))}catch(L){(v=new g("error")).error(L)}return new o(v,y,"")},async:function(S,v){return this.internalStream(S).accumulate(v)},nodeStream:function(S,v){return this.internalStream(S||"nodebuffer").toNodejsStream(v)},_compressWorker:function(S,v){if(this._data instanceof p&&this._data.compression.magic===S.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new c.Utf8EncodeWorker)),p.createWorkerFrom(y,S,v)},_decompressWorker:function(){return this._data instanceof p?this._data.getContentWorker():this._data instanceof g?this._data:new l(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],w=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=w;i.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,a){(function(s){var o,l,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var p=0,g=new c(S),h=s.document.createTextNode("");g.observe(h,{characterData:!0}),o=function(){h.data=p=++p%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var v=s.document.createElement("script");v.onreadystatechange=function(){S(),v.onreadystatechange=null,v.parentNode.removeChild(v),v=null},s.document.documentElement.appendChild(v)}:function(){setTimeout(S,0)};else{var w=new s.MessageChannel;w.port1.onmessage=S,o=function(){w.port2.postMessage(0)}}var d=[];function S(){var v,y;l=!0;for(var b=d.length;b;){for(y=d,d=[],v=-1;++v<b;)y[v]();b=d.length}l=!1}i.exports=function(v){d.push(v)!==1||l||o()}}).call(this,typeof Sr<"u"?Sr:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,a){var s=t("immediate");function o(){}var l={},c=["REJECTED"],p=["FULFILLED"],g=["PENDING"];function h(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,b!==o&&v(this,b)}function w(b,M,L){this.promise=b,typeof M=="function"&&(this.onFulfilled=M,this.callFulfilled=this.otherCallFulfilled),typeof L=="function"&&(this.onRejected=L,this.callRejected=this.otherCallRejected)}function d(b,M,L){s(function(){var z;try{z=M(L)}catch(x){return l.reject(b,x)}z===b?l.reject(b,new TypeError("Cannot resolve promise with itself")):l.resolve(b,z)})}function S(b){var M=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof M=="function")return function(){M.apply(b,arguments)}}function v(b,M){var L=!1;function z(H){L||(L=!0,l.reject(b,H))}function x(H){L||(L=!0,l.resolve(b,H))}var W=y(function(){M(x,z)});W.status==="error"&&z(W.value)}function y(b,M){var L={};try{L.value=b(M),L.status="success"}catch(z){L.status="error",L.value=z}return L}(i.exports=h).prototype.finally=function(b){if(typeof b!="function")return this;var M=this.constructor;return this.then(function(L){return M.resolve(b()).then(function(){return L})},function(L){return M.resolve(b()).then(function(){throw L})})},h.prototype.catch=function(b){return this.then(null,b)},h.prototype.then=function(b,M){if(typeof b!="function"&&this.state===p||typeof M!="function"&&this.state===c)return this;var L=new this.constructor(o);return this.state!==g?d(L,this.state===p?b:M,this.outcome):this.queue.push(new w(L,b,M)),L},w.prototype.callFulfilled=function(b){l.resolve(this.promise,b)},w.prototype.otherCallFulfilled=function(b){d(this.promise,this.onFulfilled,b)},w.prototype.callRejected=function(b){l.reject(this.promise,b)},w.prototype.otherCallRejected=function(b){d(this.promise,this.onRejected,b)},l.resolve=function(b,M){var L=y(S,M);if(L.status==="error")return l.reject(b,L.value);var z=L.value;if(z)v(b,z);else{b.state=p,b.outcome=M;for(var x=-1,W=b.queue.length;++x<W;)b.queue[x].callFulfilled(M)}return b},l.reject=function(b,M){b.state=c,b.outcome=M;for(var L=-1,z=b.queue.length;++L<z;)b.queue[L].callRejected(M);return b},h.resolve=function(b){return b instanceof this?b:l.resolve(new this(o),b)},h.reject=function(b){var M=new this(o);return l.reject(M,b)},h.all=function(b){var M=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=b.length,z=!1;if(!L)return this.resolve([]);for(var x=new Array(L),W=0,H=-1,K=new this(o);++H<L;)G(b[H],H);return K;function G(ee,_e){M.resolve(ee).then(function(B){x[_e]=B,++W!==L||z||(z=!0,l.resolve(K,x))},function(B){z||(z=!0,l.reject(K,B))})}},h.race=function(b){var M=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=b.length,z=!1;if(!L)return this.resolve([]);for(var x=-1,W=new this(o);++x<L;)H=b[x],M.resolve(H).then(function(K){z||(z=!0,l.resolve(W,K))},function(K){z||(z=!0,l.reject(W,K))});var H;return W}},{immediate:36}],38:[function(t,i,a){var s={};(0,t("./lib/utils/common").assign)(s,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,a){var s=t("./zlib/deflate"),o=t("./utils/common"),l=t("./utils/strings"),c=t("./zlib/messages"),p=t("./zlib/zstream"),g=Object.prototype.toString,h=0,w=-1,d=0,S=8;function v(b){if(!(this instanceof v))return new v(b);this.options=o.assign({level:w,method:S,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},b||{});var M=this.options;M.raw&&0<M.windowBits?M.windowBits=-M.windowBits:M.gzip&&0<M.windowBits&&M.windowBits<16&&(M.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var L=s.deflateInit2(this.strm,M.level,M.method,M.windowBits,M.memLevel,M.strategy);if(L!==h)throw new Error(c[L]);if(M.header&&s.deflateSetHeader(this.strm,M.header),M.dictionary){var z;if(z=typeof M.dictionary=="string"?l.string2buf(M.dictionary):g.call(M.dictionary)==="[object ArrayBuffer]"?new Uint8Array(M.dictionary):M.dictionary,(L=s.deflateSetDictionary(this.strm,z))!==h)throw new Error(c[L]);this._dict_set=!0}}function y(b,M){var L=new v(M);if(L.push(b,!0),L.err)throw L.msg||c[L.err];return L.result}v.prototype.push=function(b,M){var L,z,x=this.strm,W=this.options.chunkSize;if(this.ended)return!1;z=M===~~M?M:M===!0?4:0,typeof b=="string"?x.input=l.string2buf(b):g.call(b)==="[object ArrayBuffer]"?x.input=new Uint8Array(b):x.input=b,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(W),x.next_out=0,x.avail_out=W),(L=s.deflate(x,z))!==1&&L!==h)return this.onEnd(L),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||z!==4&&z!==2)||(this.options.to==="string"?this.onData(l.buf2binstring(o.shrinkBuf(x.output,x.next_out))):this.onData(o.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&L!==1);return z===4?(L=s.deflateEnd(this.strm),this.onEnd(L),this.ended=!0,L===h):z!==2||(this.onEnd(h),!(x.avail_out=0))},v.prototype.onData=function(b){this.chunks.push(b)},v.prototype.onEnd=function(b){b===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},a.Deflate=v,a.deflate=y,a.deflateRaw=function(b,M){return(M=M||{}).raw=!0,y(b,M)},a.gzip=function(b,M){return(M=M||{}).gzip=!0,y(b,M)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,a){var s=t("./zlib/inflate"),o=t("./utils/common"),l=t("./utils/strings"),c=t("./zlib/constants"),p=t("./zlib/messages"),g=t("./zlib/zstream"),h=t("./zlib/gzheader"),w=Object.prototype.toString;function d(v){if(!(this instanceof d))return new d(v);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},v||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||v&&v.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;var b=s.inflateInit2(this.strm,y.windowBits);if(b!==c.Z_OK)throw new Error(p[b]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function S(v,y){var b=new d(y);if(b.push(v,!0),b.err)throw b.msg||p[b.err];return b.result}d.prototype.push=function(v,y){var b,M,L,z,x,W,H=this.strm,K=this.options.chunkSize,G=this.options.dictionary,ee=!1;if(this.ended)return!1;M=y===~~y?y:y===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof v=="string"?H.input=l.binstring2buf(v):w.call(v)==="[object ArrayBuffer]"?H.input=new Uint8Array(v):H.input=v,H.next_in=0,H.avail_in=H.input.length;do{if(H.avail_out===0&&(H.output=new o.Buf8(K),H.next_out=0,H.avail_out=K),(b=s.inflate(H,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&G&&(W=typeof G=="string"?l.string2buf(G):w.call(G)==="[object ArrayBuffer]"?new Uint8Array(G):G,b=s.inflateSetDictionary(this.strm,W)),b===c.Z_BUF_ERROR&&ee===!0&&(b=c.Z_OK,ee=!1),b!==c.Z_STREAM_END&&b!==c.Z_OK)return this.onEnd(b),!(this.ended=!0);H.next_out&&(H.avail_out!==0&&b!==c.Z_STREAM_END&&(H.avail_in!==0||M!==c.Z_FINISH&&M!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(L=l.utf8border(H.output,H.next_out),z=H.next_out-L,x=l.buf2string(H.output,L),H.next_out=z,H.avail_out=K-z,z&&o.arraySet(H.output,H.output,L,z,0),this.onData(x)):this.onData(o.shrinkBuf(H.output,H.next_out)))),H.avail_in===0&&H.avail_out===0&&(ee=!0)}while((0<H.avail_in||H.avail_out===0)&&b!==c.Z_STREAM_END);return b===c.Z_STREAM_END&&(M=c.Z_FINISH),M===c.Z_FINISH?(b=s.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===c.Z_OK):M!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(H.avail_out=0))},d.prototype.onData=function(v){this.chunks.push(v)},d.prototype.onEnd=function(v){v===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},a.Inflate=d,a.inflate=S,a.inflateRaw=function(v,y){return(y=y||{}).raw=!0,S(v,y)},a.ungzip=S},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,a){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(c){for(var p=Array.prototype.slice.call(arguments,1);p.length;){var g=p.shift();if(g){if(typeof g!="object")throw new TypeError(g+"must be non-object");for(var h in g)g.hasOwnProperty(h)&&(c[h]=g[h])}}return c},a.shrinkBuf=function(c,p){return c.length===p?c:c.subarray?c.subarray(0,p):(c.length=p,c)};var o={arraySet:function(c,p,g,h,w){if(p.subarray&&c.subarray)c.set(p.subarray(g,g+h),w);else for(var d=0;d<h;d++)c[w+d]=p[g+d]},flattenChunks:function(c){var p,g,h,w,d,S;for(p=h=0,g=c.length;p<g;p++)h+=c[p].length;for(S=new Uint8Array(h),p=w=0,g=c.length;p<g;p++)d=c[p],S.set(d,w),w+=d.length;return S}},l={arraySet:function(c,p,g,h,w){for(var d=0;d<h;d++)c[w+d]=p[g+d]},flattenChunks:function(c){return[].concat.apply([],c)}};a.setTyped=function(c){c?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,o)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,l))},a.setTyped(s)},{}],42:[function(t,i,a){var s=t("./common"),o=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}for(var c=new s.Buf8(256),p=0;p<256;p++)c[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;function g(h,w){if(w<65537&&(h.subarray&&l||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,w));for(var d="",S=0;S<w;S++)d+=String.fromCharCode(h[S]);return d}c[254]=c[254]=1,a.string2buf=function(h){var w,d,S,v,y,b=h.length,M=0;for(v=0;v<b;v++)(64512&(d=h.charCodeAt(v)))==55296&&v+1<b&&(64512&(S=h.charCodeAt(v+1)))==56320&&(d=65536+(d-55296<<10)+(S-56320),v++),M+=d<128?1:d<2048?2:d<65536?3:4;for(w=new s.Buf8(M),v=y=0;y<M;v++)(64512&(d=h.charCodeAt(v)))==55296&&v+1<b&&(64512&(S=h.charCodeAt(v+1)))==56320&&(d=65536+(d-55296<<10)+(S-56320),v++),d<128?w[y++]=d:(d<2048?w[y++]=192|d>>>6:(d<65536?w[y++]=224|d>>>12:(w[y++]=240|d>>>18,w[y++]=128|d>>>12&63),w[y++]=128|d>>>6&63),w[y++]=128|63&d);return w},a.buf2binstring=function(h){return g(h,h.length)},a.binstring2buf=function(h){for(var w=new s.Buf8(h.length),d=0,S=w.length;d<S;d++)w[d]=h.charCodeAt(d);return w},a.buf2string=function(h,w){var d,S,v,y,b=w||h.length,M=new Array(2*b);for(d=S=0;d<b;)if((v=h[d++])<128)M[S++]=v;else if(4<(y=c[v]))M[S++]=65533,d+=y-1;else{for(v&=y===2?31:y===3?15:7;1<y&&d<b;)v=v<<6|63&h[d++],y--;1<y?M[S++]=65533:v<65536?M[S++]=v:(v-=65536,M[S++]=55296|v>>10&1023,M[S++]=56320|1023&v)}return g(M,S)},a.utf8border=function(h,w){var d;for((w=w||h.length)>h.length&&(w=h.length),d=w-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?w:d+c[h[d]]>w?d:w}},{"./common":41}],43:[function(t,i,a){i.exports=function(s,o,l,c){for(var p=65535&s|0,g=s>>>16&65535|0,h=0;l!==0;){for(l-=h=2e3<l?2e3:l;g=g+(p=p+o[c++]|0)|0,--h;);p%=65521,g%=65521}return p|g<<16|0}},{}],44:[function(t,i,a){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,a){var s=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var p=0;p<8;p++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();i.exports=function(o,l,c,p){var g=s,h=p+c;o^=-1;for(var w=p;w<h;w++)o=o>>>8^g[255&(o^l[w])];return-1^o}},{}],46:[function(t,i,a){var s,o=t("../utils/common"),l=t("./trees"),c=t("./adler32"),p=t("./crc32"),g=t("./messages"),h=0,w=4,d=0,S=-2,v=-1,y=4,b=2,M=8,L=9,z=286,x=30,W=19,H=2*z+1,K=15,G=3,ee=258,_e=ee+G+1,B=42,q=113,_=1,$=2,Me=3,ie=4;function xe(f,Q){return f.msg=g[Q],Q}function le(f){return(f<<1)-(4<f?9:0)}function Te(f){for(var Q=f.length;0<=--Q;)f[Q]=0}function Y(f){var Q=f.state,Z=Q.pending;Z>f.avail_out&&(Z=f.avail_out),Z!==0&&(o.arraySet(f.output,Q.pending_buf,Q.pending_out,Z,f.next_out),f.next_out+=Z,Q.pending_out+=Z,f.total_out+=Z,f.avail_out-=Z,Q.pending-=Z,Q.pending===0&&(Q.pending_out=0))}function X(f,Q){l._tr_flush_block(f,0<=f.block_start?f.block_start:-1,f.strstart-f.block_start,Q),f.block_start=f.strstart,Y(f.strm)}function ve(f,Q){f.pending_buf[f.pending++]=Q}function me(f,Q){f.pending_buf[f.pending++]=Q>>>8&255,f.pending_buf[f.pending++]=255&Q}function fe(f,Q){var Z,D,E=f.max_chain_length,U=f.strstart,te=f.prev_length,re=f.nice_match,V=f.strstart>f.w_size-_e?f.strstart-(f.w_size-_e):0,ce=f.window,pe=f.w_mask,se=f.prev,we=f.strstart+ee,Xe=ce[U+te-1],Ae=ce[U+te];f.prev_length>=f.good_match&&(E>>=2),re>f.lookahead&&(re=f.lookahead);do if(ce[(Z=Q)+te]===Ae&&ce[Z+te-1]===Xe&&ce[Z]===ce[U]&&ce[++Z]===ce[U+1]){U+=2,Z++;do;while(ce[++U]===ce[++Z]&&ce[++U]===ce[++Z]&&ce[++U]===ce[++Z]&&ce[++U]===ce[++Z]&&ce[++U]===ce[++Z]&&ce[++U]===ce[++Z]&&ce[++U]===ce[++Z]&&ce[++U]===ce[++Z]&&U<we);if(D=ee-(we-U),U=we-ee,te<D){if(f.match_start=Q,re<=(te=D))break;Xe=ce[U+te-1],Ae=ce[U+te]}}while((Q=se[Q&pe])>V&&--E!=0);return te<=f.lookahead?te:f.lookahead}function Ce(f){var Q,Z,D,E,U,te,re,V,ce,pe,se=f.w_size;do{if(E=f.window_size-f.lookahead-f.strstart,f.strstart>=se+(se-_e)){for(o.arraySet(f.window,f.window,se,se,0),f.match_start-=se,f.strstart-=se,f.block_start-=se,Q=Z=f.hash_size;D=f.head[--Q],f.head[Q]=se<=D?D-se:0,--Z;);for(Q=Z=se;D=f.prev[--Q],f.prev[Q]=se<=D?D-se:0,--Z;);E+=se}if(f.strm.avail_in===0)break;if(te=f.strm,re=f.window,V=f.strstart+f.lookahead,ce=E,pe=void 0,pe=te.avail_in,ce<pe&&(pe=ce),Z=pe===0?0:(te.avail_in-=pe,o.arraySet(re,te.input,te.next_in,pe,V),te.state.wrap===1?te.adler=c(te.adler,re,pe,V):te.state.wrap===2&&(te.adler=p(te.adler,re,pe,V)),te.next_in+=pe,te.total_in+=pe,pe),f.lookahead+=Z,f.lookahead+f.insert>=G)for(U=f.strstart-f.insert,f.ins_h=f.window[U],f.ins_h=(f.ins_h<<f.hash_shift^f.window[U+1])&f.hash_mask;f.insert&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[U+G-1])&f.hash_mask,f.prev[U&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=U,U++,f.insert--,!(f.lookahead+f.insert<G)););}while(f.lookahead<_e&&f.strm.avail_in!==0)}function lt(f,Q){for(var Z,D;;){if(f.lookahead<_e){if(Ce(f),f.lookahead<_e&&Q===h)return _;if(f.lookahead===0)break}if(Z=0,f.lookahead>=G&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+G-1])&f.hash_mask,Z=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),Z!==0&&f.strstart-Z<=f.w_size-_e&&(f.match_length=fe(f,Z)),f.match_length>=G)if(D=l._tr_tally(f,f.strstart-f.match_start,f.match_length-G),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=G){for(f.match_length--;f.strstart++,f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+G-1])&f.hash_mask,Z=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart,--f.match_length!=0;);f.strstart++}else f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+1])&f.hash_mask;else D=l._tr_tally(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++;if(D&&(X(f,!1),f.strm.avail_out===0))return _}return f.insert=f.strstart<G-1?f.strstart:G-1,Q===w?(X(f,!0),f.strm.avail_out===0?Me:ie):f.last_lit&&(X(f,!1),f.strm.avail_out===0)?_:$}function Be(f,Q){for(var Z,D,E;;){if(f.lookahead<_e){if(Ce(f),f.lookahead<_e&&Q===h)return _;if(f.lookahead===0)break}if(Z=0,f.lookahead>=G&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+G-1])&f.hash_mask,Z=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),f.prev_length=f.match_length,f.prev_match=f.match_start,f.match_length=G-1,Z!==0&&f.prev_length<f.max_lazy_match&&f.strstart-Z<=f.w_size-_e&&(f.match_length=fe(f,Z),f.match_length<=5&&(f.strategy===1||f.match_length===G&&4096<f.strstart-f.match_start)&&(f.match_length=G-1)),f.prev_length>=G&&f.match_length<=f.prev_length){for(E=f.strstart+f.lookahead-G,D=l._tr_tally(f,f.strstart-1-f.prev_match,f.prev_length-G),f.lookahead-=f.prev_length-1,f.prev_length-=2;++f.strstart<=E&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+G-1])&f.hash_mask,Z=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),--f.prev_length!=0;);if(f.match_available=0,f.match_length=G-1,f.strstart++,D&&(X(f,!1),f.strm.avail_out===0))return _}else if(f.match_available){if((D=l._tr_tally(f,0,f.window[f.strstart-1]))&&X(f,!1),f.strstart++,f.lookahead--,f.strm.avail_out===0)return _}else f.match_available=1,f.strstart++,f.lookahead--}return f.match_available&&(D=l._tr_tally(f,0,f.window[f.strstart-1]),f.match_available=0),f.insert=f.strstart<G-1?f.strstart:G-1,Q===w?(X(f,!0),f.strm.avail_out===0?Me:ie):f.last_lit&&(X(f,!1),f.strm.avail_out===0)?_:$}function Ne(f,Q,Z,D,E){this.good_length=f,this.max_lazy=Q,this.nice_length=Z,this.max_chain=D,this.func=E}function $e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*H),this.dyn_dtree=new o.Buf16(2*(2*x+1)),this.bl_tree=new o.Buf16(2*(2*W+1)),Te(this.dyn_ltree),Te(this.dyn_dtree),Te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(K+1),this.heap=new o.Buf16(2*z+1),Te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*z+1),Te(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function et(f){var Q;return f&&f.state?(f.total_in=f.total_out=0,f.data_type=b,(Q=f.state).pending=0,Q.pending_out=0,Q.wrap<0&&(Q.wrap=-Q.wrap),Q.status=Q.wrap?B:q,f.adler=Q.wrap===2?0:1,Q.last_flush=h,l._tr_init(Q),d):xe(f,S)}function Tt(f){var Q=et(f);return Q===d&&function(Z){Z.window_size=2*Z.w_size,Te(Z.head),Z.max_lazy_match=s[Z.level].max_lazy,Z.good_match=s[Z.level].good_length,Z.nice_match=s[Z.level].nice_length,Z.max_chain_length=s[Z.level].max_chain,Z.strstart=0,Z.block_start=0,Z.lookahead=0,Z.insert=0,Z.match_length=Z.prev_length=G-1,Z.match_available=0,Z.ins_h=0}(f.state),Q}function kt(f,Q,Z,D,E,U){if(!f)return S;var te=1;if(Q===v&&(Q=6),D<0?(te=0,D=-D):15<D&&(te=2,D-=16),E<1||L<E||Z!==M||D<8||15<D||Q<0||9<Q||U<0||y<U)return xe(f,S);D===8&&(D=9);var re=new $e;return(f.state=re).strm=f,re.wrap=te,re.gzhead=null,re.w_bits=D,re.w_size=1<<re.w_bits,re.w_mask=re.w_size-1,re.hash_bits=E+7,re.hash_size=1<<re.hash_bits,re.hash_mask=re.hash_size-1,re.hash_shift=~~((re.hash_bits+G-1)/G),re.window=new o.Buf8(2*re.w_size),re.head=new o.Buf16(re.hash_size),re.prev=new o.Buf16(re.w_size),re.lit_bufsize=1<<E+6,re.pending_buf_size=4*re.lit_bufsize,re.pending_buf=new o.Buf8(re.pending_buf_size),re.d_buf=1*re.lit_bufsize,re.l_buf=3*re.lit_bufsize,re.level=Q,re.strategy=U,re.method=Z,Tt(f)}s=[new Ne(0,0,0,0,function(f,Q){var Z=65535;for(Z>f.pending_buf_size-5&&(Z=f.pending_buf_size-5);;){if(f.lookahead<=1){if(Ce(f),f.lookahead===0&&Q===h)return _;if(f.lookahead===0)break}f.strstart+=f.lookahead,f.lookahead=0;var D=f.block_start+Z;if((f.strstart===0||f.strstart>=D)&&(f.lookahead=f.strstart-D,f.strstart=D,X(f,!1),f.strm.avail_out===0)||f.strstart-f.block_start>=f.w_size-_e&&(X(f,!1),f.strm.avail_out===0))return _}return f.insert=0,Q===w?(X(f,!0),f.strm.avail_out===0?Me:ie):(f.strstart>f.block_start&&(X(f,!1),f.strm.avail_out),_)}),new Ne(4,4,8,4,lt),new Ne(4,5,16,8,lt),new Ne(4,6,32,32,lt),new Ne(4,4,16,16,Be),new Ne(8,16,32,32,Be),new Ne(8,16,128,128,Be),new Ne(8,32,128,256,Be),new Ne(32,128,258,1024,Be),new Ne(32,258,258,4096,Be)],a.deflateInit=function(f,Q){return kt(f,Q,M,15,8,0)},a.deflateInit2=kt,a.deflateReset=Tt,a.deflateResetKeep=et,a.deflateSetHeader=function(f,Q){return f&&f.state?f.state.wrap!==2?S:(f.state.gzhead=Q,d):S},a.deflate=function(f,Q){var Z,D,E,U;if(!f||!f.state||5<Q||Q<0)return f?xe(f,S):S;if(D=f.state,!f.output||!f.input&&f.avail_in!==0||D.status===666&&Q!==w)return xe(f,f.avail_out===0?-5:S);if(D.strm=f,Z=D.last_flush,D.last_flush=Q,D.status===B)if(D.wrap===2)f.adler=0,ve(D,31),ve(D,139),ve(D,8),D.gzhead?(ve(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),ve(D,255&D.gzhead.time),ve(D,D.gzhead.time>>8&255),ve(D,D.gzhead.time>>16&255),ve(D,D.gzhead.time>>24&255),ve(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),ve(D,255&D.gzhead.os),D.gzhead.extra&&D.gzhead.extra.length&&(ve(D,255&D.gzhead.extra.length),ve(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(f.adler=p(f.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=69):(ve(D,0),ve(D,0),ve(D,0),ve(D,0),ve(D,0),ve(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),ve(D,3),D.status=q);else{var te=M+(D.w_bits-8<<4)<<8;te|=(2<=D.strategy||D.level<2?0:D.level<6?1:D.level===6?2:3)<<6,D.strstart!==0&&(te|=32),te+=31-te%31,D.status=q,me(D,te),D.strstart!==0&&(me(D,f.adler>>>16),me(D,65535&f.adler)),f.adler=1}if(D.status===69)if(D.gzhead.extra){for(E=D.pending;D.gzindex<(65535&D.gzhead.extra.length)&&(D.pending!==D.pending_buf_size||(D.gzhead.hcrc&&D.pending>E&&(f.adler=p(f.adler,D.pending_buf,D.pending-E,E)),Y(f),E=D.pending,D.pending!==D.pending_buf_size));)ve(D,255&D.gzhead.extra[D.gzindex]),D.gzindex++;D.gzhead.hcrc&&D.pending>E&&(f.adler=p(f.adler,D.pending_buf,D.pending-E,E)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=73)}else D.status=73;if(D.status===73)if(D.gzhead.name){E=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>E&&(f.adler=p(f.adler,D.pending_buf,D.pending-E,E)),Y(f),E=D.pending,D.pending===D.pending_buf_size)){U=1;break}U=D.gzindex<D.gzhead.name.length?255&D.gzhead.name.charCodeAt(D.gzindex++):0,ve(D,U)}while(U!==0);D.gzhead.hcrc&&D.pending>E&&(f.adler=p(f.adler,D.pending_buf,D.pending-E,E)),U===0&&(D.gzindex=0,D.status=91)}else D.status=91;if(D.status===91)if(D.gzhead.comment){E=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>E&&(f.adler=p(f.adler,D.pending_buf,D.pending-E,E)),Y(f),E=D.pending,D.pending===D.pending_buf_size)){U=1;break}U=D.gzindex<D.gzhead.comment.length?255&D.gzhead.comment.charCodeAt(D.gzindex++):0,ve(D,U)}while(U!==0);D.gzhead.hcrc&&D.pending>E&&(f.adler=p(f.adler,D.pending_buf,D.pending-E,E)),U===0&&(D.status=103)}else D.status=103;if(D.status===103&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&Y(f),D.pending+2<=D.pending_buf_size&&(ve(D,255&f.adler),ve(D,f.adler>>8&255),f.adler=0,D.status=q)):D.status=q),D.pending!==0){if(Y(f),f.avail_out===0)return D.last_flush=-1,d}else if(f.avail_in===0&&le(Q)<=le(Z)&&Q!==w)return xe(f,-5);if(D.status===666&&f.avail_in!==0)return xe(f,-5);if(f.avail_in!==0||D.lookahead!==0||Q!==h&&D.status!==666){var re=D.strategy===2?function(V,ce){for(var pe;;){if(V.lookahead===0&&(Ce(V),V.lookahead===0)){if(ce===h)return _;break}if(V.match_length=0,pe=l._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,pe&&(X(V,!1),V.strm.avail_out===0))return _}return V.insert=0,ce===w?(X(V,!0),V.strm.avail_out===0?Me:ie):V.last_lit&&(X(V,!1),V.strm.avail_out===0)?_:$}(D,Q):D.strategy===3?function(V,ce){for(var pe,se,we,Xe,Ae=V.window;;){if(V.lookahead<=ee){if(Ce(V),V.lookahead<=ee&&ce===h)return _;if(V.lookahead===0)break}if(V.match_length=0,V.lookahead>=G&&0<V.strstart&&(se=Ae[we=V.strstart-1])===Ae[++we]&&se===Ae[++we]&&se===Ae[++we]){Xe=V.strstart+ee;do;while(se===Ae[++we]&&se===Ae[++we]&&se===Ae[++we]&&se===Ae[++we]&&se===Ae[++we]&&se===Ae[++we]&&se===Ae[++we]&&se===Ae[++we]&&we<Xe);V.match_length=ee-(Xe-we),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=G?(pe=l._tr_tally(V,1,V.match_length-G),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(pe=l._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),pe&&(X(V,!1),V.strm.avail_out===0))return _}return V.insert=0,ce===w?(X(V,!0),V.strm.avail_out===0?Me:ie):V.last_lit&&(X(V,!1),V.strm.avail_out===0)?_:$}(D,Q):s[D.level].func(D,Q);if(re!==Me&&re!==ie||(D.status=666),re===_||re===Me)return f.avail_out===0&&(D.last_flush=-1),d;if(re===$&&(Q===1?l._tr_align(D):Q!==5&&(l._tr_stored_block(D,0,0,!1),Q===3&&(Te(D.head),D.lookahead===0&&(D.strstart=0,D.block_start=0,D.insert=0))),Y(f),f.avail_out===0))return D.last_flush=-1,d}return Q!==w?d:D.wrap<=0?1:(D.wrap===2?(ve(D,255&f.adler),ve(D,f.adler>>8&255),ve(D,f.adler>>16&255),ve(D,f.adler>>24&255),ve(D,255&f.total_in),ve(D,f.total_in>>8&255),ve(D,f.total_in>>16&255),ve(D,f.total_in>>24&255)):(me(D,f.adler>>>16),me(D,65535&f.adler)),Y(f),0<D.wrap&&(D.wrap=-D.wrap),D.pending!==0?d:1)},a.deflateEnd=function(f){var Q;return f&&f.state?(Q=f.state.status)!==B&&Q!==69&&Q!==73&&Q!==91&&Q!==103&&Q!==q&&Q!==666?xe(f,S):(f.state=null,Q===q?xe(f,-3):d):S},a.deflateSetDictionary=function(f,Q){var Z,D,E,U,te,re,V,ce,pe=Q.length;if(!f||!f.state||(U=(Z=f.state).wrap)===2||U===1&&Z.status!==B||Z.lookahead)return S;for(U===1&&(f.adler=c(f.adler,Q,pe,0)),Z.wrap=0,pe>=Z.w_size&&(U===0&&(Te(Z.head),Z.strstart=0,Z.block_start=0,Z.insert=0),ce=new o.Buf8(Z.w_size),o.arraySet(ce,Q,pe-Z.w_size,Z.w_size,0),Q=ce,pe=Z.w_size),te=f.avail_in,re=f.next_in,V=f.input,f.avail_in=pe,f.next_in=0,f.input=Q,Ce(Z);Z.lookahead>=G;){for(D=Z.strstart,E=Z.lookahead-(G-1);Z.ins_h=(Z.ins_h<<Z.hash_shift^Z.window[D+G-1])&Z.hash_mask,Z.prev[D&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=D,D++,--E;);Z.strstart=D,Z.lookahead=G-1,Ce(Z)}return Z.strstart+=Z.lookahead,Z.block_start=Z.strstart,Z.insert=Z.lookahead,Z.lookahead=0,Z.match_length=Z.prev_length=G-1,Z.match_available=0,f.next_in=re,f.input=V,f.avail_in=te,Z.wrap=U,d},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,a){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,a){i.exports=function(s,o){var l,c,p,g,h,w,d,S,v,y,b,M,L,z,x,W,H,K,G,ee,_e,B,q,_,$;l=s.state,c=s.next_in,_=s.input,p=c+(s.avail_in-5),g=s.next_out,$=s.output,h=g-(o-s.avail_out),w=g+(s.avail_out-257),d=l.dmax,S=l.wsize,v=l.whave,y=l.wnext,b=l.window,M=l.hold,L=l.bits,z=l.lencode,x=l.distcode,W=(1<<l.lenbits)-1,H=(1<<l.distbits)-1;e:do{L<15&&(M+=_[c++]<<L,L+=8,M+=_[c++]<<L,L+=8),K=z[M&W];t:for(;;){if(M>>>=G=K>>>24,L-=G,(G=K>>>16&255)===0)$[g++]=65535&K;else{if(!(16&G)){if(!(64&G)){K=z[(65535&K)+(M&(1<<G)-1)];continue t}if(32&G){l.mode=12;break e}s.msg="invalid literal/length code",l.mode=30;break e}ee=65535&K,(G&=15)&&(L<G&&(M+=_[c++]<<L,L+=8),ee+=M&(1<<G)-1,M>>>=G,L-=G),L<15&&(M+=_[c++]<<L,L+=8,M+=_[c++]<<L,L+=8),K=x[M&H];r:for(;;){if(M>>>=G=K>>>24,L-=G,!(16&(G=K>>>16&255))){if(!(64&G)){K=x[(65535&K)+(M&(1<<G)-1)];continue r}s.msg="invalid distance code",l.mode=30;break e}if(_e=65535&K,L<(G&=15)&&(M+=_[c++]<<L,(L+=8)<G&&(M+=_[c++]<<L,L+=8)),d<(_e+=M&(1<<G)-1)){s.msg="invalid distance too far back",l.mode=30;break e}if(M>>>=G,L-=G,(G=g-h)<_e){if(v<(G=_e-G)&&l.sane){s.msg="invalid distance too far back",l.mode=30;break e}if(q=b,(B=0)===y){if(B+=S-G,G<ee){for(ee-=G;$[g++]=b[B++],--G;);B=g-_e,q=$}}else if(y<G){if(B+=S+y-G,(G-=y)<ee){for(ee-=G;$[g++]=b[B++],--G;);if(B=0,y<ee){for(ee-=G=y;$[g++]=b[B++],--G;);B=g-_e,q=$}}}else if(B+=y-G,G<ee){for(ee-=G;$[g++]=b[B++],--G;);B=g-_e,q=$}for(;2<ee;)$[g++]=q[B++],$[g++]=q[B++],$[g++]=q[B++],ee-=3;ee&&($[g++]=q[B++],1<ee&&($[g++]=q[B++]))}else{for(B=g-_e;$[g++]=$[B++],$[g++]=$[B++],$[g++]=$[B++],2<(ee-=3););ee&&($[g++]=$[B++],1<ee&&($[g++]=$[B++]))}break}}break}}while(c<p&&g<w);c-=ee=L>>3,M&=(1<<(L-=ee<<3))-1,s.next_in=c,s.next_out=g,s.avail_in=c<p?p-c+5:5-(c-p),s.avail_out=g<w?w-g+257:257-(g-w),l.hold=M,l.bits=L}},{}],49:[function(t,i,a){var s=t("../utils/common"),o=t("./adler32"),l=t("./crc32"),c=t("./inffast"),p=t("./inftrees"),g=1,h=2,w=0,d=-2,S=1,v=852,y=592;function b(B){return(B>>>24&255)+(B>>>8&65280)+((65280&B)<<8)+((255&B)<<24)}function M(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function L(B){var q;return B&&B.state?(q=B.state,B.total_in=B.total_out=q.total=0,B.msg="",q.wrap&&(B.adler=1&q.wrap),q.mode=S,q.last=0,q.havedict=0,q.dmax=32768,q.head=null,q.hold=0,q.bits=0,q.lencode=q.lendyn=new s.Buf32(v),q.distcode=q.distdyn=new s.Buf32(y),q.sane=1,q.back=-1,w):d}function z(B){var q;return B&&B.state?((q=B.state).wsize=0,q.whave=0,q.wnext=0,L(B)):d}function x(B,q){var _,$;return B&&B.state?($=B.state,q<0?(_=0,q=-q):(_=1+(q>>4),q<48&&(q&=15)),q&&(q<8||15<q)?d:($.window!==null&&$.wbits!==q&&($.window=null),$.wrap=_,$.wbits=q,z(B))):d}function W(B,q){var _,$;return B?($=new M,(B.state=$).window=null,(_=x(B,q))!==w&&(B.state=null),_):d}var H,K,G=!0;function ee(B){if(G){var q;for(H=new s.Buf32(512),K=new s.Buf32(32),q=0;q<144;)B.lens[q++]=8;for(;q<256;)B.lens[q++]=9;for(;q<280;)B.lens[q++]=7;for(;q<288;)B.lens[q++]=8;for(p(g,B.lens,0,288,H,0,B.work,{bits:9}),q=0;q<32;)B.lens[q++]=5;p(h,B.lens,0,32,K,0,B.work,{bits:5}),G=!1}B.lencode=H,B.lenbits=9,B.distcode=K,B.distbits=5}function _e(B,q,_,$){var Me,ie=B.state;return ie.window===null&&(ie.wsize=1<<ie.wbits,ie.wnext=0,ie.whave=0,ie.window=new s.Buf8(ie.wsize)),$>=ie.wsize?(s.arraySet(ie.window,q,_-ie.wsize,ie.wsize,0),ie.wnext=0,ie.whave=ie.wsize):($<(Me=ie.wsize-ie.wnext)&&(Me=$),s.arraySet(ie.window,q,_-$,Me,ie.wnext),($-=Me)?(s.arraySet(ie.window,q,_-$,$,0),ie.wnext=$,ie.whave=ie.wsize):(ie.wnext+=Me,ie.wnext===ie.wsize&&(ie.wnext=0),ie.whave<ie.wsize&&(ie.whave+=Me))),0}a.inflateReset=z,a.inflateReset2=x,a.inflateResetKeep=L,a.inflateInit=function(B){return W(B,15)},a.inflateInit2=W,a.inflate=function(B,q){var _,$,Me,ie,xe,le,Te,Y,X,ve,me,fe,Ce,lt,Be,Ne,$e,et,Tt,kt,f,Q,Z,D,E=0,U=new s.Buf8(4),te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!B||!B.state||!B.output||!B.input&&B.avail_in!==0)return d;(_=B.state).mode===12&&(_.mode=13),xe=B.next_out,Me=B.output,Te=B.avail_out,ie=B.next_in,$=B.input,le=B.avail_in,Y=_.hold,X=_.bits,ve=le,me=Te,Q=w;e:for(;;)switch(_.mode){case S:if(_.wrap===0){_.mode=13;break}for(;X<16;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}if(2&_.wrap&&Y===35615){U[_.check=0]=255&Y,U[1]=Y>>>8&255,_.check=l(_.check,U,2,0),X=Y=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&Y)<<8)+(Y>>8))%31){B.msg="incorrect header check",_.mode=30;break}if((15&Y)!=8){B.msg="unknown compression method",_.mode=30;break}if(X-=4,f=8+(15&(Y>>>=4)),_.wbits===0)_.wbits=f;else if(f>_.wbits){B.msg="invalid window size",_.mode=30;break}_.dmax=1<<f,B.adler=_.check=1,_.mode=512&Y?10:12,X=Y=0;break;case 2:for(;X<16;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}if(_.flags=Y,(255&_.flags)!=8){B.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){B.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=Y>>8&1),512&_.flags&&(U[0]=255&Y,U[1]=Y>>>8&255,_.check=l(_.check,U,2,0)),X=Y=0,_.mode=3;case 3:for(;X<32;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}_.head&&(_.head.time=Y),512&_.flags&&(U[0]=255&Y,U[1]=Y>>>8&255,U[2]=Y>>>16&255,U[3]=Y>>>24&255,_.check=l(_.check,U,4,0)),X=Y=0,_.mode=4;case 4:for(;X<16;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}_.head&&(_.head.xflags=255&Y,_.head.os=Y>>8),512&_.flags&&(U[0]=255&Y,U[1]=Y>>>8&255,_.check=l(_.check,U,2,0)),X=Y=0,_.mode=5;case 5:if(1024&_.flags){for(;X<16;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}_.length=Y,_.head&&(_.head.extra_len=Y),512&_.flags&&(U[0]=255&Y,U[1]=Y>>>8&255,_.check=l(_.check,U,2,0)),X=Y=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(le<(fe=_.length)&&(fe=le),fe&&(_.head&&(f=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),s.arraySet(_.head.extra,$,ie,fe,f)),512&_.flags&&(_.check=l(_.check,$,fe,ie)),le-=fe,ie+=fe,_.length-=fe),_.length))break e;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(le===0)break e;for(fe=0;f=$[ie+fe++],_.head&&f&&_.length<65536&&(_.head.name+=String.fromCharCode(f)),f&&fe<le;);if(512&_.flags&&(_.check=l(_.check,$,fe,ie)),le-=fe,ie+=fe,f)break e}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(le===0)break e;for(fe=0;f=$[ie+fe++],_.head&&f&&_.length<65536&&(_.head.comment+=String.fromCharCode(f)),f&&fe<le;);if(512&_.flags&&(_.check=l(_.check,$,fe,ie)),le-=fe,ie+=fe,f)break e}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;X<16;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}if(Y!==(65535&_.check)){B.msg="header crc mismatch",_.mode=30;break}X=Y=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),B.adler=_.check=0,_.mode=12;break;case 10:for(;X<32;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}B.adler=_.check=b(Y),X=Y=0,_.mode=11;case 11:if(_.havedict===0)return B.next_out=xe,B.avail_out=Te,B.next_in=ie,B.avail_in=le,_.hold=Y,_.bits=X,2;B.adler=_.check=1,_.mode=12;case 12:if(q===5||q===6)break e;case 13:if(_.last){Y>>>=7&X,X-=7&X,_.mode=27;break}for(;X<3;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}switch(_.last=1&Y,X-=1,3&(Y>>>=1)){case 0:_.mode=14;break;case 1:if(ee(_),_.mode=20,q!==6)break;Y>>>=2,X-=2;break e;case 2:_.mode=17;break;case 3:B.msg="invalid block type",_.mode=30}Y>>>=2,X-=2;break;case 14:for(Y>>>=7&X,X-=7&X;X<32;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}if((65535&Y)!=(Y>>>16^65535)){B.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&Y,X=Y=0,_.mode=15,q===6)break e;case 15:_.mode=16;case 16:if(fe=_.length){if(le<fe&&(fe=le),Te<fe&&(fe=Te),fe===0)break e;s.arraySet(Me,$,ie,fe,xe),le-=fe,ie+=fe,Te-=fe,xe+=fe,_.length-=fe;break}_.mode=12;break;case 17:for(;X<14;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}if(_.nlen=257+(31&Y),Y>>>=5,X-=5,_.ndist=1+(31&Y),Y>>>=5,X-=5,_.ncode=4+(15&Y),Y>>>=4,X-=4,286<_.nlen||30<_.ndist){B.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;X<3;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}_.lens[te[_.have++]]=7&Y,Y>>>=3,X-=3}for(;_.have<19;)_.lens[te[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,Z={bits:_.lenbits},Q=p(0,_.lens,0,19,_.lencode,0,_.work,Z),_.lenbits=Z.bits,Q){B.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;Ne=(E=_.lencode[Y&(1<<_.lenbits)-1])>>>16&255,$e=65535&E,!((Be=E>>>24)<=X);){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}if($e<16)Y>>>=Be,X-=Be,_.lens[_.have++]=$e;else{if($e===16){for(D=Be+2;X<D;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}if(Y>>>=Be,X-=Be,_.have===0){B.msg="invalid bit length repeat",_.mode=30;break}f=_.lens[_.have-1],fe=3+(3&Y),Y>>>=2,X-=2}else if($e===17){for(D=Be+3;X<D;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}X-=Be,f=0,fe=3+(7&(Y>>>=Be)),Y>>>=3,X-=3}else{for(D=Be+7;X<D;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}X-=Be,f=0,fe=11+(127&(Y>>>=Be)),Y>>>=7,X-=7}if(_.have+fe>_.nlen+_.ndist){B.msg="invalid bit length repeat",_.mode=30;break}for(;fe--;)_.lens[_.have++]=f}}if(_.mode===30)break;if(_.lens[256]===0){B.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,Z={bits:_.lenbits},Q=p(g,_.lens,0,_.nlen,_.lencode,0,_.work,Z),_.lenbits=Z.bits,Q){B.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,Z={bits:_.distbits},Q=p(h,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,Z),_.distbits=Z.bits,Q){B.msg="invalid distances set",_.mode=30;break}if(_.mode=20,q===6)break e;case 20:_.mode=21;case 21:if(6<=le&&258<=Te){B.next_out=xe,B.avail_out=Te,B.next_in=ie,B.avail_in=le,_.hold=Y,_.bits=X,c(B,me),xe=B.next_out,Me=B.output,Te=B.avail_out,ie=B.next_in,$=B.input,le=B.avail_in,Y=_.hold,X=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;Ne=(E=_.lencode[Y&(1<<_.lenbits)-1])>>>16&255,$e=65535&E,!((Be=E>>>24)<=X);){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}if(Ne&&!(240&Ne)){for(et=Be,Tt=Ne,kt=$e;Ne=(E=_.lencode[kt+((Y&(1<<et+Tt)-1)>>et)])>>>16&255,$e=65535&E,!(et+(Be=E>>>24)<=X);){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}Y>>>=et,X-=et,_.back+=et}if(Y>>>=Be,X-=Be,_.back+=Be,_.length=$e,Ne===0){_.mode=26;break}if(32&Ne){_.back=-1,_.mode=12;break}if(64&Ne){B.msg="invalid literal/length code",_.mode=30;break}_.extra=15&Ne,_.mode=22;case 22:if(_.extra){for(D=_.extra;X<D;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}_.length+=Y&(1<<_.extra)-1,Y>>>=_.extra,X-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;Ne=(E=_.distcode[Y&(1<<_.distbits)-1])>>>16&255,$e=65535&E,!((Be=E>>>24)<=X);){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}if(!(240&Ne)){for(et=Be,Tt=Ne,kt=$e;Ne=(E=_.distcode[kt+((Y&(1<<et+Tt)-1)>>et)])>>>16&255,$e=65535&E,!(et+(Be=E>>>24)<=X);){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}Y>>>=et,X-=et,_.back+=et}if(Y>>>=Be,X-=Be,_.back+=Be,64&Ne){B.msg="invalid distance code",_.mode=30;break}_.offset=$e,_.extra=15&Ne,_.mode=24;case 24:if(_.extra){for(D=_.extra;X<D;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}_.offset+=Y&(1<<_.extra)-1,Y>>>=_.extra,X-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){B.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(Te===0)break e;if(fe=me-Te,_.offset>fe){if((fe=_.offset-fe)>_.whave&&_.sane){B.msg="invalid distance too far back",_.mode=30;break}Ce=fe>_.wnext?(fe-=_.wnext,_.wsize-fe):_.wnext-fe,fe>_.length&&(fe=_.length),lt=_.window}else lt=Me,Ce=xe-_.offset,fe=_.length;for(Te<fe&&(fe=Te),Te-=fe,_.length-=fe;Me[xe++]=lt[Ce++],--fe;);_.length===0&&(_.mode=21);break;case 26:if(Te===0)break e;Me[xe++]=_.length,Te--,_.mode=21;break;case 27:if(_.wrap){for(;X<32;){if(le===0)break e;le--,Y|=$[ie++]<<X,X+=8}if(me-=Te,B.total_out+=me,_.total+=me,me&&(B.adler=_.check=_.flags?l(_.check,Me,me,xe-me):o(_.check,Me,me,xe-me)),me=Te,(_.flags?Y:b(Y))!==_.check){B.msg="incorrect data check",_.mode=30;break}X=Y=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;X<32;){if(le===0)break e;le--,Y+=$[ie++]<<X,X+=8}if(Y!==(4294967295&_.total)){B.msg="incorrect length check",_.mode=30;break}X=Y=0}_.mode=29;case 29:Q=1;break e;case 30:Q=-3;break e;case 31:return-4;case 32:default:return d}return B.next_out=xe,B.avail_out=Te,B.next_in=ie,B.avail_in=le,_.hold=Y,_.bits=X,(_.wsize||me!==B.avail_out&&_.mode<30&&(_.mode<27||q!==4))&&_e(B,B.output,B.next_out,me-B.avail_out)?(_.mode=31,-4):(ve-=B.avail_in,me-=B.avail_out,B.total_in+=ve,B.total_out+=me,_.total+=me,_.wrap&&me&&(B.adler=_.check=_.flags?l(_.check,Me,me,B.next_out-me):o(_.check,Me,me,B.next_out-me)),B.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(ve==0&&me===0||q===4)&&Q===w&&(Q=-5),Q)},a.inflateEnd=function(B){if(!B||!B.state)return d;var q=B.state;return q.window&&(q.window=null),B.state=null,w},a.inflateGetHeader=function(B,q){var _;return B&&B.state&&2&(_=B.state).wrap?((_.head=q).done=!1,w):d},a.inflateSetDictionary=function(B,q){var _,$=q.length;return B&&B.state?(_=B.state).wrap!==0&&_.mode!==11?d:_.mode===11&&o(1,q,$,0)!==_.check?-3:_e(B,q,$,$)?(_.mode=31,-4):(_.havedict=1,w):d},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,a){var s=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(g,h,w,d,S,v,y,b){var M,L,z,x,W,H,K,G,ee,_e=b.bits,B=0,q=0,_=0,$=0,Me=0,ie=0,xe=0,le=0,Te=0,Y=0,X=null,ve=0,me=new s.Buf16(16),fe=new s.Buf16(16),Ce=null,lt=0;for(B=0;B<=15;B++)me[B]=0;for(q=0;q<d;q++)me[h[w+q]]++;for(Me=_e,$=15;1<=$&&me[$]===0;$--);if($<Me&&(Me=$),$===0)return S[v++]=20971520,S[v++]=20971520,b.bits=1,0;for(_=1;_<$&&me[_]===0;_++);for(Me<_&&(Me=_),B=le=1;B<=15;B++)if(le<<=1,(le-=me[B])<0)return-1;if(0<le&&(g===0||$!==1))return-1;for(fe[1]=0,B=1;B<15;B++)fe[B+1]=fe[B]+me[B];for(q=0;q<d;q++)h[w+q]!==0&&(y[fe[h[w+q]]++]=q);if(H=g===0?(X=Ce=y,19):g===1?(X=o,ve-=257,Ce=l,lt-=257,256):(X=c,Ce=p,-1),B=_,W=v,xe=q=Y=0,z=-1,x=(Te=1<<(ie=Me))-1,g===1&&852<Te||g===2&&592<Te)return 1;for(;;){for(K=B-xe,ee=y[q]<H?(G=0,y[q]):y[q]>H?(G=Ce[lt+y[q]],X[ve+y[q]]):(G=96,0),M=1<<B-xe,_=L=1<<ie;S[W+(Y>>xe)+(L-=M)]=K<<24|G<<16|ee|0,L!==0;);for(M=1<<B-1;Y&M;)M>>=1;if(M!==0?(Y&=M-1,Y+=M):Y=0,q++,--me[B]==0){if(B===$)break;B=h[w+y[q]]}if(Me<B&&(Y&x)!==z){for(xe===0&&(xe=Me),W+=_,le=1<<(ie=B-xe);ie+xe<$&&!((le-=me[ie+xe])<=0);)ie++,le<<=1;if(Te+=1<<ie,g===1&&852<Te||g===2&&592<Te)return 1;S[z=Y&x]=Me<<24|ie<<16|W-v|0}}return Y!==0&&(S[W+Y]=B-xe<<24|64<<16|0),b.bits=Me,0}},{"../utils/common":41}],51:[function(t,i,a){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,a){var s=t("../utils/common"),o=0,l=1;function c(E){for(var U=E.length;0<=--U;)E[U]=0}var p=0,g=29,h=256,w=h+1+g,d=30,S=19,v=2*w+1,y=15,b=16,M=7,L=256,z=16,x=17,W=18,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],K=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],G=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],_e=new Array(2*(w+2));c(_e);var B=new Array(2*d);c(B);var q=new Array(512);c(q);var _=new Array(256);c(_);var $=new Array(g);c($);var Me,ie,xe,le=new Array(d);function Te(E,U,te,re,V){this.static_tree=E,this.extra_bits=U,this.extra_base=te,this.elems=re,this.max_length=V,this.has_stree=E&&E.length}function Y(E,U){this.dyn_tree=E,this.max_code=0,this.stat_desc=U}function X(E){return E<256?q[E]:q[256+(E>>>7)]}function ve(E,U){E.pending_buf[E.pending++]=255&U,E.pending_buf[E.pending++]=U>>>8&255}function me(E,U,te){E.bi_valid>b-te?(E.bi_buf|=U<<E.bi_valid&65535,ve(E,E.bi_buf),E.bi_buf=U>>b-E.bi_valid,E.bi_valid+=te-b):(E.bi_buf|=U<<E.bi_valid&65535,E.bi_valid+=te)}function fe(E,U,te){me(E,te[2*U],te[2*U+1])}function Ce(E,U){for(var te=0;te|=1&E,E>>>=1,te<<=1,0<--U;);return te>>>1}function lt(E,U,te){var re,V,ce=new Array(y+1),pe=0;for(re=1;re<=y;re++)ce[re]=pe=pe+te[re-1]<<1;for(V=0;V<=U;V++){var se=E[2*V+1];se!==0&&(E[2*V]=Ce(ce[se]++,se))}}function Be(E){var U;for(U=0;U<w;U++)E.dyn_ltree[2*U]=0;for(U=0;U<d;U++)E.dyn_dtree[2*U]=0;for(U=0;U<S;U++)E.bl_tree[2*U]=0;E.dyn_ltree[2*L]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0}function Ne(E){8<E.bi_valid?ve(E,E.bi_buf):0<E.bi_valid&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0}function $e(E,U,te,re){var V=2*U,ce=2*te;return E[V]<E[ce]||E[V]===E[ce]&&re[U]<=re[te]}function et(E,U,te){for(var re=E.heap[te],V=te<<1;V<=E.heap_len&&(V<E.heap_len&&$e(U,E.heap[V+1],E.heap[V],E.depth)&&V++,!$e(U,re,E.heap[V],E.depth));)E.heap[te]=E.heap[V],te=V,V<<=1;E.heap[te]=re}function Tt(E,U,te){var re,V,ce,pe,se=0;if(E.last_lit!==0)for(;re=E.pending_buf[E.d_buf+2*se]<<8|E.pending_buf[E.d_buf+2*se+1],V=E.pending_buf[E.l_buf+se],se++,re===0?fe(E,V,U):(fe(E,(ce=_[V])+h+1,U),(pe=H[ce])!==0&&me(E,V-=$[ce],pe),fe(E,ce=X(--re),te),(pe=K[ce])!==0&&me(E,re-=le[ce],pe)),se<E.last_lit;);fe(E,L,U)}function kt(E,U){var te,re,V,ce=U.dyn_tree,pe=U.stat_desc.static_tree,se=U.stat_desc.has_stree,we=U.stat_desc.elems,Xe=-1;for(E.heap_len=0,E.heap_max=v,te=0;te<we;te++)ce[2*te]!==0?(E.heap[++E.heap_len]=Xe=te,E.depth[te]=0):ce[2*te+1]=0;for(;E.heap_len<2;)ce[2*(V=E.heap[++E.heap_len]=Xe<2?++Xe:0)]=1,E.depth[V]=0,E.opt_len--,se&&(E.static_len-=pe[2*V+1]);for(U.max_code=Xe,te=E.heap_len>>1;1<=te;te--)et(E,ce,te);for(V=we;te=E.heap[1],E.heap[1]=E.heap[E.heap_len--],et(E,ce,1),re=E.heap[1],E.heap[--E.heap_max]=te,E.heap[--E.heap_max]=re,ce[2*V]=ce[2*te]+ce[2*re],E.depth[V]=(E.depth[te]>=E.depth[re]?E.depth[te]:E.depth[re])+1,ce[2*te+1]=ce[2*re+1]=V,E.heap[1]=V++,et(E,ce,1),2<=E.heap_len;);E.heap[--E.heap_max]=E.heap[1],function(Ae,_t){var Kt,Mt,qt,Je,Qt,Pr,At=_t.dyn_tree,dr=_t.max_code,kr=_t.stat_desc.static_tree,Hr=_t.stat_desc.has_stree,Bt=_t.stat_desc.extra_bits,Mr=_t.stat_desc.extra_base,ir=_t.stat_desc.max_length,ar=0;for(Je=0;Je<=y;Je++)Ae.bl_count[Je]=0;for(At[2*Ae.heap[Ae.heap_max]+1]=0,Kt=Ae.heap_max+1;Kt<v;Kt++)ir<(Je=At[2*At[2*(Mt=Ae.heap[Kt])+1]+1]+1)&&(Je=ir,ar++),At[2*Mt+1]=Je,dr<Mt||(Ae.bl_count[Je]++,Qt=0,Mr<=Mt&&(Qt=Bt[Mt-Mr]),Pr=At[2*Mt],Ae.opt_len+=Pr*(Je+Qt),Hr&&(Ae.static_len+=Pr*(kr[2*Mt+1]+Qt)));if(ar!==0){do{for(Je=ir-1;Ae.bl_count[Je]===0;)Je--;Ae.bl_count[Je]--,Ae.bl_count[Je+1]+=2,Ae.bl_count[ir]--,ar-=2}while(0<ar);for(Je=ir;Je!==0;Je--)for(Mt=Ae.bl_count[Je];Mt!==0;)dr<(qt=Ae.heap[--Kt])||(At[2*qt+1]!==Je&&(Ae.opt_len+=(Je-At[2*qt+1])*At[2*qt],At[2*qt+1]=Je),Mt--)}}(E,U),lt(ce,Xe,E.bl_count)}function f(E,U,te){var re,V,ce=-1,pe=U[1],se=0,we=7,Xe=4;for(pe===0&&(we=138,Xe=3),U[2*(te+1)+1]=65535,re=0;re<=te;re++)V=pe,pe=U[2*(re+1)+1],++se<we&&V===pe||(se<Xe?E.bl_tree[2*V]+=se:V!==0?(V!==ce&&E.bl_tree[2*V]++,E.bl_tree[2*z]++):se<=10?E.bl_tree[2*x]++:E.bl_tree[2*W]++,ce=V,Xe=(se=0)===pe?(we=138,3):V===pe?(we=6,3):(we=7,4))}function Q(E,U,te){var re,V,ce=-1,pe=U[1],se=0,we=7,Xe=4;for(pe===0&&(we=138,Xe=3),re=0;re<=te;re++)if(V=pe,pe=U[2*(re+1)+1],!(++se<we&&V===pe)){if(se<Xe)for(;fe(E,V,E.bl_tree),--se!=0;);else V!==0?(V!==ce&&(fe(E,V,E.bl_tree),se--),fe(E,z,E.bl_tree),me(E,se-3,2)):se<=10?(fe(E,x,E.bl_tree),me(E,se-3,3)):(fe(E,W,E.bl_tree),me(E,se-11,7));ce=V,Xe=(se=0)===pe?(we=138,3):V===pe?(we=6,3):(we=7,4)}}c(le);var Z=!1;function D(E,U,te,re){me(E,(p<<1)+(re?1:0),3),function(V,ce,pe,se){Ne(V),ve(V,pe),ve(V,~pe),s.arraySet(V.pending_buf,V.window,ce,pe,V.pending),V.pending+=pe}(E,U,te)}a._tr_init=function(E){Z||(function(){var U,te,re,V,ce,pe=new Array(y+1);for(V=re=0;V<g-1;V++)for($[V]=re,U=0;U<1<<H[V];U++)_[re++]=V;for(_[re-1]=V,V=ce=0;V<16;V++)for(le[V]=ce,U=0;U<1<<K[V];U++)q[ce++]=V;for(ce>>=7;V<d;V++)for(le[V]=ce<<7,U=0;U<1<<K[V]-7;U++)q[256+ce++]=V;for(te=0;te<=y;te++)pe[te]=0;for(U=0;U<=143;)_e[2*U+1]=8,U++,pe[8]++;for(;U<=255;)_e[2*U+1]=9,U++,pe[9]++;for(;U<=279;)_e[2*U+1]=7,U++,pe[7]++;for(;U<=287;)_e[2*U+1]=8,U++,pe[8]++;for(lt(_e,w+1,pe),U=0;U<d;U++)B[2*U+1]=5,B[2*U]=Ce(U,5);Me=new Te(_e,H,h+1,w,y),ie=new Te(B,K,0,d,y),xe=new Te(new Array(0),G,0,S,M)}(),Z=!0),E.l_desc=new Y(E.dyn_ltree,Me),E.d_desc=new Y(E.dyn_dtree,ie),E.bl_desc=new Y(E.bl_tree,xe),E.bi_buf=0,E.bi_valid=0,Be(E)},a._tr_stored_block=D,a._tr_flush_block=function(E,U,te,re){var V,ce,pe=0;0<E.level?(E.strm.data_type===2&&(E.strm.data_type=function(se){var we,Xe=4093624447;for(we=0;we<=31;we++,Xe>>>=1)if(1&Xe&&se.dyn_ltree[2*we]!==0)return o;if(se.dyn_ltree[18]!==0||se.dyn_ltree[20]!==0||se.dyn_ltree[26]!==0)return l;for(we=32;we<h;we++)if(se.dyn_ltree[2*we]!==0)return l;return o}(E)),kt(E,E.l_desc),kt(E,E.d_desc),pe=function(se){var we;for(f(se,se.dyn_ltree,se.l_desc.max_code),f(se,se.dyn_dtree,se.d_desc.max_code),kt(se,se.bl_desc),we=S-1;3<=we&&se.bl_tree[2*ee[we]+1]===0;we--);return se.opt_len+=3*(we+1)+5+5+4,we}(E),V=E.opt_len+3+7>>>3,(ce=E.static_len+3+7>>>3)<=V&&(V=ce)):V=ce=te+5,te+4<=V&&U!==-1?D(E,U,te,re):E.strategy===4||ce===V?(me(E,2+(re?1:0),3),Tt(E,_e,B)):(me(E,4+(re?1:0),3),function(se,we,Xe,Ae){var _t;for(me(se,we-257,5),me(se,Xe-1,5),me(se,Ae-4,4),_t=0;_t<Ae;_t++)me(se,se.bl_tree[2*ee[_t]+1],3);Q(se,se.dyn_ltree,we-1),Q(se,se.dyn_dtree,Xe-1)}(E,E.l_desc.max_code+1,E.d_desc.max_code+1,pe+1),Tt(E,E.dyn_ltree,E.dyn_dtree)),Be(E),re&&Ne(E)},a._tr_tally=function(E,U,te){return E.pending_buf[E.d_buf+2*E.last_lit]=U>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&U,E.pending_buf[E.l_buf+E.last_lit]=255&te,E.last_lit++,U===0?E.dyn_ltree[2*te]++:(E.matches++,U--,E.dyn_ltree[2*(_[te]+h+1)]++,E.dyn_dtree[2*X(U)]++),E.last_lit===E.lit_bufsize-1},a._tr_align=function(E){me(E,2,3),fe(E,L,_e),function(U){U.bi_valid===16?(ve(U,U.bi_buf),U.bi_buf=0,U.bi_valid=0):8<=U.bi_valid&&(U.pending_buf[U.pending++]=255&U.bi_buf,U.bi_buf>>=8,U.bi_valid-=8)}(E)}},{"../utils/common":41}],53:[function(t,i,a){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,a){(function(s){(function(o,l){if(!o.setImmediate){var c,p,g,h,w=1,d={},S=!1,v=o.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(o);y=y&&y.setTimeout?y:o,c={}.toString.call(o.process)==="[object process]"?function(z){process.nextTick(function(){M(z)})}:function(){if(o.postMessage&&!o.importScripts){var z=!0,x=o.onmessage;return o.onmessage=function(){z=!1},o.postMessage("","*"),o.onmessage=x,z}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",L,!1):o.attachEvent("onmessage",L),function(z){o.postMessage(h+z,"*")}):o.MessageChannel?((g=new MessageChannel).port1.onmessage=function(z){M(z.data)},function(z){g.port2.postMessage(z)}):v&&"onreadystatechange"in v.createElement("script")?(p=v.documentElement,function(z){var x=v.createElement("script");x.onreadystatechange=function(){M(z),x.onreadystatechange=null,p.removeChild(x),x=null},p.appendChild(x)}):function(z){setTimeout(M,0,z)},y.setImmediate=function(z){typeof z!="function"&&(z=new Function(""+z));for(var x=new Array(arguments.length-1),W=0;W<x.length;W++)x[W]=arguments[W+1];var H={callback:z,args:x};return d[w]=H,c(w),w++},y.clearImmediate=b}function b(z){delete d[z]}function M(z){if(S)setTimeout(M,0,z);else{var x=d[z];if(x){S=!0;try{(function(W){var H=W.callback,K=W.args;switch(K.length){case 0:H();break;case 1:H(K[0]);break;case 2:H(K[0],K[1]);break;case 3:H(K[0],K[1],K[2]);break;default:H.apply(l,K)}})(x)}finally{b(z),S=!1}}}}function L(z){z.source===o&&typeof z.data=="string"&&z.data.indexOf(h)===0&&M(+z.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Sr<"u"?Sr:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(la);var Ya=la.exports;const Xa=sa(Ya);class Jn{constructor(){m(this,"comboColors",[]);m(this,"sliderTrackColor");m(this,"sliderBorderColor")}clone(){const e=new Jn;return e.comboColors=this.comboColors.map(t=>t.clone()),this.sliderTrackColor&&(e.sliderTrackColor=this.sliderTrackColor),this.sliderBorderColor&&(e.sliderBorderColor=this.sliderBorderColor),e}}const Lr=class Lr{constructor(){m(this,"_CS",Lr.BASE_DIFFICULTY);m(this,"_HP",Lr.BASE_DIFFICULTY);m(this,"_OD",Lr.BASE_DIFFICULTY);m(this,"_AR");m(this,"_multiplier",1);m(this,"_tickRate",1);m(this,"_rate",1)}get circleSize(){return Math.fround(this._CS)}set circleSize(e){this._CS=e}get drainRate(){return Math.fround(this._HP)}set drainRate(e){this._HP=e}get overallDifficulty(){return Math.fround(this._OD)}set overallDifficulty(e){this._OD=e}get approachRate(){return Math.fround(this._AR??this._OD)}set approachRate(e){this._AR=e}get sliderMultiplier(){return this._multiplier}set sliderMultiplier(e){this._multiplier=e}get sliderTickRate(){return this._tickRate}set sliderTickRate(e){this._tickRate=e}get clockRate(){return this._rate}set clockRate(e){this._rate=e}clone(){const e=new Lr;return e.circleSize=this._CS,e.drainRate=this._HP,e.overallDifficulty=this._OD,typeof this._AR=="number"&&(e.approachRate=this._AR),e.sliderMultiplier=this._multiplier,e.sliderTickRate=this._tickRate,e.clockRate=this._rate,e}static range(e,t,i,a){return e>5?i+(a-i)*(e-5)/5:e<5?i-(i-t)*(5-e)/5:i}};m(Lr,"BASE_DIFFICULTY",5);let vn=Lr;class Di{constructor(){m(this,"bookmarks",[]);m(this,"distanceSpacing",1);m(this,"beatDivisor",4);m(this,"gridSize",1);m(this,"timelineZoom",2)}clone(){const e=new Di;return e.bookmarks=this.bookmarks.slice(),e.distanceSpacing=this.distanceSpacing,e.beatDivisor=this.beatDivisor,e.gridSize=this.gridSize,e.timelineZoom=this.timelineZoom,e}}let qi;(function(n){n[n.AdditiveBlending=0]="AdditiveBlending",n[n.AlphaBlending=1]="AlphaBlending"})(qi||(qi={}));const St=class St{constructor(e){m(this,"source");m(this,"destination");m(this,"sourceAlpha");m(this,"destinationAlpha");m(this,"rgbEquation");m(this,"alphaEquation");this.source=e.source||0,this.destination=e.destination||0,this.sourceAlpha=e.sourceAlpha||0,this.destinationAlpha=e.destinationAlpha||0,this.rgbEquation=e.rgbEquation||0,this.alphaEquation=e.alphaEquation||0}copyFromParent(e){this.source===0&&(this.source=e.source),this.destination===0&&(this.destination=e.destination),this.sourceAlpha===0&&(this.sourceAlpha=e.sourceAlpha),this.destinationAlpha===0&&(this.destinationAlpha=e.destinationAlpha),this.rgbEquation===0&&(this.rgbEquation=e.rgbEquation),this.alphaEquation===0&&(this.alphaEquation=e.alphaEquation)}applyDefaultToInherited(){this.source===0&&(this.source=12),this.destination===0&&(this.destination=10),this.sourceAlpha===0&&(this.sourceAlpha=5),this.destinationAlpha===0&&(this.destinationAlpha=5),this.rgbEquation===0&&(this.rgbEquation=1),this.alphaEquation===0&&(this.alphaEquation=1)}equals(e){return e.source===this.source&&e.destination===this.destination&&e.sourceAlpha===this.sourceAlpha&&e.destinationAlpha===this.destinationAlpha&&e.rgbEquation===this.rgbEquation&&e.alphaEquation===this.alphaEquation}get isDisabled(){return this.source===5&&this.destination===15&&this.sourceAlpha===5&&this.destinationAlpha===15&&this.rgbEquation===1&&this.alphaEquation===1}get rgbEquationMode(){return St._translateEquation(this.rgbEquation)}get alphaEquationMode(){return St._translateEquation(this.alphaEquation)}get sourceBlendingFactor(){return St._translateBlendingFactorSrc(this.source)}get destinationBlendingFactor(){return St._translateBlendingFactorDest(this.destination)}get sourceAlphaBlendingFactor(){return St._translateBlendingFactorSrc(this.sourceAlpha)}get destinationAlphaBlendingFactor(){return St._translateBlendingFactorDest(this.destinationAlpha)}static _translateBlendingFactorSrc(e){switch(e){case 1:return 32771;case 2:return 32769;case 3:return 772;case 4:return 774;case 5:return 1;case 6:return 32772;case 7:return 32770;case 8:return 773;case 9:return 775;case 10:return 769;case 12:return 770;case 13:return 776;case 14:return 768;default:case 15:return 0}}static _translateBlendingFactorDest(e){switch(e){case 1:return 32771;case 2:return 32769;case 3:return 772;case 4:return 774;case 5:return 1;case 6:return 32772;case 7:return 32770;case 8:return 773;case 9:return 775;case 10:return 771;case 11:return 769;case 12:return 770;case 13:return 776;case 14:return 768;default:case 15:return 0}}static _translateEquation(e){switch(e){default:case 0:case 1:return 32774;case 2:return 32775;case 3:return 32776;case 4:return 32778;case 5:return 32779}}};m(St,"None",new St({source:5,destination:15,sourceAlpha:5,destinationAlpha:15,rgbEquation:1,alphaEquation:1})),m(St,"Inherit",new St({source:0,destination:0,sourceAlpha:0,destinationAlpha:0,rgbEquation:0,alphaEquation:0})),m(St,"Mixture",new St({source:12,destination:10,sourceAlpha:5,destinationAlpha:5,rgbEquation:1,alphaEquation:1})),m(St,"Additive",new St({source:12,destination:5,sourceAlpha:5,destinationAlpha:5,rgbEquation:1,alphaEquation:1}));let tn=St,Rt;(function(n){n[n.y0=1]="y0",n[n.y1=2]="y1",n[n.y2=4]="y2",n[n.x0=8]="x0",n[n.x1=16]="x1",n[n.x2=32]="x2",n[n.Custom=64]="Custom",n[n.TopLeft=9]="TopLeft",n[n.TopCentre=17]="TopCentre",n[n.TopRight=33]="TopRight",n[n.CentreLeft=10]="CentreLeft",n[n.Centre=18]="Centre",n[n.CentreRight=34]="CentreRight",n[n.BottomLeft=12]="BottomLeft",n[n.BottomCentre=20]="BottomCentre",n[n.BottomRight=36]="BottomRight"})(Rt||(Rt={}));let Ze;(function(n){n.None="",n.Movement="M",n.MovementX="MX",n.MovementY="MY",n.Fade="F",n.Scale="S",n.VectorScale="V",n.Rotation="R",n.Color="C",n.Parameter="P"})(Ze||(Ze={}));let nn;(function(n){n.None="",n.Loop="L",n.Trigger="T"})(nn||(nn={}));let gt;(function(n){n[n.Background=0]="Background",n[n.Video=1]="Video",n[n.Break=2]="Break",n[n.Colour=3]="Colour",n[n.Sprite=4]="Sprite",n[n.Sample=5]="Sample",n[n.Animation=6]="Animation",n[n.StoryboardCommand=7]="StoryboardCommand"})(gt||(gt={}));let zt;(function(n){n[n.Background=0]="Background",n[n.Fail=1]="Fail",n[n.Pass=2]="Pass",n[n.Foreground=3]="Foreground",n[n.Overlay=4]="Overlay",n[n.Video=5]="Video"})(zt||(zt={}));let bn;(function(n){n[n.LoopForever=0]="LoopForever",n[n.LoopOnce=1]="LoopOnce"})(bn||(bn={}));let yt;(function(n){n[n.TopLeft=0]="TopLeft",n[n.Centre=1]="Centre",n[n.CentreLeft=2]="CentreLeft",n[n.TopRight=3]="TopRight",n[n.BottomCentre=4]="BottomCentre",n[n.TopCentre=5]="TopCentre",n[n.Custom=6]="Custom",n[n.CentreRight=7]="CentreRight",n[n.BottomLeft=8]="BottomLeft",n[n.BottomRight=9]="BottomRight"})(yt||(yt={}));let cr;(function(n){n.None="",n.HorizontalFlip="H",n.VerticalFlip="V",n.BlendingMode="A"})(cr||(cr={}));class ur{constructor(e,t,i,a){m(this,"red");m(this,"green");m(this,"blue");m(this,"alpha");this.red=e??255,this.green=t??255,this.blue=i??255,this.alpha=a??1}get hex(){const e=Math.round(this.alpha*255);return"#"+this.red.toString(16).padStart(2,"0")+this.green.toString(16).padStart(2,"0")+this.blue.toString(16).padStart(2,"0")+e.toString(16).padStart(2,"0")}equals(e){return this.red===e.red&&this.green===e.green&&this.blue===e.blue&&this.alpha===e.alpha}clone(){return new ur(this.red,this.green,this.blue,this.alpha)}toString(){return`${this.red},${this.green},${this.blue},${this.alpha}`}}class Le{constructor(e,t){m(this,"x");m(this,"y");this.x=e,this.y=isFinite(t)?t:e}get floatX(){return Math.fround(this.x)}get floatY(){return Math.fround(this.y)}add(e){return new Le(this.x+e.x,this.y+e.y)}fadd(e){return new Le(Math.fround(this.floatX+e.floatX),Math.fround(this.floatY+e.floatY))}subtract(e){return new Le(this.x-e.x,this.y-e.y)}fsubtract(e){return new Le(Math.fround(this.floatX-e.floatX),Math.fround(this.floatY-e.floatY))}scale(e){return new Le(this.x*e,this.y*e)}fscale(e){const t=Math.fround(e);return new Le(Math.fround(this.floatX*t),Math.fround(this.floatY*t))}divide(e){return new Le(this.x/e,this.y/e)}fdivide(e){const t=Math.fround(e);return new Le(Math.fround(this.floatX/t),Math.fround(this.floatY/t))}dot(e){return this.x*e.x+this.y*e.y}fdot(e){return Math.fround(Math.fround(Math.fround(this.floatX*e.floatX)+Math.fround(this.floatY*e.floatY)))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}flength(){return Math.fround(Math.sqrt(Math.fround(Math.fround(this.floatX*this.floatX)+Math.fround(this.floatY*this.floatY))))}distance(e){const t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)}fdistance(e){const t=Math.fround(this.floatX-e.floatX),i=Math.fround(this.floatY-e.floatY);return Math.fround(Math.sqrt(Math.fround(Math.fround(t*t)+Math.fround(i*i))))}normalize(){const e=1/this.length();return new Le(this.x*e,this.y*e)}fnormalize(){const e=Math.fround(1/this.flength());return new Le(Math.fround(this.floatX*e),Math.fround(this.floatY*e))}equals(e){return this.x===e.x&&this.y===e.y}clone(){return new Le(this.x,this.y)}toString(){return`${this.x},${this.y}`}}function on(n,e,t){return Math.max(e,Math.min(t,n))}function Cn(n){return on(n,0,1)}function ca(n,e,t,i,a){return n<e?i:n>=t?a:(n-e)/(t-e)*(a-i)+i}function ua(n,e,t){return ca(n,e,t,0,1)}function fa(n,e,t){return e*(1-n)+t*n}function Or(n,e,t){return fa(Cn(n),e,t)}function Za(n,e,t){const i=Or(n,e.floatX,t.floatX),a=Or(n,e.floatY,t.floatY);return new Le(i,a)}function Ka(n,e,t){const i=Or(n,e.red,t.red),a=Or(n,e.green,t.green),s=Or(n,e.blue,t.blue),o=Or(n,e.alpha,t.alpha);return new ur(i,a,s,o)}let Fr=Object.freeze({__proto__:null,clamp:on,clamp01:Cn,lerp:fa,lerpClamped01:Or,lerpColor4:Ka,lerpVector2:Za,map:ca,map01:ua}),Oe;(function(n){n[n.None=0]="None",n[n.Out=1]="Out",n[n.In=2]="In",n[n.InQuad=3]="InQuad",n[n.OutQuad=4]="OutQuad",n[n.InOutQuad=5]="InOutQuad",n[n.InCubic=6]="InCubic",n[n.OutCubic=7]="OutCubic",n[n.InOutCubic=8]="InOutCubic",n[n.InQuart=9]="InQuart",n[n.OutQuart=10]="OutQuart",n[n.InOutQuart=11]="InOutQuart",n[n.InQuint=12]="InQuint",n[n.OutQuint=13]="OutQuint",n[n.InOutQuint=14]="InOutQuint",n[n.InSine=15]="InSine",n[n.OutSine=16]="OutSine",n[n.InOutSine=17]="InOutSine",n[n.InExpo=18]="InExpo",n[n.OutExpo=19]="OutExpo",n[n.InOutExpo=20]="InOutExpo",n[n.InCirc=21]="InCirc",n[n.OutCirc=22]="OutCirc",n[n.InOutCirc=23]="InOutCirc",n[n.InElastic=24]="InElastic",n[n.OutElastic=25]="OutElastic",n[n.OutElasticHalf=26]="OutElasticHalf",n[n.OutElasticQuarter=27]="OutElasticQuarter",n[n.InOutElastic=28]="InOutElastic",n[n.InBack=29]="InBack",n[n.OutBack=30]="OutBack",n[n.InOutBack=31]="InOutBack",n[n.InBounce=32]="InBounce",n[n.OutBounce=33]="OutBounce",n[n.InOutBounce=34]="InOutBounce",n[n.OutPow10=35]="OutPow10"})(Oe||(Oe={}));const fr=2*Math.PI/.3,hr=.3/4,wn=1.70158,jn=wn*1.525,Ut=1/2.75,Hn=Math.pow(2,-10),ha=Math.pow(2,-11),qa=Math.pow(2,-10)*Math.sin((.5-hr)*fr),Qa=Math.pow(2,-10)*Math.sin((.25-hr)*fr),Qi=Math.pow(2,-10)*Math.sin((1-hr*1.5)*fr/1.5),Ue=n=>e=>n(Cn(e)),Ja=Ue(n=>n),Ca=Ue(n=>n*n),$a=Ue(n=>n*(2-n)),es=Ue(n=>n<.5?n*n*2:--n*n*-2+1),ts=Ue(n=>n*n*n),rs=Ue(n=>--n*n*n+1),ns=Ue(n=>n<.5?n*n*n*4:--n*n*n*4+1),is=Ue(n=>n*n*n*n),as=Ue(n=>1- --n*n*n*n),ss=Ue(n=>n<.5?n*n*n*n*8:--n*n*n*n*-8+1),os=Ue(n=>n*n*n*n*n),ls=Ue(n=>--n*n*n*n*n+1),cs=Ue(n=>n<.5?n*n*n*n*n*16:--n*n*n*n*n*16+1),us=Ue(n=>1-Math.cos(n*Math.PI*.5)),fs=Ue(n=>Math.sin(n*Math.PI*.5)),hs=Ue(n=>.5-.5*Math.cos(Math.PI*n)),ds=Ue(n=>Math.pow(2,10*(n-1))+Hn*(n-1)),ms=Ue(n=>-Math.pow(2,-10*n)+1+Hn*n),ps=Ue(n=>n<.5?.5*(Math.pow(2,20*n-10)+Hn*(2*n-1)):1-.5*(Math.pow(2,-20*n+10)+Hn*(-2*n+1))),_s=Ue(n=>1-Math.sqrt(1-n*n)),gs=Ue(n=>Math.sqrt(1- --n*n)),vs=Ue(n=>(n*=2)<1?.5-.5*Math.sqrt(1-n*n):.5*Math.sqrt(1-(n-=2)*n)+.5),bs=Ue(n=>-Math.pow(2,-10+10*n)*Math.sin((1-hr-n)*fr)+ha*(1-n)),ws=Ue(n=>Math.pow(2,-10*n)*Math.sin((n-hr)*fr)+1-ha*n),Ss=Ue(n=>Math.pow(2,-10*n)*Math.sin((.5*n-hr)*fr)+1-qa*n),ys=Ue(n=>Math.pow(2,-10*n)*Math.sin((.25*n-hr)*fr)+1-Qa*n),Ps=Ue(n=>(n*=2)<1?-.5*(Math.pow(2,-10+10*n)*Math.sin((1-hr*1.5-n)*fr/1.5)-Qi*(1-n)):.5*(Math.pow(2,-10*--n)*Math.sin((n-hr*1.5)*fr/1.5)-Qi*n)+1),ks=Ue(n=>n*n*((wn+1)*n-wn)),Ms=Ue(n=>--n*n*((wn+1)*n+wn)+1),Ts=Ue(n=>(n*=2)<1?.5*n*n*((jn+1)*n-jn):.5*((n-=2)*n*((jn+1)*n+jn)+2)),Es=Ue(n=>(n=1-n,n<Ut?1-7.5625*n*n:n<2*Ut?1-(7.5625*(n-=1.5*Ut)*n+.75):n<2.5*Ut?1-(7.5625*(n-=2.25*Ut)*n+.9375):1-(7.5625*(n-=2.625*Ut)*n+.984375))),Si=Ue(n=>n<Ut?7.5625*n*n:n<2*Ut?7.5625*(n-=1.5*Ut)*n+.75:n<2.5*Ut?7.5625*(n-=2.25*Ut)*n+.9375:7.5625*(n-=2.625*Ut)*n+.984375),Is=Ue(n=>n<.5?.5-.5*Si(1-n*2):Si((n-.5)*2)*.5+.5),Ds=Ue(n=>--n*Math.pow(n,10)+1);function xs(n){switch(n){case Oe.In:case Oe.InQuad:return Ca;case Oe.Out:case Oe.OutQuad:return $a;case Oe.InOutQuad:return es;case Oe.InCubic:return ts;case Oe.OutCubic:return rs;case Oe.InOutCubic:return ns;case Oe.InQuart:return is;case Oe.OutQuart:return as;case Oe.InOutQuart:return ss;case Oe.InQuint:return os;case Oe.OutQuint:return ls;case Oe.InOutQuint:return cs;case Oe.InSine:return us;case Oe.OutSine:return fs;case Oe.InOutSine:return hs;case Oe.InExpo:return ds;case Oe.OutExpo:return ms;case Oe.InOutExpo:return ps;case Oe.InCirc:return _s;case Oe.OutCirc:return gs;case Oe.InOutCirc:return vs;case Oe.InElastic:return bs;case Oe.OutElastic:return ws;case Oe.OutElasticHalf:return Ss;case Oe.OutElasticQuarter:return ys;case Oe.InOutElastic:return Ps;case Oe.InBack:return ks;case Oe.OutBack:return Ms;case Oe.InOutBack:return Ts;case Oe.InBounce:return Es;case Oe.OutBounce:return Si;case Oe.InOutBounce:return Is;case Oe.OutPow10:return Ds}return Ja}class xi{constructor(e){m(this,"type");m(this,"parameter");m(this,"easing");m(this,"startTime");m(this,"endTime");this.type=(e==null?void 0:e.type)??Ze.None,this.parameter=(e==null?void 0:e.parameter)??cr.None,this.easing=(e==null?void 0:e.easing)??Oe.None,this.startTime=(e==null?void 0:e.startTime)??0,this.endTime=(e==null?void 0:e.endTime)??0,this.startValue=(e==null?void 0:e.startValue)??null,this.endValue=(e==null?void 0:e.endValue)??null}get duration(){return this.endTime-this.startTime}getProgress(e){const t=ua(e,this.startTime,this.endTime);return xs(this.easing)(t)}getValueAtProgress(e){const t=(s,o,l)=>o+s*(l-o),i=(s,o,l)=>o===l||s>=o&&s<l;if(typeof this.startValue=="number"){const s=this.startValue,o=this.endValue;return t(e,s,o)}if(this.startValue instanceof Le){const s=this.startValue,o=this.endValue;return new Le(t(e,s.floatX,o.floatX),t(e,s.floatY,o.floatY))}if(this.startValue instanceof ur){const s=this.startValue,o=this.endValue;return new ur(t(e,s.red,o.red),t(e,s.green,o.green),t(e,s.blue,o.blue),t(e,s.alpha,o.alpha))}const a=this.startTime+this.duration*e;if(typeof this.startValue=="boolean")return i(a,this.startTime,this.endTime);if(this.startValue instanceof tn){const s=this.startValue,o=this.endValue;return i(a,this.startTime,this.endTime)?s:o}return this.endValue}getValueAtTime(e){return this.getValueAtProgress(this.getProgress(e))}equals(e){return this.type===e.type&&this.startTime===e.startTime&&this.endTime===e.endTime&&this.startValue===e.startValue&&this.endValue===e.endValue&&this.easing===e.easing&&this.parameter===e.parameter}}class er{constructor(){m(this,"_commands",[]);m(this,"startTime",1/0);m(this,"endTime",-1/0)}[Symbol.iterator](){const e=this.commands;let t=-1;return{next:()=>({value:e[++t],done:!(t in e)})}}get commands(){return this._commands.sort((e,t)=>e.startTime-t.startTime||e.endTime-t.endTime)}add(e,t,i,a,s,o,l){a<i&&([i,a]=[a,i],[s,o]=[o,s]),this._commands.push(new xi({type:e,easing:t,startTime:i,endTime:a,startValue:s,endValue:o,parameter:l})),i<this.startTime&&(this.startValue=s,this.startTime=i),a>this.endTime&&(this.endValue=o,this.endTime=a)}get hasCommands(){return this._commands.length>0}}class Ai{constructor(){m(this,"x",new er);m(this,"y",new er);m(this,"scale",new er);m(this,"vectorScale",new er);m(this,"rotation",new er);m(this,"color",new er);m(this,"alpha",new er);m(this,"blendingParameters",new er);m(this,"flipH",new er);m(this,"flipV",new er);m(this,"_timelines");this._timelines=[this.x,this.y,this.scale,this.vectorScale,this.rotation,this.color,this.alpha,this.blendingParameters,this.flipH,this.flipV]}get timelines(){return this._timelines}get totalCommands(){return this._timelines.reduce((e,t)=>e+t.commands.length,0)}get commands(){return this._timelines.flatMap(e=>e.commands).sort((e,t)=>e.startTime-t.startTime||e.endTime-t.endTime)}get commandsStartTime(){let e=1/0;for(let t=0;t<this._timelines.length;++t)e=Math.min(e,this._timelines[t].startTime);return e}get commandsEndTime(){let e=-1/0;for(let t=0;t<this._timelines.length;++t)e=Math.max(e,this._timelines[t].endTime);return e}get commandsDuration(){return this.commandsEndTime-this.commandsStartTime}get startTime(){return this.commandsStartTime}get endTime(){return this.commandsEndTime}get duration(){return this.endTime-this.startTime}get hasCommands(){for(let e=0;e<this._timelines.length;++e)if(this._timelines[e].hasCommands)return!0;return!1}}class da extends Ai{constructor(t,i){super();m(this,"type",nn.Loop);m(this,"loopStartTime");m(this,"loopCount");this.loopStartTime=t||0,this.loopCount=i||0}get totalIterations(){return this.loopCount+1}get startTime(){return this.loopStartTime+this.commandsStartTime}get endTime(){return this.startTime+this.commandsDuration*this.totalIterations}unrollCommands(){const t=this.commands;if(t.length===0)return[];const{commandsDuration:i,totalIterations:a,loopStartTime:s}=this,o=new Array(a*t.length);for(let l=0;l<a;l++){const c=s+l*i;for(let p=0;p<t.length;p++){const g=l*t.length+p,h=t[p];o[g]=new xi({...h,startTime:h.startTime+c,endTime:h.endTime+c})}}return o}}class ma extends Ai{constructor(t,i,a,s){super();m(this,"type",nn.Trigger);m(this,"triggerName");m(this,"triggerStartTime");m(this,"triggerEndTime");m(this,"groupNumber");this.triggerName=t||"",this.triggerStartTime=i||0,this.triggerEndTime=a||0,this.groupNumber=s||0}unrollCommands(){const t=this.commands;if(t.length===0)return[];const i=new Array(t.length);for(let a=0;a<t.length;a++)i[a]=new xi({...t[a],startTime:t[a].startTime+this.triggerStartTime,endTime:t[a].endTime+this.triggerStartTime});return i}}class Bi{constructor(e,t,i,a){m(this,"origin");m(this,"anchor");m(this,"startTime",1/0);m(this,"endTime",-1/0);m(this,"filePath");m(this,"commands",[]);m(this,"timelineGroup",new Ai);m(this,"loops",[]);m(this,"triggers",[]);m(this,"startPosition");m(this,"scale",new Le(1,1));m(this,"color",new ur);m(this,"rotation",0);m(this,"flipX",!1);m(this,"flipY",!1);m(this,"isAdditive",!1);this.filePath=e??"",this.origin=t??yt.TopLeft,this.anchor=i??Rt.TopLeft,this.startPosition=a??new Le(0,0)}get startX(){return this.startPosition.floatX}set startX(e){this.startPosition.x=e}get startY(){return this.startPosition.floatY}set startY(e){this.startPosition.y=e}get duration(){return this.endTime-this.startTime}get hasCommands(){return this.timelineGroup.hasCommands||this.loops.some(e=>e.hasCommands)||this.triggers.some(e=>e.hasCommands)}get isDrawable(){return this.color.alpha>=.01&&this.hasCommands}addLoop(e,t){const i=new da(e,t);return this.loops.push(i),i}addTrigger(e,t,i,a){const s=new ma(e,t,i,a);return this.triggers.push(s),s}updateCommands(){const e=[...this.timelineGroup.commands,...this.loops.flatMap(t=>t.unrollCommands())];return this.commands=e.sort((t,i)=>t.startTime-i.startTime),this.commands}adjustTimesToCommands(){let e=this.startTime,t=this.endTime;for(const i of this.commands)e=Math.min(e,i.startTime),t=Math.max(t,i.endTime);this.startTime=e,this.endTime=t}resetValuesToCommands(){const e={};for(const t of this.commands)e[t.type]||(this.setValueFromCommand(t,0),e[t.type]=!0)}setValueFromCommand(e,t){const i=e.getValueAtProgress(t);switch(e.type){case Ze.Movement:this.startPosition.x=i.x,this.startPosition.y=i.y;break;case Ze.MovementX:this.startPosition.x=i;break;case Ze.MovementY:this.startPosition.y=i;break;case Ze.Fade:this.color.alpha=i;break;case Ze.Scale:this.scale.x=i,this.scale.y=i;break;case Ze.VectorScale:this.scale.x=i.x,this.scale.y=i.y;break;case Ze.Rotation:this.rotation=i;break;case Ze.Color:this.color.red=i.red,this.color.green=i.green,this.color.blue=i.blue;break}if(e.type===Ze.Parameter)switch(e.parameter){case cr.BlendingMode:this.isAdditive=i.rgbEquation===1;break;case cr.HorizontalFlip:this.flipX=i;break;case cr.VerticalFlip:this.flipY=i}}}class pa extends Bi{constructor(t,i,a,s,o,l,c){super(t,i,a,s);m(this,"frameCount");m(this,"frameDelay");m(this,"loopType");this.frameCount=o??0,this.frameDelay=l??0,this.loopType=c??bn.LoopForever}}class _a{constructor(e,t,i){m(this,"startTime");m(this,"volume");m(this,"filePath");this.filePath=e??"",this.startTime=t??0,this.volume=i??100}get isDrawable(){return!0}}class ga{constructor(e,t){m(this,"startTime");m(this,"filePath");this.filePath=e??"",this.startTime=t??0}get isDrawable(){return!0}}class Ar{constructor(e){m(this,"name");m(this,"depth");m(this,"masking");m(this,"visibleWhenPassing",!0);m(this,"visibleWhenFailing",!0);m(this,"elements",[]);this.name=e.name,this.depth=e.depth,this.masking=e.masking??!0}}class As{constructor(){m(this,"variables",new Map);m(this,"colors",new Jn);m(this,"useSkinSprites",!1);m(this,"minimumLayerDepth",0);m(this,"fileFormat",14);m(this,"_layers",new Map);this.addLayer(new Ar({name:"Video",depth:4,masking:!1})),this.addLayer(new Ar({name:"Background",depth:3})),this.addLayer(new Ar({name:"Fail",depth:2,visibleWhenPassing:!1})),this.addLayer(new Ar({name:"Pass",depth:1,visibleWhenFailing:!1})),this.addLayer(new Ar({name:"Foreground",depth:0})),this.addLayer(new Ar({name:"Overlay",depth:-2147483648}))}get layers(){return this._layers}get hasDrawable(){for(const e of this.layers.values())if(e.elements.find(t=>t.isDrawable))return!0;return!1}get hasVariables(){for(const e in this.variables)return!0;return!1}get earliestEventTime(){let e=1/0;return this._layers.forEach(t=>{const a=t.elements.reduce((s,o)=>Math.min(s,o.startTime),0);e=Math.min(a,e)}),e===1/0?null:e}get latestEventTime(){let e=-1/0;return this._layers.forEach(t=>{const a=t.elements.reduce((s,o)=>{const l=o;return Math.max(s,(l==null?void 0:l.endTime)??o.startTime)},0);e=Math.max(a,e)}),e===-1/0?null:e}addLayer(e){this._layers.has(e.name)||this._layers.set(e.name,e)}getLayerByType(e){return this.getLayerByName(zt[e]??"Background")}getLayerByName(e){const t=this._layers.get(e)??new Ar({name:e,depth:--this.minimumLayerDepth});return this._layers.has(e)||this._layers.set(e,t),t}}class Li{constructor(){m(this,"backgroundPath",null);m(this,"breaks",[]);m(this,"storyboard",null)}get isBackgroundReplaced(){if(!this.backgroundPath||!this.storyboard)return!1;const e=this.backgroundPath.trim().toLowerCase();return this.storyboard.getLayerByType(zt.Background).elements.some(i=>i.filePath.toLowerCase()===e)}clone(){const e=new Li;return e.backgroundPath=this.backgroundPath,e.breaks=this.breaks,e.storyboard=this.storyboard,e}}let qe;(function(n){n[n.None=0]="None",n[n.Normal=1]="Normal",n[n.Soft=2]="Soft",n[n.Drum=3]="Drum"})(qe||(qe={}));class Ri{constructor(){m(this,"audioFilename","");m(this,"audioHash");m(this,"overlayPosition","NoChange");m(this,"skinPreference","");m(this,"audioLeadIn",0);m(this,"previewTime",-1);m(this,"countdown",1);m(this,"stackLeniency",.7);m(this,"countdownOffset",0);m(this,"sampleSet",qe.Normal);m(this,"letterboxInBreaks",!1);m(this,"storyFireInFront");m(this,"useSkinSprites",!1);m(this,"alwaysShowPlayfield");m(this,"epilepsyWarning",!1);m(this,"specialStyle",!1);m(this,"widescreenStoryboard",!1);m(this,"samplesMatchPlaybackRate",!1)}clone(){const e=new Ri;return e.audioFilename=this.audioFilename,this.audioHash&&(e.audioHash=this.audioHash),e.overlayPosition=this.overlayPosition,e.skinPreference=this.skinPreference,e.audioLeadIn=this.audioLeadIn,e.previewTime=this.previewTime,e.countdown=this.countdown,e.stackLeniency=this.stackLeniency,e.countdownOffset=this.countdownOffset,e.sampleSet=this.sampleSet,e.letterboxInBreaks=this.letterboxInBreaks,this.storyFireInFront&&(e.storyFireInFront=this.storyFireInFront),e.useSkinSprites=this.useSkinSprites,this.alwaysShowPlayfield&&(e.alwaysShowPlayfield=this.alwaysShowPlayfield),e.epilepsyWarning=this.epilepsyWarning,e.specialStyle=this.specialStyle,e.widescreenStoryboard=this.widescreenStoryboard,e.samplesMatchPlaybackRate=this.samplesMatchPlaybackRate,e}}class Oi{constructor(){m(this,"title","Unknown Title");m(this,"artist","Unknown Artist");m(this,"creator","Unknown Creator");m(this,"version","Normal");m(this,"source","");m(this,"tags",[]);m(this,"beatmapId",0);m(this,"beatmapSetId",0);m(this,"_titleUnicode","Unknown Title");m(this,"_artistUnicode","Unknown Artist")}get titleUnicode(){return this._titleUnicode!=="Unknown Title"?this._titleUnicode:this.title}set titleUnicode(e){this._titleUnicode=e}get artistUnicode(){return this._artistUnicode!=="Unknown Artist"?this._artistUnicode:this.artist}set artistUnicode(e){this._artistUnicode=e}clone(){const e=new Oi;return e.title=this.title,e.titleUnicode=this.titleUnicode,e.artist=this.artist,e.artistUnicode=this.artistUnicode,e.creator=this.creator,e.version=this.version,e.source=this.source,e.tags=this.tags.slice(),e.beatmapId=this.beatmapId,e.beatmapSetId=this.beatmapSetId,e}}class $n{constructor(e){m(this,"group");this.group=e||null}attachGroup(e){this.group=e}dettachGroup(){this.group=null}get startTime(){return this.group?this.group.startTime:0}}class Bs{constructor(e){m(this,"controlPoints",[]);m(this,"startTime");this.startTime=e}add(e){const t=this.controlPoints.find(i=>i.pointType===e.pointType);t&&this.remove(t),e.attachGroup(this),this.controlPoints.push(e)}remove(e){const t=this.controlPoints.findIndex(i=>i.pointType===e.pointType);t!==-1&&(this.controlPoints.splice(t,1),e.dettachGroup())}}function Ls(n,e){let t=0,i,a=n.length-1;for(;t<=a;){if(i=t+(a-t>>1),n[i]===e)return i;n[i]<e?t=i+1:a=i-1}return~t}function va(n,e){if(!n.length||e<n[0].startTime)return-1;if(e>=n[n.length-1].startTime)return n.length-1;let t=0,i=n.length-2;for(;t<=i;){const a=t+(i-t>>1);if(n[a].startTime<e)t=a+1;else if(n[a].startTime>e)i=a-1;else return a}return t-1}function Kr(n,e){const t=va(n,e);return t===-1?null:n[t]}function Rs(n){const e=n.length,t=[];for(let i=0;i<e;i++){t[i]=1;for(let a=0;a<e;a++)i!==a&&(t[i]*=n[i].floatX-n[a].floatX);t[i]=1/t[i]}return t}function Os(n,e,t){if(n===null||n.length===0)throw new Error("points must contain at least one point");if(n.length!==e.length)throw new Error("points must contain exactly as many items as weights");let i=0,a=0;for(let s=0,o=n.length;s<o;++s){if(t===n[s].floatX)return n[s].floatY;const l=e[s]/(t-n[s].floatX);i+=l*n[s].floatY,a+=l}return i/a}const Nt=class Nt{constructor(e){m(this,"_y",842502087);m(this,"_z",3579807591);m(this,"_w",273326509);m(this,"_x",0);m(this,"_bitBuffer",0);m(this,"_bitIndex",32);this._x=e}_next(){const e=(this._x^this._x<<11>>>0)>>>0;return this._x=this._y>>>0,this._y=this._z>>>0,this._z=this._w>>>0,this._w=(this._w^this._w>>>19)>>>0,this._w=(this._w^e)>>>0,this._w=(this._w^e>>>8)>>>0,this._w}next(){return(Nt.INT_MASK&this._next())>>0}nextUInt(e=0,t=Nt.MAX_INT32){return e===0&&t===Nt.MAX_INT32?this._next():e+this.nextDouble()*(t-e)>>>0}nextInt(e=0,t=Nt.MAX_INT32){return e+this.nextDouble()*(t-e)>>0}nextDouble(){return Nt.INT_TO_REAL*this.next()}nextBool(){return this._bitIndex===32?(this._bitBuffer=this.nextUInt(),this._bitIndex=1,(this._bitBuffer&1)===1):(this._bitIndex=this._bitIndex+1>>0,((this._bitBuffer>>=1)&1)===1)}};m(Nt,"MAX_INT32",2147483647),m(Nt,"MAX_UINT32",4294967295),m(Nt,"INT_MASK",2147483647),m(Nt,"INT_TO_REAL",1/(Nt.MAX_INT32+1));let Ji=Nt;class ba{static round(e,t=1){return t?this.roundToEven(e):this.roundAwayFromZero(e)}static roundToEven(e){return this.isAtMidPoint(e)?2*Math.round(e/2):Math.round(e)}static roundAwayFromZero(e){return this.isAtMidPoint(e)?e>0?Math.ceil(e):Math.floor(e):Math.round(e)}static isAtMidPoint(e){return Math.abs(.5-Math.abs(e-(e>>0)))<=this.PRECISION_ERROR}}m(ba,"PRECISION_ERROR",1e-15);let ot;(function(n){n[n.TimingPoint=0]="TimingPoint",n[n.DifficultyPoint=1]="DifficultyPoint",n[n.EffectPoint=2]="EffectPoint",n[n.SamplePoint=3]="SamplePoint"})(ot||(ot={}));const Cr=class Cr extends $n{constructor(){super(...arguments);m(this,"pointType",ot.DifficultyPoint);m(this,"generateTicks",!0);m(this,"isLegacy",!1);m(this,"sliderVelocityUnlimited",1);m(this,"bpmMultiplier",1)}get sliderVelocity(){return on(this.sliderVelocityUnlimited,.1,10)}set sliderVelocity(t){this.sliderVelocityUnlimited=t}isRedundant(t){return t instanceof Cr&&t.sliderVelocity===this.sliderVelocity&&t.generateTicks===this.generateTicks}equals(t){return t instanceof Cr&&this.sliderVelocity===t.sliderVelocity}};m(Cr,"default",new Cr);let Vn=Cr;const $r=class $r extends $n{constructor(){super(...arguments);m(this,"pointType",ot.EffectPoint);m(this,"kiai",!1);m(this,"omitFirstBarLine",!1);m(this,"scrollSpeedUnlimited",1)}get scrollSpeed(){return on(this.scrollSpeedUnlimited,.1,10)}set scrollSpeed(t){this.scrollSpeedUnlimited=t}isRedundant(t){return!this.omitFirstBarLine&&t instanceof $r&&this.kiai===t.kiai&&this.omitFirstBarLine===t.omitFirstBarLine&&this.scrollSpeed===t.scrollSpeed}equals(t){return t instanceof $r&&this.kiai===t.kiai&&this.omitFirstBarLine===t.omitFirstBarLine&&this.scrollSpeed===t.scrollSpeed}};m($r,"default",new $r);let Wn=$r;const en=class en extends $n{constructor(){super(...arguments);m(this,"pointType",ot.SamplePoint);m(this,"sampleSet",qe[qe.Normal]);m(this,"customIndex",0);m(this,"volume",100)}isRedundant(t){return t instanceof en&&this.volume===t.volume&&this.customIndex===t.customIndex&&this.sampleSet===t.sampleSet}equals(t){return t instanceof en&&this.volume===t.volume&&this.customIndex===t.customIndex&&this.sampleSet===t.sampleSet}};m(en,"default",new en);let Yn=en,Sn;(function(n){n[n.SimpleTriple=3]="SimpleTriple",n[n.SimpleQuadruple=4]="SimpleQuadruple"})(Sn||(Sn={}));const Rr=class Rr extends $n{constructor(){super(...arguments);m(this,"pointType",ot.TimingPoint);m(this,"beatLengthUnlimited",Rr.DEFAULT_BEAT_LENGTH);m(this,"timeSignature",Sn.SimpleQuadruple)}get beatLength(){return on(this.beatLengthUnlimited,6,6e4)}set beatLength(t){this.beatLengthUnlimited=t}get bpmUnlimited(){return 6e4/this.beatLengthUnlimited}get bpm(){return 6e4/this.beatLength}isRedundant(){return!1}equals(t){return t instanceof Rr&&this.timeSignature===t.timeSignature&&this.beatLength===t.beatLength}};m(Rr,"default",new Rr),m(Rr,"DEFAULT_BEAT_LENGTH",1e3);let zr=Rr;class Fi{constructor(){m(this,"groups",[]);m(this,"difficultyPoints",[]);m(this,"effectPoints",[]);m(this,"samplePoints",[]);m(this,"timingPoints",[])}get allPoints(){const e=[];return this.groups.forEach(t=>e.push(...t.controlPoints)),e}groupAt(e){let t=this.groups.find(i=>i.startTime===e);return t||(t=new Bs(e),this.groups.push(t),this.groups.sort((i,a)=>i.startTime-a.startTime)),t}difficultyPointAt(e){const t=Kr(this.difficultyPoints,e),i=Vn.default;return t||i}effectPointAt(e){const t=Kr(this.effectPoints,e),i=Wn.default;return t||i}samplePointAt(e){const t=Kr(this.samplePoints,e),i=Yn.default;return t||i}timingPointAt(e){const t=Kr(this.timingPoints,e),i=this.timingPoints[0]||zr.default;return t||i}add(e,t){if(this.checkAlreadyExisting(t,e))return!1;const i=this.getCurrentList(e),a=va(i,t);return i.splice(a+1,0,e),this.groupAt(t).add(e),!0}getCurrentList(e){switch(e.pointType){case ot.DifficultyPoint:return this.difficultyPoints;case ot.EffectPoint:return this.effectPoints;case ot.SamplePoint:return this.samplePoints;case ot.TimingPoint:return this.timingPoints}throw new TypeError(`Unknown control point type: ${e.pointType}!`)}checkAlreadyExisting(e,t){let i=null;switch(t.pointType){case ot.DifficultyPoint:i=this.difficultyPointAt(e);break;case ot.EffectPoint:i=this.effectPointAt(e);break;case ot.SamplePoint:i=Kr(this.samplePoints,e);break;case ot.TimingPoint:i=Kr(this.timingPoints,e)}return t==null?void 0:t.isRedundant(i)}remove(e,t){let i;switch(e.pointType){case ot.DifficultyPoint:i=this.difficultyPoints;break;case ot.EffectPoint:i=this.effectPoints;break;case ot.SamplePoint:i=this.samplePoints;break;default:i=this.timingPoints}const a=i.findIndex(s=>s.startTime===e.startTime);return a===-1?!1:(i.splice(a,1),this.groupAt(t).remove(e),!0)}clear(){this.groups.length=0,this.difficultyPoints.length=0,this.effectPoints.length=0,this.samplePoints.length=0,this.timingPoints.length=0}clone(){const e=new Fi;return e.groups=this.groups,e.difficultyPoints=this.difficultyPoints,e.effectPoints=this.effectPoints,e.samplePoints=this.samplePoints,e.timingPoints=this.timingPoints,e}}let rt;(function(n){n[n.None=0]="None",n[n.Normal=1]="Normal",n[n.Whistle=2]="Whistle",n[n.Finish=4]="Finish",n[n.Clap=8]="Clap"})(rt||(rt={}));let nt;(function(n){n[n.Normal=1]="Normal",n[n.Slider=2]="Slider",n[n.NewCombo=4]="NewCombo",n[n.Spinner=8]="Spinner",n[n.ComboSkip1=16]="ComboSkip1",n[n.ComboSkip2=32]="ComboSkip2",n[n.ComboSkip3=64]="ComboSkip3",n[n.ComboOffset=112]="ComboOffset",n[n.Hold=128]="Hold"})(nt||(nt={}));let Pt;(function(n){n.Catmull="C",n.Bezier="B",n.Linear="L",n.PerfectCurve="P"})(Pt||(Pt={}));let Zt;(function(n){n[n.Tick=1]="Tick",n[n.LegacyLastTick=2]="LegacyLastTick",n[n.Head=4]="Head",n[n.Tail=8]="Tail",n[n.Repeat=16]="Repeat"})(Zt||(Zt={}));class yi{static*generate(e){const t=Math.min(this.SLIDER_MAX_DISTANCE,e.path.distance),i=on(e.tickDistance||0,0,t),a=e.velocity*10;let s=e.startTime;if(yield{eventType:Zt.Head,startTime:s,spanStartTime:s,spanIndex:0,progress:0},i!==0&&i!==1/0)for(let h=0;h<e.spans;++h){const w=!!(h&1),d=[];let S=i;for(;S<t-a;){const v=S/t,y=w?1-v:v;d.push({eventType:Zt.Tick,startTime:s+y*e.spanDuration,spanStartTime:s,spanIndex:h,progress:v}),S+=i}w&&d.reverse();for(const v of d)yield v;h<e.repeats&&(yield{eventType:Zt.Repeat,startTime:s+e.spanDuration,spanStartTime:s,spanIndex:h,progress:h+1&1}),s+=e.spanDuration}const o=e.spans*e.spanDuration,l=e.spans-1,c=e.startTime+l*e.spanDuration,p=Math.max(e.startTime+o/2,c+e.spanDuration-(e.legacyLastTickOffset||0));let g=(p-c)/e.spanDuration;e.spans&1||(g=1-g),yield{eventType:Zt.LegacyLastTick,startTime:p,spanStartTime:c,spanIndex:l,progress:g},yield{eventType:Zt.Tail,startTime:e.startTime+o,spanStartTime:c,spanIndex:l,progress:e.spans%2}}}m(yi,"SLIDER_MAX_DISTANCE",1e5);class xt{constructor(e,t,i,a){m(this,"result");m(this,"min");m(this,"average");m(this,"max");this.result=e,this.min=t,this.average=i,this.max=a}static map(e,t,i,a){return e>5?i+(a-i)*(e-5)/5:e<5?i-(i-t)*(5-e)/5:i}}let Ie;(function(n){n[n.None=0]="None",n[n.Miss=1]="Miss",n[n.Meh=2]="Meh",n[n.Ok=3]="Ok",n[n.Good=4]="Good",n[n.Great=5]="Great",n[n.Perfect=6]="Perfect",n[n.SmallTickMiss=7]="SmallTickMiss",n[n.SmallTickHit=8]="SmallTickHit",n[n.LargeTickMiss=9]="LargeTickMiss",n[n.LargeTickHit=10]="LargeTickHit",n[n.SmallBonus=11]="SmallBonus",n[n.LargeBonus=12]="LargeBonus",n[n.IgnoreMiss=13]="IgnoreMiss",n[n.IgnoreHit=14]="IgnoreHit"})(Ie||(Ie={}));var Nr;const wr=class wr{constructor(){m(this,"_perfect",0);m(this,"_great",0);m(this,"_good",0);m(this,"_ok",0);m(this,"_meh",0);m(this,"_miss",0)}_lowestSuccessfulHitResult(){for(let e=Ie.Meh;e<=Ie.Perfect;++e)if(this.isHitResultAllowed(e))return e;return Ie.None}*getAllAvailableWindows(){for(let e=Ie.Meh;e<=Ie.Perfect;++e)this.isHitResultAllowed(e)&&(yield[e,this.windowFor(e)])}isHitResultAllowed(e){return!0}setDifficulty(e){for(const t of this._getRanges()){const i=xt.map(e,t.min,t.average,t.max);switch(t.result){case Ie.Miss:this._miss=i;break;case Ie.Meh:this._meh=i;break;case Ie.Ok:this._ok=i;break;case Ie.Good:this._good=i;break;case Ie.Great:this._great=i;break;case Ie.Perfect:this._perfect=i;break}}}resultFor(e){e=Math.abs(e);for(let t=Ie.Perfect;t>=Ie.Miss;--t)if(this.isHitResultAllowed(t)&&e<=this.windowFor(t))return t;return Ie.None}windowFor(e){switch(e){case Ie.Perfect:return this._perfect;case Ie.Great:return this._great;case Ie.Good:return this._good;case Ie.Ok:return this._ok;case Ie.Meh:return this._meh;case Ie.Miss:return this._miss;default:throw new Error("Unknown enum member")}}canBeHit(e){return e<=this.windowFor(this._lowestSuccessfulHitResult())}_getRanges(){return wr._BASE_RANGES}};m(wr,"_BASE_RANGES",[new xt(Ie.Perfect,22.4,19.4,13.9),new xt(Ie.Great,64,49,34),new xt(Ie.Good,97,82,67),new xt(Ie.Ok,127,112,97),new xt(Ie.Meh,151,136,121),new xt(Ie.Miss,188,173,158)]),m(wr,"EmptyHitWindows",(Nr=class extends wr{isHitResultAllowed(t){switch(t){case Ie.Perfect:case Ie.Miss:return!0}return!1}_getRanges(){return Nr._ranges}},m(Nr,"_ranges",[new xt(Ie.Perfect,0,0,0),new xt(Ie.Miss,0,0,0)]),Nr)),m(wr,"empty",new wr.EmptyHitWindows);let Xn=wr;class kn{constructor(){m(this,"kiai",!1);m(this,"nestedHitObjects",[]);m(this,"startTime",0);m(this,"hitType",nt.Normal);m(this,"hitSound",rt.Normal);m(this,"samples",[]);m(this,"startPosition",new Le(0,0));m(this,"hitWindows",new Xn)}get startX(){return this.startPosition.floatX}set startX(e){this.startPosition.x=e}get startY(){return this.startPosition.floatY}set startY(e){this.startPosition.y=e}createNestedHitObjects(){this.nestedHitObjects=[]}applyDefaultsToSelf(e,t){var i;this.kiai=e.effectPointAt(this.startTime+1).kiai,(i=this.hitWindows)==null||i.setDifficulty(t.overallDifficulty)}applyDefaultsToNested(e,t){this.nestedHitObjects.forEach(i=>{i.applyDefaults(e,t)})}applyDefaults(e,t){this.applyDefaultsToSelf(e,t),this.nestedHitObjects=[],this.createNestedHitObjects(),this.nestedHitObjects.sort((i,a)=>i.startTime-a.startTime),this.applyDefaultsToNested(e,t)}clone(){const e=this.constructor,t=new e;return t.startPosition=this.startPosition.clone(),t.startTime=this.startTime,t.hitType=this.hitType,t.hitSound=this.hitSound,t.samples=this.samples.map(i=>i.clone()),t.kiai=this.kiai,t}}const Dt=class Dt{static approximateBezier(e){return this.approximateBSpline(e)}static approximateBSpline(e,t=0){const i=[],a=e.length-1;if(a<0)return i;const s=[],o=[],l=e.slice();if(t>0&&t<a){for(let h=0;h<a-t;++h){const w=[l[h]];for(let d=0;d<t-1;++d){w[d+1]=l[h+1];for(let S=1;S<t-d;++S){const v=Math.min(S,a-t-h);l[h+S]=l[h+S].fscale(v).fadd(l[h+S+1]).fdivide(v+1)}}w[t]=l[h+1],s.push(w)}s.push(l.slice(a-t)),s.reverse()}else t=a,s.push(l);const c=[],p=[],g=p;for(;s.length>0;){const h=s.pop()||[];if(this._bezierIsFlatEnough(h)){this._bezierApproximate(h,i,c,p,t+1),o.push(h);continue}const w=o.pop()||[];this._bezierSubdivide(h,g,w,c,t+1);for(let d=0;d<t+1;++d)h[d]=g[d];s.push(w),s.push(h)}return i.push(e[a]),i}static approximateCatmull(e){const t=[],i=e.length;for(let a=0;a<i-1;a++){const s=a>0?e[a-1]:e[a],o=e[a],l=a<i-1?e[a+1]:o.fadd(o).fsubtract(s),c=a<i-2?e[a+2]:l.fadd(l).fsubtract(o);for(let p=0;p<Dt.CATMULL_DETAIL;p++)t.push(Dt._catmullFindPoint(s,o,l,c,Math.fround(Math.fround(p)/Dt.CATMULL_DETAIL))),t.push(Dt._catmullFindPoint(s,o,l,c,Math.fround(Math.fround(p+1)/Dt.CATMULL_DETAIL)))}return t}static approximateCircularArc(e){const t=this._circularArcProperties(e);if(!t.isValid)return this.approximateBezier(e);let i=2;if(2*t.radius>Dt.CIRCULAR_ARC_TOLERANCE){let s=Math.fround(Dt.CIRCULAR_ARC_TOLERANCE/t.radius);s=Math.fround(1-s),s=Math.fround(2*Math.fround(Math.acos(s)));const o=Math.ceil(Math.fround(t.thetaRange/s)),l=isFinite(o)?o:-2147483648;i=Math.max(2,l)}const a=[];for(let s=0;s<i;++s){const o=s/(i-1),l=t.thetaStart+t.direction*o*t.thetaRange,c=new Le(Math.fround(Math.cos(l)),Math.fround(Math.sin(l)));a.push(c.fscale(t.radius).fadd(t.centre))}return a}static _circularArcProperties(e){const t=e[0],i=e[1],a=e[2],s=Math.fround(Math.fround(i.floatY-t.floatY)*Math.fround(a.floatX-t.floatX)-Math.fround(i.floatX-t.floatX)*Math.fround(a.floatY-t.floatY));if(Math.abs(s)<Math.fround(.001))return new Ci;const o=Math.fround(2*Math.fround(Math.fround(t.floatX*i.fsubtract(a).floatY)+Math.fround(i.floatX*a.fsubtract(t).floatY)+Math.fround(a.floatX*t.fsubtract(i).floatY))),l=Math.fround(Math.fround(t.floatX*t.floatX)+Math.fround(t.floatY*t.floatY)),c=Math.fround(Math.fround(i.floatX*i.floatX)+Math.fround(i.floatY*i.floatY)),p=Math.fround(Math.fround(a.floatX*a.floatX)+Math.fround(a.floatY*a.floatY)),g=new Le(Math.fround(Math.fround(Math.fround(l*i.fsubtract(a).floatY)+Math.fround(c*a.fsubtract(t).floatY))+Math.fround(p*t.fsubtract(i).floatY)),Math.fround(Math.fround(Math.fround(l*a.fsubtract(i).floatX)+Math.fround(c*t.fsubtract(a).floatX))+Math.fround(p*i.fsubtract(t).floatX))).fdivide(o),h=t.fsubtract(g),w=a.fsubtract(g),d=h.flength(),S=Math.atan2(h.floatY,h.floatX);let v=Math.atan2(w.floatY,w.floatX);for(;v<S;)v+=2*Math.PI;let y=1,b=v-S,M=a.fsubtract(t);return M=new Le(M.floatY,-M.floatX),M.fdot(i.fsubtract(t))<0&&(y=-y,b=2*Math.PI-b),new Ci(S,b,y,d,g)}static approximateLinear(e){return e.slice()}static approximateLagrangePolynomial(e){const i=[],a=Rs(e);let s=e[0].floatX,o=e[0].floatX;for(let c=1,p=e.length;c<p;c++)s=Math.min(s,e[c].floatX),o=Math.max(o,e[c].floatX);const l=o-s;for(let c=0;c<51;c++){const p=s+l/50*c,g=Math.fround(Os(e,a,p));i.push(new Le(p,g))}return i}static _bezierIsFlatEnough(e){let t;for(let i=1,a=e.length;i<a-1;i++)if(t=e[i-1].fsubtract(e[i].fscale(2)).fadd(e[i+1]),t.flength()**2>Dt.BEZIER_TOLERANCE**2*4)return!1;return!0}static _bezierSubdivide(e,t,i,a,s){const o=a;for(let l=0;l<s;++l)o[l]=e[l];for(let l=0;l<s;++l){t[l]=o[0],i[s-l-1]=o[s-l-1];for(let c=0;c<s-l-1;c++)o[c]=o[c].fadd(o[c+1]).fdivide(2)}}static _bezierApproximate(e,t,i,a,s){const o=a,l=i;Dt._bezierSubdivide(e,o,l,i,s);for(let c=0;c<s-1;++c)o[s+c]=l[c+1];t.push(e[0]);for(let c=1;c<s-1;++c){const p=2*c,g=o[p-1].fadd(o[p].fscale(2)).fadd(o[p+1]).fscale(Math.fround(.25));t.push(g)}}static _catmullFindPoint(e,t,i,a,s){const o=Math.fround(s*s),l=Math.fround(s*o),c=[];for(let p=0;p<=1;++p){const g=p===0?e.floatX:e.floatY,h=p===0?t.floatX:t.floatY,w=p===0?i.floatX:i.floatY,d=p===0?a.floatX:a.floatY,S=Math.fround(2*h),v=Math.fround(w-g),y=Math.fround(2*g),b=Math.fround(5*h),M=Math.fround(4*w),L=Math.fround(3*h),z=Math.fround(3*w),x=Math.fround(v*s),W=Math.fround(y-b),H=Math.fround(W+M),K=Math.fround(H-d),G=Math.fround(K),ee=Math.fround(L-g),_e=Math.fround(ee-z),B=Math.fround(_e+d),q=Math.fround(G*o),_=Math.fround(B*l),$=Math.fround(S+x),Me=Math.fround($+q),ie=Math.fround(Me+_);c.push(Math.fround(Math.fround(.5)*ie))}return new Le(c[0],c[1])}};m(Dt,"BEZIER_TOLERANCE",Math.fround(.25)),m(Dt,"CIRCULAR_ARC_TOLERANCE",Math.fround(.1)),m(Dt,"CATMULL_DETAIL",50);let qr=Dt;class Ci{constructor(e,t,i,a,s){m(this,"isValid");m(this,"thetaStart");m(this,"thetaRange");m(this,"direction");m(this,"radius");m(this,"centre");this.isValid=!!(e||t||i||a||s),this.thetaStart=e||0,this.thetaRange=t||0,this.direction=i||0,this.radius=a?Math.fround(a):0,this.centre=s||new Le(0,0)}get thetaEnd(){return this.thetaStart+this.thetaRange*this.direction}}class Pi{constructor(e,t){m(this,"position");m(this,"type");this.position=e||new Le(0,0),this.type=t||null}}class ei{constructor(e,t,i){m(this,"_expectedDistance");m(this,"_controlPoints");m(this,"_curveType");m(this,"_calculatedLength",0);m(this,"_calculatedPath",[]);m(this,"_cumulativeLength",[]);m(this,"_isCached",!1);this._curveType=e||Pt.Linear,this._controlPoints=t||[],this._expectedDistance=i||0}get curveType(){return this._curveType}set curveType(e){this._curveType=e,this.invalidate()}get controlPoints(){return this._controlPoints}set controlPoints(e){this._controlPoints=e,this.invalidate()}get expectedDistance(){return this._expectedDistance}set expectedDistance(e){this._expectedDistance=e,this.invalidate()}get distance(){return this._ensureValid(),this._cumulativeLength.length?this._cumulativeLength[this._cumulativeLength.length-1]:0}set distance(e){this.expectedDistance=e}get calculatedDistance(){return this._ensureValid(),this._calculatedLength}get path(){this._ensureValid();const e=[];for(let t=0;t<this._calculatedPath.length&&!(this._cumulativeLength[t]>=this.expectedDistance);t++)e.push(this._calculatedPath[t]);return e.push(this.positionAt(1)),e}get calculatedPath(){return this._ensureValid(),this._calculatedPath}invalidate(){this._calculatedLength=0,this._calculatedPath=[],this._cumulativeLength=[],this._isCached=!1}calculatePathToProgress(e,t,i){this._ensureValid();const a=this._progressToDistance(t),s=this._progressToDistance(i);let o=0;for(;o<this._calculatedPath.length&&this._cumulativeLength[o]<a;)++o;for(e=[this._interpolateVertices(o,a)];o<this._calculatedPath.length&&this._cumulativeLength[o++]<=s;)e.push(this._calculatedPath[o]);e.push(this._interpolateVertices(o,s))}progressAt(e,t){const i=e*t%1;return Math.trunc(e*t)%2?1-i:i}positionAt(e){this._ensureValid();const t=this._progressToDistance(e);return this._interpolateVertices(this._indexOfDistance(t),t)}curvePositionAt(e,t){return this.positionAt(this.progressAt(e,t))}clone(){const e=this._controlPoints.map(t=>new Pi(t.position.clone(),t.type));return new ei(this._curveType,e,this._expectedDistance)}_ensureValid(){this._isCached||(this._calculatePath(),this._calculateLength(),this._isCached=!0)}_calculatePath(){this._calculatedPath=[];const e=this.controlPoints.length;if(e===0)return;const t=[];for(let a=0;a<e;a++)t[a]=this.controlPoints[a].position;let i=0;for(let a=0;a<e;++a){if(!this.controlPoints[a].type&&a<e-1)continue;const s=t.slice(i,a+1),o=this.controlPoints[i].type||Pt.Linear;for(const l of this._calculateSubPath(s,o)){const c=this._calculatedPath[this._calculatedPath.length-1];(this._calculatedPath.length===0||!c.equals(l))&&this._calculatedPath.push(l)}i=a}}_calculateSubPath(e,t){switch(t){case Pt.Linear:return qr.approximateLinear(e);case Pt.PerfectCurve:{if(e.length!==3)break;const i=qr.approximateCircularArc(e);if(i.length===0)break;return i}case Pt.Catmull:return qr.approximateCatmull(e)}return qr.approximateBezier(e)}_calculateLength(){this._calculatedLength=0,this._cumulativeLength=[0];for(let e=0,t=this._calculatedPath.length-1;e<t;++e){const i=this._calculatedPath[e+1].fsubtract(this._calculatedPath[e]);this._calculatedLength+=i.flength(),this._cumulativeLength.push(this._calculatedLength)}if(this.expectedDistance&&this._calculatedLength!==this.expectedDistance){const e=this.controlPoints,t=e[e.length-1],i=e[e.length-2];if(e.length>=2&&t.position.equals(i.position)&&this.expectedDistance>this._calculatedLength){this._cumulativeLength.push(this._calculatedLength);return}this._cumulativeLength.pop();let s=this._calculatedPath.length-1;if(this._calculatedLength>this.expectedDistance)for(;this._cumulativeLength.length>0&&this._cumulativeLength[this._cumulativeLength.length-1]>=this.expectedDistance;)this._cumulativeLength.pop(),this._calculatedPath.splice(s--,1);if(s<=0){this._cumulativeLength.push(0);return}const o=this._calculatedPath[s].fsubtract(this._calculatedPath[s-1]).fnormalize(),l=Math.fround(this.expectedDistance-this._cumulativeLength[this._cumulativeLength.length-1]);this._calculatedPath[s]=this._calculatedPath[s-1].fadd(o.fscale(l)),this._cumulativeLength.push(this.expectedDistance)}}_indexOfDistance(e){let t=Ls(this._cumulativeLength,e);return t<0&&(t=~t),t}_progressToDistance(e){return Cn(e)*this.distance}_interpolateVertices(e,t){if(this._calculatedPath.length===0)return new Le(0,0);if(e<=0)return this._calculatedPath[0];if(e>=this._calculatedPath.length)return this._calculatedPath[this._calculatedPath.length-1];const i=this._calculatedPath[e-1],a=this._calculatedPath[e],s=this._cumulativeLength[e-1],o=this._cumulativeLength[e];if(Math.abs(s-o)<.001)return i;const l=(t-s)/(o-s);return i.fadd(a.fsubtract(i).fscale(l))}}class Br{constructor(){m(this,"sampleSet",qe[qe.None]);m(this,"hitSound",rt[rt.Normal]);m(this,"customIndex",0);m(this,"suffix","");m(this,"volume",100);m(this,"isLayered",!1);m(this,"filename","")}clone(){const e=new Br;return e.sampleSet=this.sampleSet,e.hitSound=this.hitSound,e.customIndex=this.customIndex,e.suffix=this.suffix,e.volume=this.volume,e.isLayered=this.isLayered,e.filename=this.filename,e}}class Ni{constructor(){m(this,"filename","");m(this,"volume",100);m(this,"normalSet",qe.Normal);m(this,"additionSet",qe.Normal);m(this,"customIndex",0)}clone(){const e=new Ni;return e.filename=this.filename,e.volume=this.volume,e.normalSet=this.normalSet,e.additionSet=this.additionSet,e.customIndex=this.customIndex,e}}class wa{constructor(){m(this,"base");m(this,"general",new Ri);m(this,"editor",new Di);m(this,"difficulty",new vn);m(this,"metadata",new Oi);m(this,"colors",new Jn);m(this,"events",new Li);m(this,"controlPoints",new Fi);m(this,"hitObjects",[]);m(this,"fileFormat",14);m(this,"fileUpdateDate",new Date);m(this,"originalMode",0)}get mode(){return this.originalMode}get length(){if(!this.hitObjects.length)return 0;const e=this.hitObjects[0],t=this.hitObjects[this.hitObjects.length-1],i=t,a=e.startTime;return((i.endTime||t.startTime)-a)/this.difficulty.clockRate}get totalLength(){if(!this.hitObjects.length)return 0;const e=this.hitObjects[this.hitObjects.length-1];return(e.endTime||e.startTime)/this.difficulty.clockRate}_getLongestBeatLength(e){const t=this.controlPoints.timingPoints.reduce((i,a)=>{const s=e?a.beatLengthUnlimited:a.beatLength;return s>=0?Math.max(s,i):i},-1/0);return isFinite(t)?t:zr.DEFAULT_BEAT_LENGTH}get bpmMin(){return 6e4/this._getLongestBeatLength(!1)*this.difficulty.clockRate}get bpmMinUnlimited(){return 6e4/this._getLongestBeatLength(!0)*this.difficulty.clockRate}_getShortestBeatLength(e){const t=this.controlPoints.timingPoints.reduce((i,a)=>{const s=e?a.beatLengthUnlimited:a.beatLength;return s>=0?Math.min(s,i):i},1/0);return isFinite(t)?t:zr.DEFAULT_BEAT_LENGTH}get bpmMax(){return 6e4/this._getShortestBeatLength(!1)*this.difficulty.clockRate}get bpmMaxUnlimited(){return 6e4/this._getShortestBeatLength(!0)*this.difficulty.clockRate}_getMostCommonBeatLength(e){var o;if(!this.controlPoints.timingPoints.length)return zr.DEFAULT_BEAT_LENGTH;const t=this.controlPoints.timingPoints,i=this.hitObjects.at(-1),a=(i==null?void 0:i.endTime)??(i==null?void 0:i.startTime)??((o=t.at(-1))==null?void 0:o.startTime)??0,s=new Map;return t.forEach((l,c)=>{const p=e?l.beatLengthUnlimited:l.beatLength,g=ba.round(p*1e3)/1e3;if(s.has(g)||s.set(g,0),l.startTime>a)return;const h=c===0?0:l.startTime,w=c===t.length-1?a:t[c+1].startTime,d=s.get(g)??0;s.set(g,d+(w-h))}),s.size===0?this.bpmMax:[...s.entries()].sort((l,c)=>c[1]-l[1])[0][0]}get bpm(){return 6e4/this._getMostCommonBeatLength(!1)*this.difficulty.clockRate}get bpmUnlimited(){return 6e4/this._getMostCommonBeatLength(!0)*this.difficulty.clockRate}get totalBreakTime(){return(this.events.breaks||[]).reduce((e,t)=>e+t.duration,0)}get hittable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&nt.Normal?1:0),0)}get slidable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&nt.Slider?1:0),0)}get spinnable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&nt.Spinner?1:0),0)}get holdable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&nt.Hold?1:0),0)}clone(){const e=this.constructor,t=new e;return t.general=this.general.clone(),t.editor=this.editor.clone(),t.difficulty=this.difficulty.clone(),t.metadata=this.metadata.clone(),t.colors=this.colors.clone(),t.events=this.events.clone(),t.controlPoints=this.controlPoints.clone(),t.hitObjects=this.hitObjects.map(i=>i.clone()),t.originalMode=this.originalMode,t.fileFormat=this.fileFormat,this.base&&(t.base=this.base),t}}class Fs{convertBeatmap(e){const t=this.createBeatmap();t.general=e.general,t.editor=e.editor,t.difficulty=e.difficulty.clone(),t.metadata=e.metadata,t.colors=e.colors,t.events=e.events,t.controlPoints=e.controlPoints,t.fileFormat=e.fileFormat,t.originalMode=e.originalMode,t.base=e.base??e;for(const i of this.convertHitObjects(t.base))t.hitObjects.push(i);return t.hitObjects.sort((i,a)=>i.startTime-a.startTime),t}}class Ns{preProcess(e){const i=e.hitObjects.filter(s=>{const o=s;if(typeof o.comboIndex=="number")return o});let a=null;for(let s=0;s<i.length;s++){const o=i[s];s===0&&(i[s].hitType|=nt.NewCombo,i[s].isNewCombo=!0),o.comboIndex=(a==null?void 0:a.comboIndex)??0,o.comboIndexWithOffsets=(a==null?void 0:a.comboIndexWithOffsets)??0,o.currentComboIndex=((a==null?void 0:a.currentComboIndex)??-1)+1,o.isNewCombo&&(o.currentComboIndex=0,o.comboIndex++,o.comboIndexWithOffsets+=o.comboOffset+1,a!==null&&(a.lastInCombo=!0)),a=o}return e}postProcess(e){return e}}let tr;(function(n){n[n.None=0]="None",n[n.Kiai=1]="Kiai",n[n.OmitFirstBarLine=8]="OmitFirstBarLine"})(tr||(tr={}));class zs{constructor(e,t){m(this,"startTime");m(this,"endTime");this.startTime=e,this.endTime=t}get duration(){return this.endTime-this.startTime}get hasEffect(){return this.duration>=650}contains(e){return this.startTime<=e&&e<=this.endTime}}class Zn{constructor(e){m(this,"_baseBeatmap");m(this,"hitObjects",[]);this._baseBeatmap=e}get general(){return this._baseBeatmap.general}set general(e){this._baseBeatmap.general=e}get editor(){return this._baseBeatmap.editor}set editor(e){this._baseBeatmap.editor=e}get difficulty(){return this._baseBeatmap.difficulty}set difficulty(e){this._baseBeatmap.difficulty=e}get metadata(){return this._baseBeatmap.metadata}set metadata(e){this._baseBeatmap.metadata=e}get colors(){return this._baseBeatmap.colors}set colors(e){this._baseBeatmap.colors=e}get events(){return this._baseBeatmap.events}set events(e){this._baseBeatmap.events=e}get controlPoints(){return this._baseBeatmap.controlPoints}set controlPoints(e){this._baseBeatmap.controlPoints=e}get mode(){return this._baseBeatmap.mode}get originalMode(){return this._baseBeatmap.originalMode}get fileFormat(){return this._baseBeatmap.fileFormat}get length(){return this._baseBeatmap.length}get bpmMin(){return this._baseBeatmap.bpmMin}get bpmMax(){return this._baseBeatmap.bpmMax}get bpm(){return this._baseBeatmap.bpm}get totalBreakTime(){return this._baseBeatmap.totalBreakTime}clone(){return new Zn(this._baseBeatmap)}}class Us extends wa{clone(){const e=super.clone();return e.mods=this.mods.clone(),e}}class js{constructor(e,t){m(this,"mods");m(this,"starRating");m(this,"maxCombo",0);this.mods=e,this.starRating=t}}class Gs{constructor(e,t){m(this,"mods");m(this,"totalPerformance");this.mods=e,this.totalPerformance=t}}class Hs{constructor(e,t){m(this,"time");m(this,"attributes");this.time=e,this.attributes=t}compareTo(e){return this.time<e.time?-1:this.time>e.time?1:this.time===e.time?0:Number.isFinite(this.time)?1:Number.isFinite(e.time)?-1:0}}class Vs{constructor(e,t){m(this,"_beatmap");m(this,"_ruleset");m(this,"_mods");this._beatmap=e,this._ruleset=t,this._mods=(e==null?void 0:e.mods)??this._ruleset.createModCombination()}calculate(e){return this.calculateWithMods(this._mods,e)}*calculateAll(e){for(const t of this._createDifficultyModCombinations())yield this.calculateWithMods(t,e)}calculateWithMods(e,t){const i=this._getWorkingBeatmap(e);t??(t=i.difficulty.clockRate);const a=this._createSkills(i,e,t);if(!i.hitObjects.length)return this._createDifficultyAttributes(i,e,a,t);for(const s of this._getDifficultyHitObjects(i,t))for(const o of a)o.process(s);return this._createDifficultyAttributes(i,e,a,t)}calculateAt(e,t){return this.calculateWithModsAt(this._mods,e,t)}calculateWithModsAt(e,t,i){if(!t)return this.calculateWithMods(e);const a=this._getWorkingBeatmap(e);i??(i=a.difficulty.clockRate);const s=this._createSkills(a,e,i);if(!a.hitObjects.length||t<=0)return this._createDifficultyAttributes(a,e,s,i);const o=new Zn(a);o.hitObjects=a.hitObjects.slice(0,t);for(const l of this._getDifficultyHitObjects(o,i))for(const c of s)c.process(l);return this._createDifficultyAttributes(o,e,s,i)}calculateTimed(e){return this.calculateTimedWithMods(this._mods,e)}*calculateTimedWithMods(e,t){const i=this._getWorkingBeatmap(e);if(!i.hitObjects.length)return;t??(t=i.difficulty.clockRate);const a=this._createSkills(i,e,t),s=new Zn(i);for(const o of this._getDifficultyHitObjects(i,t)){s.hitObjects.push(o.baseObject);for(const p of a)p.process(o);const l=o.endTime*t,c=this._createDifficultyAttributes(s,e,a,t);yield new Hs(l,c)}}_getWorkingBeatmap(e){var o;const t=this._beatmap,i=this._beatmap.mode===this._ruleset.id,a=((o=t.mods)==null?void 0:o.equals(e))??!1;if(i&&a)return t;const s=this._beatmap.base??this._beatmap;return this._ruleset.applyToBeatmapWithMods(s,e)}_getDifficultyHitObjects(e,t){return this._sortObjects(this._createDifficultyHitObjects(e,t))}_sortObjects(e){return e.sort((t,i)=>t.startTime-i.startTime)}_createDifficultyModCombinations(){const e=this._ruleset;function*t(i,a){const s=a.reduce((o,l)=>o+l.bitwise,0);yield e.createModCombination(s);for(let o=0;o<i.length;++o){const l=i[o];if(a.find(h=>h.incompatibles&l.bitwise)||a.find(h=>h.bitwise&l.bitwise))continue;const c=i.slice(o+1),p=[...a,l],g=t(c,p);for(const h of g)yield h}}return t(this.difficultyMods,[])}get difficultyMods(){return[]}}class Ws{constructor(e,t,i){m(this,"attributes");m(this,"_ruleset");m(this,"_score");this._ruleset=e,this._score=i,this.attributes=t}calculate(e,t){return this.calculateAttributes(e,t).totalPerformance}}class Ys{constructor(e,t,i,a,s){m(this,"index");m(this,"baseObject");m(this,"lastObject");m(this,"deltaTime");m(this,"startTime");m(this,"endTime");m(this,"_difficultyHitObjects");this._difficultyHitObjects=a,this.index=s,this.baseObject=e,this.lastObject=t,this.deltaTime=(e.startTime-t.startTime)/i,this.startTime=e.startTime/i;const o=e;this.endTime=((o==null?void 0:o.endTime)??e.startTime)/i}previous(e){const t=this.index-(e+1);return this._difficultyHitObjects[t]??null}next(e){const t=this.index+(e+1);return this._difficultyHitObjects[t]??null}}class Xs{constructor(e){m(this,"_mods");this._mods=e}}class Sa extends Xs{constructor(){super(...arguments);m(this,"_decayWeight",.9);m(this,"_sectionLength",400);m(this,"_currentSectionPeak",0);m(this,"_currentSectionEnd",0);m(this,"_strainPeaks",[])}process(t){for(t.index===0&&(this._currentSectionEnd=Math.ceil(t.startTime/this._sectionLength),this._currentSectionEnd*=this._sectionLength);t.startTime>this._currentSectionEnd;)this._saveCurrentPeak(),this._startNewSectionFrom(this._currentSectionEnd,t),this._currentSectionEnd+=this._sectionLength;this._currentSectionPeak=Math.max(this._strainValueAt(t),this._currentSectionPeak)}_saveCurrentPeak(){this._strainPeaks.push(this._currentSectionPeak)}_startNewSectionFrom(t,i){this._currentSectionPeak=this._calculateInitialStrain(t,i)}*getCurrentStrainPeaks(){for(const t of this._strainPeaks)yield t;yield this._currentSectionPeak}get difficultyValue(){let t=0,i=1;const a=[...this.getCurrentStrainPeaks()].filter(s=>s>0);a.sort((s,o)=>o-s);for(const s of a)t+=s*i,i*=this._decayWeight;return t}}let de;(function(n){n[n.None=0]="None",n[n.NoFail=1]="NoFail",n[n.Easy=2]="Easy",n[n.TouchDevice=4]="TouchDevice",n[n.Hidden=8]="Hidden",n[n.HardRock=16]="HardRock",n[n.SuddenDeath=32]="SuddenDeath",n[n.DoubleTime=64]="DoubleTime",n[n.Relax=128]="Relax",n[n.HalfTime=256]="HalfTime",n[n.Nightcore=512]="Nightcore",n[n.Flashlight=1024]="Flashlight",n[n.Autoplay=2048]="Autoplay",n[n.SpunOut=4096]="SpunOut",n[n.Relax2=8192]="Relax2",n[n.Perfect=16384]="Perfect",n[n.Key4=32768]="Key4",n[n.Key5=65536]="Key5",n[n.Key6=131072]="Key6",n[n.Key7=262144]="Key7",n[n.Key8=524288]="Key8",n[n.FadeIn=1048576]="FadeIn",n[n.Random=2097152]="Random",n[n.Cinema=4194304]="Cinema",n[n.Target=8388608]="Target",n[n.Key9=16777216]="Key9",n[n.KeyCoop=33554432]="KeyCoop",n[n.Key1=67108864]="Key1",n[n.Key3=134217728]="Key3",n[n.Key2=268435456]="Key2",n[n.ScoreV2=536870912]="ScoreV2",n[n.Mirror=1073741824]="Mirror",n[n.KeyMod=487555072]="KeyMod",n[n.DifficultyDecrease=258]="DifficultyDecrease",n[n.DifficultyIncrease=1616]="DifficultyIncrease"})(de||(de={}));let pt;(function(n){n[n.DifficultyReduction=0]="DifficultyReduction",n[n.DifficultyIncrease=1]="DifficultyIncrease",n[n.Conversion=2]="Conversion",n[n.Automation=3]="Automation",n[n.Fun=4]="Fun",n[n.System=5]="System"})(pt||(pt={}));class Zs{constructor(){m(this,"name","Autoplay");m(this,"acronym","AT");m(this,"bitwise",de.Autoplay);m(this,"type",pt.Automation);m(this,"multiplier",1);m(this,"isRanked",!1);m(this,"incompatibles",de.NoFail|de.SuddenDeath|de.Perfect|de.Relax|de.Relax2|de.SpunOut|de.Cinema)}}class Ks{constructor(){m(this,"name","Cinema");m(this,"acronym","CN");m(this,"bitwise",de.Cinema);m(this,"type",pt.Fun);m(this,"multiplier",1);m(this,"isRanked",!1);m(this,"incompatibles",de.NoFail|de.SuddenDeath|de.Perfect|de.Relax|de.Relax2|de.SpunOut|de.Autoplay)}}class ya{constructor(){m(this,"name","Double Time");m(this,"acronym","DT");m(this,"bitwise",de.DoubleTime);m(this,"type",pt.DifficultyIncrease);m(this,"multiplier",1.12);m(this,"isRanked",!0);m(this,"incompatibles",de.HalfTime|de.Nightcore)}applyToDifficulty(e){e.clockRate=1.5}}class qs{constructor(){m(this,"name","Easy");m(this,"acronym","EZ");m(this,"bitwise",de.Easy);m(this,"type",pt.DifficultyReduction);m(this,"multiplier",.5);m(this,"isRanked",!0);m(this,"incompatibles",de.HardRock)}applyToDifficulty(e){e.circleSize=Math.fround(e.circleSize*.5),e.approachRate=Math.fround(e.approachRate*.5),e.drainRate=Math.fround(e.drainRate*.5),e.overallDifficulty=Math.fround(e.overallDifficulty*.5)}}let Qs=class{constructor(){m(this,"name","Flashlight");m(this,"acronym","FL");m(this,"bitwise",de.Flashlight);m(this,"type",pt.DifficultyIncrease);m(this,"multiplier",1.12);m(this,"isRanked",!0);m(this,"incompatibles",de.None)}};class Js{constructor(){m(this,"name","Half Time");m(this,"acronym","HT");m(this,"bitwise",de.HalfTime);m(this,"type",pt.DifficultyReduction);m(this,"multiplier",.3);m(this,"isRanked",!0);m(this,"incompatibles",de.DoubleTime|de.Nightcore)}applyToDifficulty(e){e.clockRate=.75}}class Cs{constructor(){m(this,"name","Hard Rock");m(this,"acronym","HR");m(this,"bitwise",de.HardRock);m(this,"type",pt.DifficultyIncrease);m(this,"multiplier",1.06);m(this,"isRanked",!0);m(this,"incompatibles",de.Easy)}applyToDifficulty(e){const t=Math.fround(1.4),i=Math.fround(e.circleSize*Math.fround(1.3)),a=Math.fround(e.approachRate*t),s=Math.fround(e.drainRate*t),o=Math.fround(e.overallDifficulty*t);e.circleSize=Math.min(i,10),e.approachRate=Math.min(a,10),e.drainRate=Math.min(s,10),e.overallDifficulty=Math.min(o,10)}}class $s{constructor(){m(this,"name","Hidden");m(this,"acronym","HD");m(this,"bitwise",de.Hidden);m(this,"type",pt.DifficultyIncrease);m(this,"multiplier",1.06);m(this,"isRanked",!0);m(this,"incompatibles",de.None)}}class eo extends ya{constructor(){super(...arguments);m(this,"name","Nightcore");m(this,"acronym","NC");m(this,"bitwise",de.Nightcore);m(this,"incompatibles",de.HalfTime|de.DoubleTime)}}class to{constructor(){m(this,"name","No Fail");m(this,"acronym","NF");m(this,"bitwise",de.NoFail);m(this,"type",pt.DifficultyReduction);m(this,"multiplier",.5);m(this,"isRanked",!0);m(this,"incompatibles",de.SuddenDeath|de.Perfect|de.Autoplay|de.Cinema|de.Relax|de.Relax2)}}class ro{constructor(){m(this,"name","No Mod");m(this,"acronym","NM");m(this,"bitwise",de.None);m(this,"type",pt.System);m(this,"multiplier",1);m(this,"isRanked",!0);m(this,"incompatibles",de.None)}}class no{constructor(){m(this,"name","Perfect");m(this,"acronym","PF");m(this,"bitwise",de.Perfect);m(this,"type",pt.DifficultyIncrease);m(this,"multiplier",1);m(this,"isRanked",!0);m(this,"incompatibles",de.NoFail|de.SuddenDeath|de.Autoplay|de.Cinema|de.Relax|de.Relax2)}}class io{constructor(){m(this,"name","Relax");m(this,"acronym","RX");m(this,"bitwise",de.Relax);m(this,"type",pt.Automation);m(this,"multiplier",1);m(this,"isRanked",!1);m(this,"incompatibles",de.NoFail|de.SuddenDeath|de.Perfect|de.Autoplay|de.Cinema|de.Relax2)}}class ao{constructor(){m(this,"name","Sudden Death");m(this,"acronym","SD");m(this,"bitwise",de.SuddenDeath);m(this,"type",pt.DifficultyIncrease);m(this,"multiplier",1);m(this,"isRanked",!0);m(this,"incompatibles",de.NoFail|de.Perfect|de.Autoplay|de.Cinema|de.Relax|de.Relax2)}}class so{constructor(e){m(this,"_mods",[]);const t=this._availableMods;if(typeof e=="number"||typeof e=="string"){let i=this.toBitwise(e),a=1<<30;for(;a>0;){const s=t.find(o=>o.bitwise&i&a);s&&!(this.bitwise&s.incompatibles)&&this._mods.push(s),i&=~a,a>>=1}}if(!this._mods.length){const i=t.find(a=>a.bitwise===0);i&&this._mods.push(i)}this._mods.sort((i,a)=>i.bitwise-a.bitwise)}get all(){return this._mods}get beatmapMods(){return this.all.filter(t=>t.applyToBeatmap)}get hitObjectMods(){return this.all.filter(t=>t.applyToHitObjects)}get difficultyMods(){return this.all.filter(t=>t.applyToDifficulty)}get converterMods(){return this.all.filter(t=>t.applyToConverter)}get names(){return this.all.map(e=>e.name)}get acronyms(){return this.all.map(e=>e.acronym)}get bitwise(){return this.all.reduce((e,t)=>(e|=t.bitwise,t.bitwise===de.Nightcore&&(e|=de.DoubleTime),t.bitwise===de.Perfect&&(e|=de.SuddenDeath),e),0)}get multiplier(){return this.all.reduce((e,t)=>e*t.multiplier,1)}get isRanked(){return this.all.reduce((e,t)=>e&&t.isRanked,!0)}get incompatibles(){return this.all.reduce((e,t)=>e|t.incompatibles,0)}has(e){const t=this.toBitwise(e);return(this.bitwise&t)===t||this.bitwise===t}any(e){return this._mods.some(t=>t instanceof e)}beatmapModsAt(e){const t=this.toBitwise(e);return this.all.filter(a=>a.bitwise&t&&a.applyToBeatmap)}beatmapModAt(e){const t=this.toBitwise(e);return this.beatmapModsAt(t)[0]||null}hitObjectModsAt(e){const t=this.toBitwise(e);return this.all.filter(a=>a.bitwise&t&&a.applyToHitObjects)}hitObjectModAt(e){const t=this.toBitwise(e);return this.hitObjectModsAt(t)[0]||null}difficultyModsAt(e){const t=this.toBitwise(e);return this.all.filter(a=>a.bitwise&t&&a.applyToDifficulty)}difficultyModAt(e){const t=this.toBitwise(e);return this.difficultyModsAt(t)[0]||null}converterModsAt(e){const t=this.toBitwise(e);return this.all.filter(a=>a.bitwise&t&&a.applyToConverter)}converterModAt(e){const t=this.toBitwise(e);return this.converterModsAt(t)[0]||null}modsAt(e){const t=this.toBitwise(e);return this.all.filter(i=>i.bitwise&t)}modAt(e){const t=this.toBitwise(e);return this.modsAt(t)[0]||null}toString(){return this.acronyms.join("")}toJSON(){return this.toString()}toBitwise(e){var i;return typeof e=="number"?Math.max(0,e):typeof e!="string"||!e||e.length%2?0:(((i=e.match(/.{1,2}/g))==null?void 0:i.map(a=>a.toUpperCase()))??[]).reduce((a,s)=>{const o=this._availableMods.find(l=>l.acronym===s);return a|((o==null?void 0:o.bitwise)??0)},0)}clone(){const e=this.constructor;return new e(this.bitwise)}equals(e){return this.bitwise===e.bitwise&&this.mode===e.mode}get _availableMods(){return[]}}let jt;(function(n){n[n.None=0]="None",n[n.Left1=1]="Left1",n[n.Right1=2]="Right1",n[n.Left2=4]="Left2",n[n.Right2=8]="Right2",n[n.Smoke=16]="Smoke"})(jt||(jt={}));class Pa{constructor(e,t){m(this,"startTime");m(this,"interval");this.startTime=e??0,this.interval=t??0}clone(){const e=this.constructor,t=new e;return t.startTime=this.startTime,t.interval=this.interval,t}}class ka extends Pa{constructor(t,i,a,s){super(t,i);m(this,"buttonState");m(this,"position");this.position=a??new Le(0,0),this.buttonState=s??jt.None}get mouseX(){return this.position.x}get mouseY(){return this.position.y}get mousePosition(){return new Le(this.mouseX??0,this.mouseY??0)}get mouseLeft(){return this.mouseLeft1||this.mouseLeft2}get mouseRight(){return this.mouseRight1||this.mouseRight2}get mouseLeft1(){return(this.buttonState&jt.Left1)>0}get mouseRight1(){return(this.buttonState&jt.Right1)>0}get mouseLeft2(){return(this.buttonState&jt.Left2)>0}get mouseRight2(){return(this.buttonState&jt.Right2)>0}get smoke(){return(this.buttonState&jt.Smoke)>0}clone(){const t=super.clone();return t.buttonState=this.buttonState,t.position=this.position.clone(),t}}class oo{constructor(){m(this,"gameVersion",0);m(this,"mode",0);m(this,"hashMD5","");m(this,"frames",[]);m(this,"lifeBar",[])}get length(){var i;if(!((i=this.frames)!=null&&i.length))return 0;const e=this.frames[0].startTime;return this.frames[this.frames.length-1].startTime-e}clone(){const e=this.constructor,t=new e;return t.gameVersion=this.gameVersion,t.mode=this.mode,t.hashMD5=this.hashMD5,t.frames=this.frames.map(i=>i.clone()),t}equals(e){return this.hashMD5===e.hashMD5}}class lo{convertReplay(e,t){const i=this.createReplay();i.gameVersion=e.gameVersion,i.mode=e.mode,i.hashMD5=e.hashMD5,i.lifeBar=e.lifeBar;for(const a of this.convertFrames(e.frames,t))i.frames.push(a);return i}createReplay(){return new oo}*convertFrames(e,t){let i=null;for(const a of e){const s=this._convertFrame(a,i,t);yield s,i=s}}_convertFrame(e,t,i){if(this._isConvertedReplayFrame(e))return e;const a=this._createConvertibleReplayFrame();if(a&&e instanceof ka)return a.fromLegacy(e,t,i);throw new Error("Replay can not be converted to this ruleset!")}}class co{applyToBeatmap(e){const t=e.mods,i=t?t.bitwise:0,a=this.createModCombination(i);return this.applyToBeatmapWithMods(e,a)}applyToBeatmapWithMods(e,t){t||(t=this.createModCombination(0)),this.id!==t.mode&&(t=this.createModCombination(t.bitwise));const i=this._createBeatmapConverter();if(e.hitObjects.length>0&&!i.canConvert(e))throw new Error("Beatmap can not be converted to this ruleset!");t.converterMods.forEach(o=>o.applyToConverter(i));const a=i.convertBeatmap(e);a.mods=t,t.difficultyMods.forEach(o=>{o.applyToDifficulty(a.difficulty)});const s=this._createBeatmapProcessor();return s.preProcess(a),a.hitObjects.forEach(o=>{o.applyDefaults(a.controlPoints,a.difficulty)}),t.hitObjectMods.forEach(o=>{o.applyToHitObjects(a.hitObjects)}),s.postProcess(a),t.beatmapMods.forEach(o=>o.applyToBeatmap(a)),a}applyToReplay(e,t){if(t&&e.mode!==t.mode)throw new Error("Replay and beatmap mode does not match!");return this._createReplayConverter().convertReplay(e,t)}resetMods(e){const t=this.createModCombination(0);return this.applyToBeatmapWithMods(e,t)}}let $i;(function(n){n[n.F=-1]="F",n[n.D=0]="D",n[n.C=1]="C",n[n.B=2]="B",n[n.A=3]="A",n[n.S=4]="S",n[n.SH=5]="SH",n[n.X=6]="X",n[n.XH=7]="XH"})($i||($i={}));let ea;(function(n){n[n.Unknown=0]="Unknown",n[n.BD=1]="BD",n[n.BE=2]="BE",n[n.BF=3]="BF",n[n.BG=4]="BG",n[n.BA=5]="BA",n[n.BB=6]="BB",n[n.WF=7]="WF",n[n.BL=8]="BL",n[n.BM=9]="BM",n[n.BN=10]="BN",n[n.BO=11]="BO",n[n.BH=12]="BH",n[n.BI=13]="BI",n[n.BJ=14]="BJ",n[n.BT=15]="BT",n[n.JM=16]="JM",n[n.BV=17]="BV",n[n.BW=18]="BW",n[n.WS=19]="WS",n[n.BQ=20]="BQ",n[n.BR=21]="BR",n[n.BS=22]="BS",n[n.JE=23]="JE",n[n.BY=24]="BY",n[n.BZ=25]="BZ",n[n.RU=26]="RU",n[n.RW=27]="RW",n[n.RS=28]="RS",n[n.TL=29]="TL",n[n.RE=30]="RE",n[n.TM=31]="TM",n[n.TJ=32]="TJ",n[n.RO=33]="RO",n[n.TK=34]="TK",n[n.GW=35]="GW",n[n.GU=36]="GU",n[n.GT=37]="GT",n[n.GS=38]="GS",n[n.GR=39]="GR",n[n.GQ=40]="GQ",n[n.GP=41]="GP",n[n.JP=42]="JP",n[n.GY=43]="GY",n[n.GG=44]="GG",n[n.GF=45]="GF",n[n.GE=46]="GE",n[n.GD=47]="GD",n[n.GB=48]="GB",n[n.GA=49]="GA",n[n.SV=50]="SV",n[n.GN=51]="GN",n[n.GM=52]="GM",n[n.GL=53]="GL",n[n.GI=54]="GI",n[n.GH=55]="GH",n[n.OM=56]="OM",n[n.TN=57]="TN",n[n.JO=58]="JO",n[n.HR=59]="HR",n[n.HT=60]="HT",n[n.HU=61]="HU",n[n.HK=62]="HK",n[n.HN=63]="HN",n[n.HM=64]="HM",n[n.VE=65]="VE",n[n.PR=66]="PR",n[n.PS=67]="PS",n[n.PW=68]="PW",n[n.PT=69]="PT",n[n.SJ=70]="SJ",n[n.PY=71]="PY",n[n.IQ=72]="IQ",n[n.PA=73]="PA",n[n.PF=74]="PF",n[n.PG=75]="PG",n[n.PE=76]="PE",n[n.PK=77]="PK",n[n.PH=78]="PH",n[n.PN=79]="PN",n[n.PL=80]="PL",n[n.PM=81]="PM",n[n.ZM=82]="ZM",n[n.EH=83]="EH",n[n.EE=84]="EE",n[n.EG=85]="EG",n[n.ZA=86]="ZA",n[n.EC=87]="EC",n[n.IT=88]="IT",n[n.VN=89]="VN",n[n.SB=90]="SB",n[n.ET=91]="ET",n[n.SO=92]="SO",n[n.ZW=93]="ZW",n[n.SA=94]="SA",n[n.ES=95]="ES",n[n.ER=96]="ER",n[n.ME=97]="ME",n[n.MD=98]="MD",n[n.MG=99]="MG",n[n.MF=100]="MF",n[n.MA=101]="MA",n[n.MC=102]="MC",n[n.UZ=103]="UZ",n[n.MM=104]="MM",n[n.ML=105]="ML",n[n.MO=106]="MO",n[n.MN=107]="MN",n[n.MH=108]="MH",n[n.MK=109]="MK",n[n.MU=110]="MU",n[n.MT=111]="MT",n[n.MW=112]="MW",n[n.MV=113]="MV",n[n.MQ=114]="MQ",n[n.MP=115]="MP",n[n.MS=116]="MS",n[n.MR=117]="MR",n[n.IM=118]="IM",n[n.UG=119]="UG",n[n.TZ=120]="TZ",n[n.MY=121]="MY",n[n.MX=122]="MX",n[n.IL=123]="IL",n[n.FR=124]="FR",n[n.IO=125]="IO",n[n.SH=126]="SH",n[n.FI=127]="FI",n[n.FJ=128]="FJ",n[n.FK=129]="FK",n[n.FM=130]="FM",n[n.FO=131]="FO",n[n.NI=132]="NI",n[n.NL=133]="NL",n[n.NO=134]="NO",n[n.NA=135]="NA",n[n.VU=136]="VU",n[n.NC=137]="NC",n[n.NE=138]="NE",n[n.NF=139]="NF",n[n.NG=140]="NG",n[n.NZ=141]="NZ",n[n.NP=142]="NP",n[n.NR=143]="NR",n[n.NU=144]="NU",n[n.CK=145]="CK",n[n.XK=146]="XK",n[n.CI=147]="CI",n[n.CH=148]="CH",n[n.CO=149]="CO",n[n.CN=150]="CN",n[n.CM=151]="CM",n[n.CL=152]="CL",n[n.CC=153]="CC",n[n.CA=154]="CA",n[n.CG=155]="CG",n[n.CF=156]="CF",n[n.CD=157]="CD",n[n.CZ=158]="CZ",n[n.CY=159]="CY",n[n.CX=160]="CX",n[n.CR=161]="CR",n[n.CW=162]="CW",n[n.CV=163]="CV",n[n.CU=164]="CU",n[n.SZ=165]="SZ",n[n.SY=166]="SY",n[n.SX=167]="SX",n[n.KG=168]="KG",n[n.KE=169]="KE",n[n.SS=170]="SS",n[n.SR=171]="SR",n[n.KI=172]="KI",n[n.KH=173]="KH",n[n.KN=174]="KN",n[n.KM=175]="KM",n[n.ST=176]="ST",n[n.SK=177]="SK",n[n.KR=178]="KR",n[n.SI=179]="SI",n[n.KP=180]="KP",n[n.KW=181]="KW",n[n.SN=182]="SN",n[n.SM=183]="SM",n[n.SL=184]="SL",n[n.SC=185]="SC",n[n.KZ=186]="KZ",n[n.KY=187]="KY",n[n.SG=188]="SG",n[n.SE=189]="SE",n[n.SD=190]="SD",n[n.DO=191]="DO",n[n.DM=192]="DM",n[n.DJ=193]="DJ",n[n.DK=194]="DK",n[n.VG=195]="VG",n[n.DE=196]="DE",n[n.YE=197]="YE",n[n.DZ=198]="DZ",n[n.US=199]="US",n[n.UY=200]="UY",n[n.YT=201]="YT",n[n.UM=202]="UM",n[n.LB=203]="LB",n[n.LC=204]="LC",n[n.LA=205]="LA",n[n.TV=206]="TV",n[n.TW=207]="TW",n[n.TT=208]="TT",n[n.TR=209]="TR",n[n.LK=210]="LK",n[n.LI=211]="LI",n[n.LV=212]="LV",n[n.TO=213]="TO",n[n.LT=214]="LT",n[n.LU=215]="LU",n[n.LR=216]="LR",n[n.LS=217]="LS",n[n.TH=218]="TH",n[n.TF=219]="TF",n[n.TG=220]="TG",n[n.TD=221]="TD",n[n.TC=222]="TC",n[n.LY=223]="LY",n[n.VA=224]="VA",n[n.VC=225]="VC",n[n.AE=226]="AE",n[n.AD=227]="AD",n[n.AG=228]="AG",n[n.AF=229]="AF",n[n.AI=230]="AI",n[n.VI=231]="VI",n[n.IS=232]="IS",n[n.IR=233]="IR",n[n.AM=234]="AM",n[n.AL=235]="AL",n[n.AO=236]="AO",n[n.AQ=237]="AQ",n[n.AS=238]="AS",n[n.AR=239]="AR",n[n.AU=240]="AU",n[n.AT=241]="AT",n[n.AW=242]="AW",n[n.IN=243]="IN",n[n.AX=244]="AX",n[n.AZ=245]="AZ",n[n.IE=246]="IE",n[n.ID=247]="ID",n[n.UA=248]="UA",n[n.QA=249]="QA",n[n.MZ=250]="MZ"})(ea||(ea={}));var uo=function(){var n=1,e=2,t=3,i=typeof setImmediate=="function"?setImmediate:setTimeout,a=4294967296,s=[4294967295,-a],o=[0,-9223372036854776e3],l=[0,0],c=[1,0];function p(r,u){postMessage({action:t,cbn:u,result:r})}function g(r){var u=[];return u[r-1]=void 0,u}function h(r,u){return S(r[0]+u[0],r[1]+u[1])}function w(r,u){return M(~~Math.max(Math.min(r[1]/a,2147483647),-2147483648)&~~Math.max(Math.min(u[1]/a,2147483647),-2147483648),b(r)&b(u))}function d(r,u){var k,I;return r[0]==u[0]&&r[1]==u[1]?0:(k=r[1]<0,I=u[1]<0,k&&!I?-1:!k&&I?1:H(r,u)[1]<0?-1:1)}function S(r,u){var k,I;for(u%=18446744073709552e3,r%=18446744073709552e3,k=u%a,I=Math.floor(r/a)*a,u=u-k+I,r=r-I+k;r<0;)r+=a,u-=a;for(;r>4294967295;)r-=a,u+=a;for(u=u%18446744073709552e3;u>9223372032559809e3;)u-=18446744073709552e3;for(;u<-9223372036854776e3;)u+=18446744073709552e3;return[r,u]}function v(r,u){return r[0]==u[0]&&r[1]==u[1]}function y(r){return r>=0?[r,0]:[r+a,-a]}function b(r){return r[0]>=2147483648?~~Math.max(Math.min(r[0]-a,2147483647),-2147483648):~~Math.max(Math.min(r[0],2147483647),-2147483648)}function M(r,u){var k,I;return k=r*a,I=u,u<0&&(I+=a),[I,k]}function L(r){return r<=30?1<<r:L(30)*L(r-30)}function z(r,u){var k,I,A,O;if(u&=63,v(r,o))return u?l:r;if(r[1]<0)throw new Error("Neg");return O=L(u),I=r[1]*O%18446744073709552e3,A=r[0]*O,k=A-A%a,I+=k,A-=k,I>=9223372036854776e3&&(I-=18446744073709552e3),[A,I]}function x(r,u){var k;return u&=63,k=L(u),S(Math.floor(r[0]/k),r[1]/k)}function W(r,u){var k;return u&=63,k=x(r,u),r[1]<0&&(k=h(k,z([2,0],63-u))),k}function H(r,u){return S(r[0]-u[0],r[1]-u[1])}function K(r,u){return r.buf=u,r.pos=0,r.count=u.length,r}function G(r){return r.pos>=r.count?-1:r.buf[r.pos++]&255}function ee(r,u,k,I){return r.pos>=r.count?-1:(I=Math.min(I,r.count-r.pos),Me(r.buf,r.pos,u,k,I),r.pos+=I,I)}function _e(r){return r.buf=g(32),r.count=0,r}function B(r){var u=r.buf;return u.length=r.count,u}function q(r,u){r.buf[r.count++]=u<<24>>24}function _(r,u,k,I){Me(u,k,r.buf,r.count,I),r.count+=I}function $(r,u,k,I,A){var O;for(O=u;O<k;++O)I[A++]=r.charCodeAt(O)}function Me(r,u,k,I,A){for(var O=0;O<A;++O)k[I+O]=r[u+O]}function ie(r,u){mi(u,1<<r.s),u._numFastBytes=r.f,pi(u,r.m),u._numLiteralPosStateBits=0,u._numLiteralContextBits=3,u._posStateBits=2,u._posStateMask=3}function xe(r,u,k,I,A){var O,J;if(d(I,s)<0)throw new Error("invalid length "+I);for(r.length_0=I,O=ci({}),ie(A,O),O._writeEndMark=typeof uo.disableEndMark>"u",_i(O,k),J=0;J<64;J+=8)q(k,b(x(I,J))&255);r.chunker=(O._needReleaseMFStream=0,O._inStream=u,O._finished=0,li(O),O._rangeEncoder.Stream=k,hi(O),In(O),fn(O),O._lenEncoder._tableSize=O._numFastBytes+1-2,Wr(O._lenEncoder,1<<O._posStateBits),O._repMatchLenEncoder._tableSize=O._numFastBytes+1-2,Wr(O._repMatchLenEncoder,1<<O._posStateBits),O.nowPos64=l,we({},O))}function le(r,u,k){return r.output=_e({}),xe(r,K({},u),r.output,y(u.length),k),r}function Te(r,u,k){var I,A="",O,J=[],ge,ye;for(O=0;O<5;++O){if(ge=G(u),ge==-1)throw new Error("truncated input");J[O]=ge<<24>>24}if(I=Je({}),!Pr(I,J))throw new Error("corrupted input");for(O=0;O<64;O+=8){if(ge=G(u),ge==-1)throw new Error("truncated input");ge=ge.toString(16),ge.length==1&&(ge="0"+ge),A=ge+""+A}/^0+$|^f+$/i.test(A)?r.length_0=s:(ye=parseInt(A,16),ye>4294967295?r.length_0=s:r.length_0=y(ye)),r.chunker=Mt(I,u,k,r.length_0)}function Y(r,u){return r.output=_e({}),Te(r,K({},u),r.output),r}function X(r,u,k,I){var A;r._keepSizeBefore=u,r._keepSizeAfter=k,A=u+k+I,(r._bufferBase==null||r._blockSize!=A)&&(r._bufferBase=null,r._blockSize=A,r._bufferBase=g(r._blockSize)),r._pointerToLastSafePosition=r._blockSize-k}function ve(r,u){return r._bufferBase[r._bufferOffset+r._pos+u]}function me(r,u,k,I){var A,O;for(r._streamEndWasReached&&r._pos+u+I>r._streamPos&&(I=r._streamPos-(r._pos+u)),++k,O=r._bufferOffset+r._pos+u,A=0;A<I&&r._bufferBase[O+A]==r._bufferBase[O+A-k];++A);return A}function fe(r){return r._streamPos-r._pos}function Ce(r){var u,k,I;for(I=r._bufferOffset+r._pos-r._keepSizeBefore,I>0&&--I,k=r._bufferOffset+r._streamPos-I,u=0;u<k;++u)r._bufferBase[u]=r._bufferBase[I+u];r._bufferOffset-=I}function lt(r){var u;++r._pos,r._pos>r._posLimit&&(u=r._bufferOffset+r._pos,u>r._pointerToLastSafePosition&&Ce(r),Be(r))}function Be(r){var u,k,I;if(!r._streamEndWasReached)for(;;){if(I=-r._bufferOffset+r._blockSize-r._streamPos,!I)return;if(u=ee(r._stream,r._bufferBase,r._bufferOffset+r._streamPos,I),u==-1){r._posLimit=r._streamPos,k=r._bufferOffset+r._posLimit,k>r._pointerToLastSafePosition&&(r._posLimit=r._pointerToLastSafePosition-r._bufferOffset),r._streamEndWasReached=1;return}r._streamPos+=u,r._streamPos>=r._pos+r._keepSizeAfter&&(r._posLimit=r._streamPos-r._keepSizeAfter)}}function Ne(r,u){r._bufferOffset+=u,r._posLimit-=u,r._pos-=u,r._streamPos-=u}var $e=function(){var r,u,k,I=[];for(r=0;r<256;++r){for(k=r,u=0;u<8;++u)k&1?k=k>>>1^-306674912:k>>>=1;I[r]=k}return I}();function et(r,u,k,I,A){var O,J,ge;u<1073741567&&(r._cutValue=16+(I>>1),ge=~~((u+k+I+A)/2)+256,X(r,u+k,I+A,ge),r._matchMaxLen=I,O=u+1,r._cyclicBufferSize!=O&&(r._son=g((r._cyclicBufferSize=O)*2)),J=65536,r.HASH_ARRAY&&(J=u-1,J|=J>>1,J|=J>>2,J|=J>>4,J|=J>>8,J>>=1,J|=65535,J>16777216&&(J>>=1),r._hashMask=J,++J,J+=r.kFixHashSize),J!=r._hashSizeSum&&(r._hash=g(r._hashSizeSum=J)))}function Tt(r,u){var k,I,A,O,J,ge,ye,Se,Pe,Ke,Re,Fe,dt,ke,Ve,ut,We,Ht,vt,Vt,Jt;if(r._pos+r._matchMaxLen<=r._streamPos)ke=r._matchMaxLen;else if(ke=r._streamPos-r._pos,ke<r.kMinMatchCheck)return f(r),0;for(We=0,Ve=r._pos>r._cyclicBufferSize?r._pos-r._cyclicBufferSize:0,I=r._bufferOffset+r._pos,ut=1,Se=0,Pe=0,r.HASH_ARRAY?(Jt=$e[r._bufferBase[I]&255]^r._bufferBase[I+1]&255,Se=Jt&1023,Jt^=(r._bufferBase[I+2]&255)<<8,Pe=Jt&65535,Ke=(Jt^$e[r._bufferBase[I+3]&255]<<5)&r._hashMask):Ke=r._bufferBase[I]&255^(r._bufferBase[I+1]&255)<<8,A=r._hash[r.kFixHashSize+Ke]||0,r.HASH_ARRAY&&(O=r._hash[Se]||0,J=r._hash[1024+Pe]||0,r._hash[Se]=r._pos,r._hash[1024+Pe]=r._pos,O>Ve&&r._bufferBase[r._bufferOffset+O]==r._bufferBase[I]&&(u[We++]=ut=2,u[We++]=r._pos-O-1),J>Ve&&r._bufferBase[r._bufferOffset+J]==r._bufferBase[I]&&(J==O&&(We-=2),u[We++]=ut=3,u[We++]=r._pos-J-1,O=J),We!=0&&O==A&&(We-=2,ut=1)),r._hash[r.kFixHashSize+Ke]=r._pos,vt=(r._cyclicBufferPos<<1)+1,Vt=r._cyclicBufferPos<<1,Fe=dt=r.kNumHashDirectBytes,r.kNumHashDirectBytes!=0&&A>Ve&&r._bufferBase[r._bufferOffset+A+r.kNumHashDirectBytes]!=r._bufferBase[I+r.kNumHashDirectBytes]&&(u[We++]=ut=r.kNumHashDirectBytes,u[We++]=r._pos-A-1),k=r._cutValue;;){if(A<=Ve||k--==0){r._son[vt]=r._son[Vt]=0;break}if(ye=r._pos-A,ge=(ye<=r._cyclicBufferPos?r._cyclicBufferPos-ye:r._cyclicBufferPos-ye+r._cyclicBufferSize)<<1,Ht=r._bufferOffset+A,Re=Fe<dt?Fe:dt,r._bufferBase[Ht+Re]==r._bufferBase[I+Re]){for(;++Re!=ke&&r._bufferBase[Ht+Re]==r._bufferBase[I+Re];);if(ut<Re&&(u[We++]=ut=Re,u[We++]=ye-1,Re==ke)){r._son[Vt]=r._son[ge],r._son[vt]=r._son[ge+1];break}}(r._bufferBase[Ht+Re]&255)<(r._bufferBase[I+Re]&255)?(r._son[Vt]=A,Vt=ge+1,A=r._son[Vt],dt=Re):(r._son[vt]=A,vt=ge,A=r._son[vt],Fe=Re)}return f(r),We}function kt(r){r._bufferOffset=0,r._pos=0,r._streamPos=0,r._streamEndWasReached=0,Be(r),r._cyclicBufferPos=0,Ne(r,-1)}function f(r){var u;++r._cyclicBufferPos>=r._cyclicBufferSize&&(r._cyclicBufferPos=0),lt(r),r._pos==1073741823&&(u=r._pos-r._cyclicBufferSize,Q(r._son,r._cyclicBufferSize*2,u),Q(r._hash,r._hashSizeSum,u),Ne(r,u))}function Q(r,u,k){var I,A;for(I=0;I<u;++I)A=r[I]||0,A<=k?A=0:A-=k,r[I]=A}function Z(r,u){r.HASH_ARRAY=u>2,r.HASH_ARRAY?(r.kNumHashDirectBytes=0,r.kMinMatchCheck=4,r.kFixHashSize=66560):(r.kNumHashDirectBytes=2,r.kMinMatchCheck=3,r.kFixHashSize=0)}function D(r,u){var k,I,A,O,J,ge,ye,Se,Pe,Ke,Re,Fe,dt,ke,Ve,ut,We;do{if(r._pos+r._matchMaxLen<=r._streamPos)Fe=r._matchMaxLen;else if(Fe=r._streamPos-r._pos,Fe<r.kMinMatchCheck){f(r);continue}for(dt=r._pos>r._cyclicBufferSize?r._pos-r._cyclicBufferSize:0,I=r._bufferOffset+r._pos,r.HASH_ARRAY?(We=$e[r._bufferBase[I]&255]^r._bufferBase[I+1]&255,ge=We&1023,r._hash[ge]=r._pos,We^=(r._bufferBase[I+2]&255)<<8,ye=We&65535,r._hash[1024+ye]=r._pos,Se=(We^$e[r._bufferBase[I+3]&255]<<5)&r._hashMask):Se=r._bufferBase[I]&255^(r._bufferBase[I+1]&255)<<8,A=r._hash[r.kFixHashSize+Se],r._hash[r.kFixHashSize+Se]=r._pos,Ve=(r._cyclicBufferPos<<1)+1,ut=r._cyclicBufferPos<<1,Ke=Re=r.kNumHashDirectBytes,k=r._cutValue;;){if(A<=dt||k--==0){r._son[Ve]=r._son[ut]=0;break}if(J=r._pos-A,O=(J<=r._cyclicBufferPos?r._cyclicBufferPos-J:r._cyclicBufferPos-J+r._cyclicBufferSize)<<1,ke=r._bufferOffset+A,Pe=Ke<Re?Ke:Re,r._bufferBase[ke+Pe]==r._bufferBase[I+Pe]){for(;++Pe!=Fe&&r._bufferBase[ke+Pe]==r._bufferBase[I+Pe];);if(Pe==Fe){r._son[ut]=r._son[O],r._son[Ve]=r._son[O+1];break}}(r._bufferBase[ke+Pe]&255)<(r._bufferBase[I+Pe]&255)?(r._son[ut]=A,ut=O+1,A=r._son[ut],Re=Pe):(r._son[Ve]=A,Ve=O,A=r._son[Ve],Ke=Pe)}f(r)}while(--u!=0)}function E(r,u,k){var I=r._pos-u-1;for(I<0&&(I+=r._windowSize);k!=0;--k)I>=r._windowSize&&(I=0),r._buffer[r._pos++]=r._buffer[I++],r._pos>=r._windowSize&&te(r)}function U(r,u){(r._buffer==null||r._windowSize!=u)&&(r._buffer=g(u)),r._windowSize=u,r._pos=0,r._streamPos=0}function te(r){var u=r._pos-r._streamPos;u&&(_(r._stream,r._buffer,r._streamPos,u),r._pos>=r._windowSize&&(r._pos=0),r._streamPos=r._pos)}function re(r,u){var k=r._pos-u-1;return k<0&&(k+=r._windowSize),r._buffer[k]}function V(r,u){r._buffer[r._pos++]=u,r._pos>=r._windowSize&&te(r)}function ce(r){te(r),r._stream=null}function pe(r){return r-=2,r<4?r:3}function se(r){return r<4?0:r<10?r-3:r-6}function we(r,u){return r.encoder=u,r.decoder=null,r.alive=1,r}function Xe(r,u){return r.decoder=u,r.encoder=null,r.alive=1,r}function Ae(r){if(!r.alive)throw new Error("bad state");return r.encoder?Kt(r):_t(r),r.alive}function _t(r){var u=qt(r.decoder);if(u==-1)throw new Error("corrupted input");r.inBytesProcessed=s,r.outBytesProcessed=r.decoder.nowPos64,(u||d(r.decoder.outSize,l)>=0&&d(r.decoder.nowPos64,r.decoder.outSize)>=0)&&(te(r.decoder.m_OutWindow),ce(r.decoder.m_OutWindow),r.decoder.m_RangeDecoder.Stream=null,r.alive=0)}function Kt(r){oi(r.encoder,r.encoder.processedInSize,r.encoder.processedOutSize,r.encoder.finished),r.inBytesProcessed=r.encoder.processedInSize[0],r.encoder.finished[0]&&(di(r.encoder),r.alive=0)}function Mt(r,u,k,I){return r.m_RangeDecoder.Stream=u,ce(r.m_OutWindow),r.m_OutWindow._stream=k,Qt(r),r.state=0,r.rep0=0,r.rep1=0,r.rep2=0,r.rep3=0,r.outSize=I,r.nowPos64=l,r.prevByte=0,Xe({},r)}function qt(r){var u,k,I,A,O,J;if(J=b(r.nowPos64)&r.m_PosStateMask,!ct(r.m_RangeDecoder,r.m_IsMatchDecoders,(r.state<<4)+J))u=ar(r.m_LiteralDecoder,b(r.nowPos64),r.prevByte),r.state<7?r.prevByte=ni(u,r.m_RangeDecoder):r.prevByte=ii(u,r.m_RangeDecoder,re(r.m_OutWindow,r.rep0)),V(r.m_OutWindow,r.prevByte),r.state=se(r.state),r.nowPos64=h(r.nowPos64,c);else{if(ct(r.m_RangeDecoder,r.m_IsRepDecoders,r.state))I=0,ct(r.m_RangeDecoder,r.m_IsRepG0Decoders,r.state)?(ct(r.m_RangeDecoder,r.m_IsRepG1Decoders,r.state)?(ct(r.m_RangeDecoder,r.m_IsRepG2Decoders,r.state)?(k=r.rep3,r.rep3=r.rep2):k=r.rep2,r.rep2=r.rep1):k=r.rep1,r.rep1=r.rep0,r.rep0=k):ct(r.m_RangeDecoder,r.m_IsRep0LongDecoders,(r.state<<4)+J)||(r.state=r.state<7?9:11,I=1),I||(I=Hr(r.m_RepLenDecoder,r.m_RangeDecoder,J)+2,r.state=r.state<7?8:11);else if(r.rep3=r.rep2,r.rep2=r.rep1,r.rep1=r.rep0,I=2+Hr(r.m_LenDecoder,r.m_RangeDecoder,J),r.state=r.state<7?7:10,O=oe(r.m_PosSlotDecoder[pe(I)],r.m_RangeDecoder),O>=4){if(A=(O>>1)-1,r.rep0=(2|O&1)<<A,O<14)r.rep0+=he(r.m_PosDecoders,r.rep0-O-1,r.m_RangeDecoder,A);else if(r.rep0+=mn(r.m_RangeDecoder,A-4)<<4,r.rep0+=ue(r.m_PosAlignDecoder,r.m_RangeDecoder),r.rep0<0)return r.rep0==-1?1:-1}else r.rep0=O;if(d(y(r.rep0),r.nowPos64)>=0||r.rep0>=r.m_DictionarySizeCheck)return-1;E(r.m_OutWindow,r.rep0,I),r.nowPos64=h(r.nowPos64,y(I)),r.prevByte=re(r.m_OutWindow,0)}return 0}function Je(r){r.m_OutWindow={},r.m_RangeDecoder={},r.m_IsMatchDecoders=g(192),r.m_IsRepDecoders=g(12),r.m_IsRepG0Decoders=g(12),r.m_IsRepG1Decoders=g(12),r.m_IsRepG2Decoders=g(12),r.m_IsRep0LongDecoders=g(192),r.m_PosSlotDecoder=g(4),r.m_PosDecoders=g(114),r.m_PosAlignDecoder=ne({},4),r.m_LenDecoder=Bt({}),r.m_RepLenDecoder=Bt({}),r.m_LiteralDecoder={};for(var u=0;u<4;++u)r.m_PosSlotDecoder[u]=ne({},6);return r}function Qt(r){r.m_OutWindow._streamPos=0,r.m_OutWindow._pos=0,Ge(r.m_IsMatchDecoders),Ge(r.m_IsRep0LongDecoders),Ge(r.m_IsRepDecoders),Ge(r.m_IsRepG0Decoders),Ge(r.m_IsRepG1Decoders),Ge(r.m_IsRepG2Decoders),Ge(r.m_PosDecoders),ri(r.m_LiteralDecoder);for(var u=0;u<4;++u)Ge(r.m_PosSlotDecoder[u].Models);Mr(r.m_LenDecoder),Mr(r.m_RepLenDecoder),Ge(r.m_PosAlignDecoder.Models),bi(r.m_RangeDecoder)}function Pr(r,u){var k,I,A,O,J,ge,ye;if(u.length<5)return 0;for(ye=u[0]&255,A=ye%9,ge=~~(ye/9),O=ge%5,J=~~(ge/5),k=0,I=0;I<4;++I)k+=(u[1+I]&255)<<I*8;return k>99999999||!dr(r,A,O,J)?0:At(r,k)}function At(r,u){return u<0?0:(r.m_DictionarySize!=u&&(r.m_DictionarySize=u,r.m_DictionarySizeCheck=Math.max(r.m_DictionarySize,1),U(r.m_OutWindow,Math.max(r.m_DictionarySizeCheck,4096))),1)}function dr(r,u,k,I){if(u>8||k>4||I>4)return 0;ir(r.m_LiteralDecoder,k,u);var A=1<<I;return kr(r.m_LenDecoder,A),kr(r.m_RepLenDecoder,A),r.m_PosStateMask=A-1,1}function kr(r,u){for(;r.m_NumPosStates<u;++r.m_NumPosStates)r.m_LowCoder[r.m_NumPosStates]=ne({},3),r.m_MidCoder[r.m_NumPosStates]=ne({},3)}function Hr(r,u,k){if(!ct(u,r.m_Choice,0))return oe(r.m_LowCoder[k],u);var I=8;return ct(u,r.m_Choice,1)?I+=8+oe(r.m_HighCoder,u):I+=oe(r.m_MidCoder[k],u),I}function Bt(r){return r.m_Choice=g(2),r.m_LowCoder=g(16),r.m_MidCoder=g(16),r.m_HighCoder=ne({},8),r.m_NumPosStates=0,r}function Mr(r){Ge(r.m_Choice);for(var u=0;u<r.m_NumPosStates;++u)Ge(r.m_LowCoder[u].Models),Ge(r.m_MidCoder[u].Models);Ge(r.m_HighCoder.Models)}function ir(r,u,k){var I,A;if(!(r.m_Coders!=null&&r.m_NumPrevBits==k&&r.m_NumPosBits==u))for(r.m_NumPosBits=u,r.m_PosMask=(1<<u)-1,r.m_NumPrevBits=k,A=1<<r.m_NumPrevBits+r.m_NumPosBits,r.m_Coders=g(A),I=0;I<A;++I)r.m_Coders[I]=ai({})}function ar(r,u,k){return r.m_Coders[((u&r.m_PosMask)<<r.m_NumPrevBits)+((k&255)>>>8-r.m_NumPrevBits)]}function ri(r){var u,k;for(k=1<<r.m_NumPrevBits+r.m_NumPosBits,u=0;u<k;++u)Ge(r.m_Coders[u].m_Decoders)}function ni(r,u){var k=1;do k=k<<1|ct(u,r.m_Decoders,k);while(k<256);return k<<24>>24}function ii(r,u,k){var I,A,O=1;do if(A=k>>7&1,k<<=1,I=ct(u,r.m_Decoders,(1+A<<8)+O),O=O<<1|I,A!=I){for(;O<256;)O=O<<1|ct(u,r.m_Decoders,O);break}while(O<256);return O<<24>>24}function ai(r){return r.m_Decoders=g(768),r}var mr=function(){var r,u,k,I=2,A=[0,1];for(k=2;k<22;++k)for(u=1<<(k>>1)-1,r=0;r<u;++r,++I)A[I]=k<<24>>24;return A}();function En(r,u){var k,I,A,O;r._optimumEndIndex=u,A=r._optimum[u].PosPrev,I=r._optimum[u].BackPrev;do r._optimum[u].Prev1IsChar&&(F(r._optimum[A]),r._optimum[A].PosPrev=A-1,r._optimum[u].Prev2&&(r._optimum[A-1].Prev1IsChar=0,r._optimum[A-1].PosPrev=r._optimum[u].PosPrev2,r._optimum[A-1].BackPrev=r._optimum[u].BackPrev2)),O=A,k=I,I=r._optimum[O].BackPrev,A=r._optimum[O].PosPrev,r._optimum[O].BackPrev=k,r._optimum[O].PosPrev=u,u=O;while(u>0);return r.backRes=r._optimum[0].BackPrev,r._optimumCurrentIndex=r._optimum[0].PosPrev,r._optimumCurrentIndex}function si(r){r._state=0,r._previousByte=0;for(var u=0;u<4;++u)r._repDistances[u]=0}function oi(r,u,k,I){var A,O,J,ge,ye,Se,Pe,Ke,Re,Fe,dt,ke,Ve,ut,We;if(u[0]=l,k[0]=l,I[0]=1,r._inStream&&(r._matchFinder._stream=r._inStream,kt(r._matchFinder),r._needReleaseMFStream=1,r._inStream=null),!r._finished){if(r._finished=1,ut=r.nowPos64,v(r.nowPos64,l)){if(!fe(r._matchFinder)){hn(r,b(r.nowPos64));return}dn(r),Ve=b(r.nowPos64)&r._posStateMask,tt(r._rangeEncoder,r._isMatch,(r._state<<4)+Ve,0),r._state=se(r._state),J=ve(r._matchFinder,-r._additionalOffset),R(gr(r._literalEncoder,b(r.nowPos64),r._previousByte),r._rangeEncoder,J),r._previousByte=J,--r._additionalOffset,r.nowPos64=h(r.nowPos64,c)}if(!fe(r._matchFinder)){hn(r,b(r.nowPos64));return}for(;;){if(Pe=ui(r,b(r.nowPos64)),Fe=r.backRes,Ve=b(r.nowPos64)&r._posStateMask,O=(r._state<<4)+Ve,Pe==1&&Fe==-1)tt(r._rangeEncoder,r._isMatch,O,0),J=ve(r._matchFinder,-r._additionalOffset),We=gr(r._literalEncoder,b(r.nowPos64),r._previousByte),r._state<7?R(We,r._rangeEncoder,J):(Re=ve(r._matchFinder,-r._repDistances[0]-1-r._additionalOffset),T(We,r._rangeEncoder,Re,J)),r._previousByte=J,r._state=se(r._state);else{if(tt(r._rangeEncoder,r._isMatch,O,1),Fe<4){if(tt(r._rangeEncoder,r._isRep,r._state,1),Fe?(tt(r._rangeEncoder,r._isRepG0,r._state,1),Fe==1?tt(r._rangeEncoder,r._isRepG1,r._state,0):(tt(r._rangeEncoder,r._isRepG1,r._state,1),tt(r._rangeEncoder,r._isRepG2,r._state,Fe-2))):(tt(r._rangeEncoder,r._isRepG0,r._state,0),Pe==1?tt(r._rangeEncoder,r._isRep0Long,O,0):tt(r._rangeEncoder,r._isRep0Long,O,1)),Pe==1?r._state=r._state<7?9:11:(Ir(r._repMatchLenEncoder,r._rangeEncoder,Pe-2,Ve),r._state=r._state<7?8:11),ge=r._repDistances[Fe],Fe!=0){for(Se=Fe;Se>=1;--Se)r._repDistances[Se]=r._repDistances[Se-1];r._repDistances[0]=ge}}else{for(tt(r._rangeEncoder,r._isRep,r._state,0),r._state=r._state<7?7:10,Ir(r._lenEncoder,r._rangeEncoder,Pe-2,Ve),Fe-=4,ke=Vr(Fe),Ke=pe(Pe),De(r._posSlotEncoder[Ke],r._rangeEncoder,ke),ke>=4&&(ye=(ke>>1)-1,A=(2|ke&1)<<ye,dt=Fe-A,ke<14?it(r._posEncoders,A-ke-1,r._rangeEncoder,ye,dt):(On(r._rangeEncoder,dt>>4,ye-4),je(r._posAlignEncoder,r._rangeEncoder,dt&15),++r._alignPriceCount)),ge=Fe,Se=3;Se>=1;--Se)r._repDistances[Se]=r._repDistances[Se-1];r._repDistances[0]=ge,++r._matchPriceCount}r._previousByte=ve(r._matchFinder,Pe-1-r._additionalOffset)}if(r._additionalOffset-=Pe,r.nowPos64=h(r.nowPos64,y(Pe)),!r._additionalOffset){if(r._matchPriceCount>=128&&In(r),r._alignPriceCount>=16&&fn(r),u[0]=r.nowPos64,k[0]=Fn(r._rangeEncoder),!fe(r._matchFinder)){hn(r,b(r.nowPos64));return}if(d(H(r.nowPos64,ut),[4096,0])>=0){r._finished=0,I[0]=0;return}}}}}function li(r){var u,k;r._matchFinder||(u={},k=4,r._matchFinderType||(k=2),Z(u,k),r._matchFinder=u),vi(r._literalEncoder,r._numLiteralPosStateBits,r._numLiteralContextBits),!(r._dictionarySize==r._dictionarySizePrev&&r._numFastBytesPrev==r._numFastBytes)&&(et(r._matchFinder,r._dictionarySize,4096,r._numFastBytes,274),r._dictionarySizePrev=r._dictionarySize,r._numFastBytesPrev=r._numFastBytes)}function ci(r){var u;for(r._repDistances=g(4),r._optimum=[],r._rangeEncoder={},r._isMatch=g(192),r._isRep=g(12),r._isRepG0=g(12),r._isRepG1=g(12),r._isRepG2=g(12),r._isRep0Long=g(192),r._posSlotEncoder=[],r._posEncoders=g(114),r._posAlignEncoder=be({},4),r._lenEncoder=Rn({}),r._repMatchLenEncoder=Rn({}),r._literalEncoder={},r._matchDistances=[],r._posSlotPrices=[],r._distancesPrices=[],r._alignPrices=g(16),r.reps=g(4),r.repLens=g(4),r.processedInSize=[l],r.processedOutSize=[l],r.finished=[0],r.properties=g(5),r.tempPrices=g(128),r._longestMatchLength=0,r._matchFinderType=1,r._numDistancePairs=0,r._numFastBytesPrev=-1,r.backRes=0,u=0;u<4096;++u)r._optimum[u]={};for(u=0;u<4;++u)r._posSlotEncoder[u]=be({},6);return r}function fn(r){for(var u=0;u<16;++u)r._alignPrices[u]=st(r._posAlignEncoder,u);r._alignPriceCount=0}function In(r){var u,k,I,A,O,J,ge,ye;for(A=4;A<128;++A)J=Vr(A),I=(J>>1)-1,u=(2|J&1)<<I,r.tempPrices[A]=Et(r._posEncoders,u-J-1,I,A-u);for(O=0;O<4;++O){for(k=r._posSlotEncoder[O],ge=O<<6,J=0;J<r._distTableSize;++J)r._posSlotPrices[ge+J]=ze(k,J);for(J=14;J<r._distTableSize;++J)r._posSlotPrices[ge+J]+=(J>>1)-1-4<<6;for(ye=O*128,A=0;A<4;++A)r._distancesPrices[ye+A]=r._posSlotPrices[ge+A];for(;A<128;++A)r._distancesPrices[ye+A]=r._posSlotPrices[ge+Vr(A)]+r.tempPrices[A]}r._matchPriceCount=0}function hn(r,u){An(r),gi(r,u&r._posStateMask);for(var k=0;k<5;++k)wi(r._rangeEncoder)}function ui(r,u){var k,I,A,O,J,ge,ye,Se,Pe,Ke,Re,Fe,dt,ke,Ve,ut,We,Ht,vt,Vt,Jt,Lt,Yr,zn,Wt,Ct,$t,It,or,ft,Ee,vr,Dr,bt,wt,Vi,Yt,_n,xr,lr,Xr,gn,Ye,mt,Zr,Wi,Yi,Xi,Zi,Ki;if(r._optimumEndIndex!=r._optimumCurrentIndex)return dt=r._optimum[r._optimumCurrentIndex].PosPrev-r._optimumCurrentIndex,r.backRes=r._optimum[r._optimumCurrentIndex].BackPrev,r._optimumCurrentIndex=r._optimum[r._optimumCurrentIndex].PosPrev,dt;if(r._optimumCurrentIndex=r._optimumEndIndex=0,r._longestMatchWasFound?(Fe=r._longestMatchLength,r._longestMatchWasFound=0):Fe=dn(r),$t=r._numDistancePairs,Wt=fe(r._matchFinder)+1,Wt<2)return r.backRes=-1,1;for(Wt>273&&(Wt=273),lr=0,Pe=0;Pe<4;++Pe)r.reps[Pe]=r._repDistances[Pe],r.repLens[Pe]=me(r._matchFinder,-1,r.reps[Pe],273),r.repLens[Pe]>r.repLens[lr]&&(lr=Pe);if(r.repLens[lr]>=r._numFastBytes)return r.backRes=lr,dt=r.repLens[lr],xn(r,dt-1),dt;if(Fe>=r._numFastBytes)return r.backRes=r._matchDistances[$t-1]+4,xn(r,Fe-1),Fe;if(ye=ve(r._matchFinder,-1),We=ve(r._matchFinder,-r._repDistances[0]-1-1),Fe<2&&ye!=We&&r.repLens[lr]<2)return r.backRes=-1,1;if(r._optimum[0].State=r._state,bt=u&r._posStateMask,r._optimum[1].Price=He[r._isMatch[(r._state<<4)+bt]>>>2]+j(gr(r._literalEncoder,u,r._previousByte),r._state>=7,We,ye),F(r._optimum[1]),Ht=He[2048-r._isMatch[(r._state<<4)+bt]>>>2],xr=Ht+He[2048-r._isRep[r._state]>>>2],We==ye&&(Xr=xr+fi(r,r._state,bt),Xr<r._optimum[1].Price&&(r._optimum[1].Price=Xr,C(r._optimum[1]))),Re=Fe>=r.repLens[lr]?Fe:r.repLens[lr],Re<2)return r.backRes=r._optimum[1].BackPrev,1;r._optimum[1].PosPrev=0,r._optimum[0].Backs0=r.reps[0],r._optimum[0].Backs1=r.reps[1],r._optimum[0].Backs2=r.reps[2],r._optimum[0].Backs3=r.reps[3],Ke=Re;do r._optimum[Ke--].Price=268435455;while(Ke>=2);for(Pe=0;Pe<4;++Pe)if(_n=r.repLens[Pe],!(_n<2)){Vi=xr+pr(r,Pe,r._state,bt);do O=Vi+sr(r._repMatchLenEncoder,_n-2,bt),Ee=r._optimum[_n],O<Ee.Price&&(Ee.Price=O,Ee.PosPrev=0,Ee.BackPrev=Pe,Ee.Prev1IsChar=0);while(--_n>=2)}if(zn=Ht+He[r._isRep[r._state]>>>2],Ke=r.repLens[0]>=2?r.repLens[0]+1:2,Ke<=Fe){for(It=0;Ke>r._matchDistances[It];)It+=2;for(;Se=r._matchDistances[It+1],O=zn+Dn(r,Se,Ke,bt),Ee=r._optimum[Ke],O<Ee.Price&&(Ee.Price=O,Ee.PosPrev=0,Ee.BackPrev=Se+4,Ee.Prev1IsChar=0),!(Ke==r._matchDistances[It]&&(It+=2,It==$t));++Ke);}for(k=0;;){if(++k,k==Re)return En(r,k);if(vt=dn(r),$t=r._numDistancePairs,vt>=r._numFastBytes)return r._longestMatchLength=vt,r._longestMatchWasFound=1,En(r,k);if(++u,Dr=r._optimum[k].PosPrev,r._optimum[k].Prev1IsChar?(--Dr,r._optimum[k].Prev2?(Ye=r._optimum[r._optimum[k].PosPrev2].State,r._optimum[k].BackPrev2<4?Ye=Ye<7?8:11:Ye=Ye<7?7:10):Ye=r._optimum[Dr].State,Ye=se(Ye)):Ye=r._optimum[Dr].State,Dr==k-1?r._optimum[k].BackPrev?Ye=se(Ye):Ye=Ye<7?9:11:(r._optimum[k].Prev1IsChar&&r._optimum[k].Prev2?(Dr=r._optimum[k].PosPrev2,vr=r._optimum[k].BackPrev2,Ye=Ye<7?8:11):(vr=r._optimum[k].BackPrev,vr<4?Ye=Ye<7?8:11:Ye=Ye<7?7:10),ft=r._optimum[Dr],vr<4?vr?vr==1?(r.reps[0]=ft.Backs1,r.reps[1]=ft.Backs0,r.reps[2]=ft.Backs2,r.reps[3]=ft.Backs3):vr==2?(r.reps[0]=ft.Backs2,r.reps[1]=ft.Backs0,r.reps[2]=ft.Backs1,r.reps[3]=ft.Backs3):(r.reps[0]=ft.Backs3,r.reps[1]=ft.Backs0,r.reps[2]=ft.Backs1,r.reps[3]=ft.Backs2):(r.reps[0]=ft.Backs0,r.reps[1]=ft.Backs1,r.reps[2]=ft.Backs2,r.reps[3]=ft.Backs3):(r.reps[0]=vr-4,r.reps[1]=ft.Backs0,r.reps[2]=ft.Backs1,r.reps[3]=ft.Backs2)),r._optimum[k].State=Ye,r._optimum[k].Backs0=r.reps[0],r._optimum[k].Backs1=r.reps[1],r._optimum[k].Backs2=r.reps[2],r._optimum[k].Backs3=r.reps[3],ge=r._optimum[k].Price,ye=ve(r._matchFinder,-1),We=ve(r._matchFinder,-r.reps[0]-1-1),bt=u&r._posStateMask,I=ge+He[r._isMatch[(Ye<<4)+bt]>>>2]+j(gr(r._literalEncoder,u,ve(r._matchFinder,-2)),Ye>=7,We,ye),Lt=r._optimum[k+1],Vt=0,I<Lt.Price&&(Lt.Price=I,Lt.PosPrev=k,Lt.BackPrev=-1,Lt.Prev1IsChar=0,Vt=1),Ht=ge+He[2048-r._isMatch[(Ye<<4)+bt]>>>2],xr=Ht+He[2048-r._isRep[Ye]>>>2],We==ye&&!(Lt.PosPrev<k&&!Lt.BackPrev)&&(Xr=xr+(He[r._isRepG0[Ye]>>>2]+He[r._isRep0Long[(Ye<<4)+bt]>>>2]),Xr<=Lt.Price&&(Lt.Price=Xr,Lt.PosPrev=k,Lt.BackPrev=0,Lt.Prev1IsChar=0,Vt=1)),Ct=fe(r._matchFinder)+1,Ct=4095-k<Ct?4095-k:Ct,Wt=Ct,!(Wt<2)){if(Wt>r._numFastBytes&&(Wt=r._numFastBytes),!Vt&&We!=ye&&(Zr=Math.min(Ct-1,r._numFastBytes),Ve=me(r._matchFinder,0,r.reps[0],Zr),Ve>=2)){for(mt=se(Ye),wt=u+1&r._posStateMask,Yr=I+He[2048-r._isMatch[(mt<<4)+wt]>>>2]+He[2048-r._isRep[mt]>>>2],or=k+1+Ve;Re<or;)r._optimum[++Re].Price=268435455;O=Yr+(Wi=sr(r._repMatchLenEncoder,Ve-2,wt),Wi+pr(r,0,mt,wt)),Ee=r._optimum[or],O<Ee.Price&&(Ee.Price=O,Ee.PosPrev=k+1,Ee.BackPrev=0,Ee.Prev1IsChar=1,Ee.Prev2=0)}for(gn=2,Yt=0;Yt<4;++Yt)if(ke=me(r._matchFinder,-1,r.reps[Yt],Wt),!(ke<2)){ut=ke;do{for(;Re<k+ke;)r._optimum[++Re].Price=268435455;O=xr+(Yi=sr(r._repMatchLenEncoder,ke-2,bt),Yi+pr(r,Yt,Ye,bt)),Ee=r._optimum[k+ke],O<Ee.Price&&(Ee.Price=O,Ee.PosPrev=k,Ee.BackPrev=Yt,Ee.Prev1IsChar=0)}while(--ke>=2);if(ke=ut,Yt||(gn=ke+1),ke<Ct&&(Zr=Math.min(Ct-1-ke,r._numFastBytes),Ve=me(r._matchFinder,ke,r.reps[Yt],Zr),Ve>=2)){for(mt=Ye<7?8:11,wt=u+ke&r._posStateMask,A=xr+(Xi=sr(r._repMatchLenEncoder,ke-2,bt),Xi+pr(r,Yt,Ye,bt))+He[r._isMatch[(mt<<4)+wt]>>>2]+j(gr(r._literalEncoder,u+ke,ve(r._matchFinder,ke-1-1)),1,ve(r._matchFinder,ke-1-(r.reps[Yt]+1)),ve(r._matchFinder,ke-1)),mt=se(mt),wt=u+ke+1&r._posStateMask,Jt=A+He[2048-r._isMatch[(mt<<4)+wt]>>>2],Yr=Jt+He[2048-r._isRep[mt]>>>2],or=ke+1+Ve;Re<k+or;)r._optimum[++Re].Price=268435455;O=Yr+(Zi=sr(r._repMatchLenEncoder,Ve-2,wt),Zi+pr(r,0,mt,wt)),Ee=r._optimum[k+or],O<Ee.Price&&(Ee.Price=O,Ee.PosPrev=k+ke+1,Ee.BackPrev=0,Ee.Prev1IsChar=1,Ee.Prev2=1,Ee.PosPrev2=k,Ee.BackPrev2=Yt)}}if(vt>Wt){for(vt=Wt,$t=0;vt>r._matchDistances[$t];$t+=2);r._matchDistances[$t]=vt,$t+=2}if(vt>=gn){for(zn=Ht+He[r._isRep[Ye]>>>2];Re<k+vt;)r._optimum[++Re].Price=268435455;for(It=0;gn>r._matchDistances[It];)It+=2;for(ke=gn;;++ke)if(J=r._matchDistances[It+1],O=zn+Dn(r,J,ke,bt),Ee=r._optimum[k+ke],O<Ee.Price&&(Ee.Price=O,Ee.PosPrev=k,Ee.BackPrev=J+4,Ee.Prev1IsChar=0),ke==r._matchDistances[It]){if(ke<Ct&&(Zr=Math.min(Ct-1-ke,r._numFastBytes),Ve=me(r._matchFinder,ke,J,Zr),Ve>=2)){for(mt=Ye<7?7:10,wt=u+ke&r._posStateMask,A=O+He[r._isMatch[(mt<<4)+wt]>>>2]+j(gr(r._literalEncoder,u+ke,ve(r._matchFinder,ke-1-1)),1,ve(r._matchFinder,ke-(J+1)-1),ve(r._matchFinder,ke-1)),mt=se(mt),wt=u+ke+1&r._posStateMask,Jt=A+He[2048-r._isMatch[(mt<<4)+wt]>>>2],Yr=Jt+He[2048-r._isRep[mt]>>>2],or=ke+1+Ve;Re<k+or;)r._optimum[++Re].Price=268435455;O=Yr+(Ki=sr(r._repMatchLenEncoder,Ve-2,wt),Ki+pr(r,0,mt,wt)),Ee=r._optimum[k+or],O<Ee.Price&&(Ee.Price=O,Ee.PosPrev=k+ke+1,Ee.BackPrev=0,Ee.Prev1IsChar=1,Ee.Prev2=1,Ee.PosPrev2=k,Ee.BackPrev2=J+4)}if(It+=2,It==$t)break}}}}}function Dn(r,u,k,I){var A,O=pe(k);return u<128?A=r._distancesPrices[O*128+u]:A=r._posSlotPrices[(O<<6)+Tr(u)]+r._alignPrices[u&15],A+sr(r._lenEncoder,k-2,I)}function pr(r,u,k,I){var A;return u?(A=He[2048-r._isRepG0[k]>>>2],u==1?A+=He[r._isRepG1[k]>>>2]:(A+=He[2048-r._isRepG1[k]>>>2],A+=pn(r._isRepG2[k],u-2))):(A=He[r._isRepG0[k]>>>2],A+=He[2048-r._isRep0Long[(k<<4)+I]>>>2]),A}function fi(r,u,k){return He[r._isRepG0[u]>>>2]+He[r._isRep0Long[(u<<4)+k]>>>2]}function hi(r){si(r),Ua(r._rangeEncoder),Ge(r._isMatch),Ge(r._isRep0Long),Ge(r._isRep),Ge(r._isRepG0),Ge(r._isRepG1),Ge(r._isRepG2),Ge(r._posEncoders),P(r._literalEncoder);for(var u=0;u<4;++u)Ge(r._posSlotEncoder[u].Models);Ln(r._lenEncoder,1<<r._posStateBits),Ln(r._repMatchLenEncoder,1<<r._posStateBits),Ge(r._posAlignEncoder.Models),r._longestMatchWasFound=0,r._optimumEndIndex=0,r._optimumCurrentIndex=0,r._additionalOffset=0}function xn(r,u){u>0&&(D(r._matchFinder,u),r._additionalOffset+=u)}function dn(r){var u=0;return r._numDistancePairs=Tt(r._matchFinder,r._matchDistances),r._numDistancePairs>0&&(u=r._matchDistances[r._numDistancePairs-2],u==r._numFastBytes&&(u+=me(r._matchFinder,u-1,r._matchDistances[r._numDistancePairs-1],273-u))),++r._additionalOffset,u}function An(r){r._matchFinder&&r._needReleaseMFStream&&(r._matchFinder._stream=null,r._needReleaseMFStream=0)}function di(r){An(r),r._rangeEncoder.Stream=null}function mi(r,u){r._dictionarySize=u;for(var k=0;u>1<<k;++k);r._distTableSize=k*2}function pi(r,u){var k=r._matchFinderType;r._matchFinderType=u,r._matchFinder&&k!=r._matchFinderType&&(r._dictionarySizePrev=-1,r._matchFinder=null)}function _i(r,u){r.properties[0]=(r._posStateBits*5+r._numLiteralPosStateBits)*9+r._numLiteralContextBits<<24>>24;for(var k=0;k<4;++k)r.properties[1+k]=r._dictionarySize>>8*k<<24>>24;_(u,r.properties,0,5)}function gi(r,u){if(r._writeEndMark){tt(r._rangeEncoder,r._isMatch,(r._state<<4)+u,1),tt(r._rangeEncoder,r._isRep,r._state,0),r._state=r._state<7?7:10,Ir(r._lenEncoder,r._rangeEncoder,0,u);var k=pe(2);De(r._posSlotEncoder[k],r._rangeEncoder,63),On(r._rangeEncoder,67108863,26),je(r._posAlignEncoder,r._rangeEncoder,15)}}function Vr(r){return r<2048?mr[r]:r<2097152?mr[r>>10]+20:mr[r>>20]+40}function Tr(r){return r<131072?mr[r>>6]+12:r<134217728?mr[r>>16]+32:mr[r>>26]+52}function Bn(r,u,k,I){k<8?(tt(u,r._choice,0,0),De(r._lowCoder[I],u,k)):(k-=8,tt(u,r._choice,0,1),k<8?(tt(u,r._choice,1,0),De(r._midCoder[I],u,k)):(tt(u,r._choice,1,1),De(r._highCoder,u,k-8)))}function _r(r){r._choice=g(2),r._lowCoder=g(16),r._midCoder=g(16),r._highCoder=be({},8);for(var u=0;u<16;++u)r._lowCoder[u]=be({},3),r._midCoder[u]=be({},3);return r}function Ln(r,u){Ge(r._choice);for(var k=0;k<u;++k)Ge(r._lowCoder[k].Models),Ge(r._midCoder[k].Models);Ge(r._highCoder.Models)}function Er(r,u,k,I,A){var O,J,ge,ye,Se;for(O=He[r._choice[0]>>>2],J=He[2048-r._choice[0]>>>2],ge=J+He[r._choice[1]>>>2],ye=J+He[2048-r._choice[1]>>>2],Se=0,Se=0;Se<8;++Se){if(Se>=k)return;I[A+Se]=O+ze(r._lowCoder[u],Se)}for(;Se<16;++Se){if(Se>=k)return;I[A+Se]=ge+ze(r._midCoder[u],Se-8)}for(;Se<k;++Se)I[A+Se]=ye+ze(r._highCoder,Se-8-8)}function Ir(r,u,k,I){Bn(r,u,k,I),--r._counters[I]==0&&(Er(r,I,r._tableSize,r._prices,I*272),r._counters[I]=r._tableSize)}function Rn(r){return _r(r),r._prices=[],r._counters=[],r}function sr(r,u,k){return r._prices[k*272+u]}function Wr(r,u){for(var k=0;k<u;++k)Er(r,k,r._tableSize,r._prices,k*272),r._counters[k]=r._tableSize}function vi(r,u,k){var I,A;if(!(r.m_Coders!=null&&r.m_NumPrevBits==k&&r.m_NumPosBits==u))for(r.m_NumPosBits=u,r.m_PosMask=(1<<u)-1,r.m_NumPrevBits=k,A=1<<r.m_NumPrevBits+r.m_NumPosBits,r.m_Coders=g(A),I=0;I<A;++I)r.m_Coders[I]=N({})}function gr(r,u,k){return r.m_Coders[((u&r.m_PosMask)<<r.m_NumPrevBits)+((k&255)>>>8-r.m_NumPrevBits)]}function P(r){var u,k=1<<r.m_NumPrevBits+r.m_NumPosBits;for(u=0;u<k;++u)Ge(r.m_Coders[u].m_Encoders)}function R(r,u,k){var I,A,O=1;for(A=7;A>=0;--A)I=k>>A&1,tt(u,r.m_Encoders,O,I),O=O<<1|I}function T(r,u,k,I){var A,O,J,ge,ye=1,Se=1;for(O=7;O>=0;--O)A=I>>O&1,ge=Se,ye&&(J=k>>O&1,ge+=1+J<<8,ye=J==A),tt(u,r.m_Encoders,ge,A),Se=Se<<1|A}function N(r){return r.m_Encoders=g(768),r}function j(r,u,k,I){var A,O=1,J=7,ge,ye=0;if(u){for(;J>=0;--J)if(ge=k>>J&1,A=I>>J&1,ye+=pn(r.m_Encoders[(1+ge<<8)+O],A),O=O<<1|A,ge!=A){--J;break}}for(;J>=0;--J)A=I>>J&1,ye+=pn(r.m_Encoders[O],A),O=O<<1|A;return ye}function F(r){r.BackPrev=-1,r.Prev1IsChar=0}function C(r){r.BackPrev=0,r.Prev1IsChar=0}function ne(r,u){return r.NumBitLevels=u,r.Models=g(1<<u),r}function oe(r,u){var k,I=1;for(k=r.NumBitLevels;k!=0;--k)I=(I<<1)+ct(u,r.Models,I);return I-(1<<r.NumBitLevels)}function ue(r,u){var k,I,A=1,O=0;for(I=0;I<r.NumBitLevels;++I)k=ct(u,r.Models,A),A<<=1,A+=k,O|=k<<I;return O}function he(r,u,k,I){var A,O,J=1,ge=0;for(O=0;O<I;++O)A=ct(k,r,u+J),J<<=1,J+=A,ge|=A<<O;return ge}function be(r,u){return r.NumBitLevels=u,r.Models=g(1<<u),r}function De(r,u,k){var I,A,O=1;for(A=r.NumBitLevels;A!=0;)--A,I=k>>>A&1,tt(u,r.Models,O,I),O=O<<1|I}function ze(r,u){var k,I,A=1,O=0;for(I=r.NumBitLevels;I!=0;)--I,k=u>>>I&1,O+=pn(r.Models[A],k),A=(A<<1)+k;return O}function je(r,u,k){var I,A,O=1;for(A=0;A<r.NumBitLevels;++A)I=k&1,tt(u,r.Models,O,I),O=O<<1|I,k>>=1}function st(r,u){var k,I,A=1,O=0;for(I=r.NumBitLevels;I!=0;--I)k=u&1,u>>>=1,O+=pn(r.Models[A],k),A=A<<1|k;return O}function it(r,u,k,I,A){var O,J,ge=1;for(J=0;J<I;++J)O=A&1,tt(k,r,u+ge,O),ge=ge<<1|O,A>>=1}function Et(r,u,k,I){var A,O,J=1,ge=0;for(O=k;O!=0;--O)A=I&1,I>>>=1,ge+=He[((r[u+J]-A^-A)&2047)>>>2],J=J<<1|A;return ge}function ct(r,u,k){var I,A=u[k];return I=(r.Range>>>11)*A,(r.Code^-2147483648)<(I^-2147483648)?(r.Range=I,u[k]=A+(2048-A>>>5)<<16>>16,r.Range&-16777216||(r.Code=r.Code<<8|G(r.Stream),r.Range<<=8),0):(r.Range-=I,r.Code-=I,u[k]=A-(A>>>5)<<16>>16,r.Range&-16777216||(r.Code=r.Code<<8|G(r.Stream),r.Range<<=8),1)}function mn(r,u){var k,I,A=0;for(k=u;k!=0;--k)r.Range>>>=1,I=r.Code-r.Range>>>31,r.Code-=r.Range&I-1,A=A<<1|1-I,r.Range&-16777216||(r.Code=r.Code<<8|G(r.Stream),r.Range<<=8);return A}function bi(r){r.Code=0,r.Range=-1;for(var u=0;u<5;++u)r.Code=r.Code<<8|G(r.Stream)}function Ge(r){for(var u=r.length-1;u>=0;--u)r[u]=1024}var He=function(){var r,u,k,I,A=[];for(u=8;u>=0;--u)for(I=1<<9-u-1,r=1<<9-u,k=I;k<r;++k)A[k]=(u<<6)+(r-k<<6>>>9-u-1);return A}();function tt(r,u,k,I){var A,O=u[k];A=(r.Range>>>11)*O,I?(r.Low=h(r.Low,w(y(A),[4294967295,0])),r.Range-=A,u[k]=O-(O>>>5)<<16>>16):(r.Range=A,u[k]=O+(2048-O>>>5)<<16>>16),r.Range&-16777216||(r.Range<<=8,wi(r))}function On(r,u,k){for(var I=k-1;I>=0;--I)r.Range>>>=1,(u>>>I&1)==1&&(r.Low=h(r.Low,y(r.Range))),r.Range&-16777216||(r.Range<<=8,wi(r))}function Fn(r){return h(h(y(r._cacheSize),r._position),[4,0])}function Ua(r){r._position=l,r.Low=l,r.Range=-1,r._cacheSize=1,r._cache=0}function wi(r){var u,k=b(W(r.Low,32));if(k!=0||d(r.Low,[4278190080,0])<0){r._position=h(r._position,y(r._cacheSize)),u=r._cache;do q(r.Stream,u+k),u=255;while(--r._cacheSize!=0);r._cache=b(r.Low)>>>24}++r._cacheSize,r.Low=z(w(r.Low,[16777215,0]),8)}function pn(r,u){return He[((r-u^-u)&2047)>>>2]}function ji(r){for(var u=0,k=0,I,A,O,J=r.length,ge=[],ye=[];u<J;++u,++k){if(I=r[u]&255,I&128)if((I&224)==192){if(u+1>=J||(A=r[++u]&255,(A&192)!=128))return r;ye[k]=(I&31)<<6|A&63}else if((I&240)==224){if(u+2>=J||(A=r[++u]&255,(A&192)!=128)||(O=r[++u]&255,(O&192)!=128))return r;ye[k]=(I&15)<<12|(A&63)<<6|O&63}else return r;else{if(!I)return r;ye[k]=I}k==16383&&(ge.push(String.fromCharCode.apply(String,ye)),k=-1)}return k>0&&(ye.length=k,ge.push(String.fromCharCode.apply(String,ye))),ge.join("")}function Gi(r){var u,k=[],I,A=0,O,J=r.length;if(typeof r=="object")return r;for($(r,0,J,k,0),O=0;O<J;++O)u=k[O],u>=1&&u<=127?++A:!u||u>=128&&u<=2047?A+=2:A+=3;for(I=[],A=0,O=0;O<J;++O)u=k[O],u>=1&&u<=127?I[A++]=u<<24>>24:!u||u>=128&&u<=2047?(I[A++]=(192|u>>6&31)<<24>>24,I[A++]=(128|u&63)<<24>>24):(I[A++]=(224|u>>12&15)<<24>>24,I[A++]=(128|u>>6&63)<<24>>24,I[A++]=(128|u&63)<<24>>24);return I}function Nn(r){return r[1]+r[0]}function ja(r,u,k,I){var A={},O,J,ge=typeof k>"u"&&typeof I>"u";if(typeof k!="function"&&(J=k,k=I=0),I=I||function(Se){if(!(typeof J>"u"))return p(Se,J)},k=k||function(Se,Pe){if(!(typeof J>"u"))return postMessage({action:n,cbn:J,result:Se,error:Pe})},ge){for(A.c=le({},Gi(r),Hi(u));Ae(A.c.chunker););return B(A.c.output)}try{A.c=le({},Gi(r),Hi(u)),I(0)}catch(Se){return k(null,Se)}function ye(){try{for(var Se,Pe=new Date().getTime();Ae(A.c.chunker);)if(O=Nn(A.c.chunker.inBytesProcessed)/Nn(A.c.length_0),new Date().getTime()-Pe>200)return I(O),i(ye,0),0;I(1),Se=B(A.c.output),i(k.bind(null,Se),0)}catch(Ke){k(null,Ke)}}i(ye,0)}function Ga(r,u,k){var I={},A,O,J,ge,ye=typeof u>"u"&&typeof k>"u";if(typeof u!="function"&&(O=u,u=k=0),k=k||function(Pe){if(!(typeof O>"u"))return p(J?Pe:-1,O)},u=u||function(Pe,Ke){if(!(typeof O>"u"))return postMessage({action:e,cbn:O,result:Pe,error:Ke})},ye){for(I.d=Y({},r);Ae(I.d.chunker););return ji(B(I.d.output))}try{I.d=Y({},r),ge=Nn(I.d.length_0),J=ge>-1,k(0)}catch(Pe){return u(null,Pe)}function Se(){try{for(var Pe,Ke=0,Re=new Date().getTime();Ae(I.d.chunker);)if(++Ke%1e3==0&&new Date().getTime()-Re>200)return J&&(A=Nn(I.d.chunker.decoder.nowPos64)/ge,k(A)),i(Se,0),0;k(1),Pe=ji(B(I.d.output)),i(u.bind(null,Pe),0)}catch(Fe){u(null,Fe)}}i(Se,0)}var Hi=function(){var r=[{s:16,f:64,m:0},{s:20,f:64,m:0},{s:19,f:64,m:1},{s:20,f:64,m:1},{s:21,f:128,m:1},{s:22,f:128,m:1},{s:23,f:128,m:1},{s:24,f:255,m:1},{s:25,f:255,m:1}];return function(u){return r[u-1]||r[6]}}();return{compress:ja,decompress:Ga}}();class ae{static parseInt(e,t=this.MAX_PARSE_VALUE,i=!1){return this._getValue(parseInt(e),t,i)}static parseFloat(e,t=this.MAX_PARSE_VALUE,i=!1){return this._getValue(parseFloat(e),t,i)}static parseEnum(e,t){const i=t.trim(),a=parseInt(i);if(a in e)return a;if(i in e)return e[i];throw new Error("Unknown enum value!")}static parseByte(e){const t=parseInt(e);if(t<0)throw new Error("Value must be greater than 0!");if(t>255)throw new Error("Value must be less than 255!");return this._getValue(t)}static _getValue(e,t=this.MAX_PARSE_VALUE,i=!1){if(e<-t)throw new Error("Value is too low!");if(e>t)throw new Error("Value is too high!");if(!i&&Number.isNaN(e))throw new Error("Not a number");return e}}m(ae,"MAX_COORDINATE_VALUE",131072),m(ae,"MAX_PARSE_VALUE",2147483647);class fo{static handleLine(e,t){const[i,...a]=e.split(":"),s=a.join(":").trim().split(",").map(l=>ae.parseByte(l));if(s.length!==3&&s.length!==4)throw new Error(`Color specified in incorrect format (should be R,G,B or R,G,B,A): ${s.join(",")}`);const o=new ur(s[0],s[1],s[2],s[3]);this.addColor(o,t,i.trim())}static addColor(e,t,i){if(i==="SliderTrackOverride"){t.colors.sliderTrackColor=e;return}if(i==="SliderBorder"){t.colors.sliderBorderColor=e;return}i.startsWith("Combo")&&t.colors.comboColors.push(e)}}class ho{static handleLine(e,t){const[i,...a]=e.split(":"),s=a.join(":").trim();switch(i.trim()){case"CircleSize":t.difficulty.circleSize=ae.parseFloat(s);break;case"HPDrainRate":t.difficulty.drainRate=ae.parseFloat(s);break;case"OverallDifficulty":t.difficulty.overallDifficulty=ae.parseFloat(s);break;case"ApproachRate":t.difficulty.approachRate=ae.parseFloat(s);break;case"SliderMultiplier":t.difficulty.sliderMultiplier=ae.parseFloat(s);break;case"SliderTickRate":t.difficulty.sliderTickRate=ae.parseFloat(s)}}}class mo{static handleLine(e,t){const[i,...a]=e.split(":"),s=a.join(":").trim();switch(i.trim()){case"Bookmarks":t.editor.bookmarks=s.split(",").map(o=>+o);break;case"DistanceSpacing":t.editor.distanceSpacing=Math.max(0,ae.parseFloat(s));break;case"BeatDivisor":t.editor.beatDivisor=ae.parseInt(s);break;case"GridSize":t.editor.gridSize=ae.parseInt(s);break;case"TimelineZoom":t.editor.timelineZoom=Math.max(0,ae.parseFloat(s))}}}class Ma{static handleLine(e,t){const i=this._getDepth(e);switch(i>0&&(e=e.substring(i)),i<2&&this._storyboardSprite&&(this._timelineGroup=this._storyboardSprite.timelineGroup),i){case 0:return this._handleElement(e,t);case 1:return this._handleCompoundOrCommand(e);case 2:return this._handleCommand(e)}}static _handleElement(e,t){var s;const i=e.split(","),a=this.parseEventType(i[0]);switch((s=this._storyboardSprite)!=null&&s.hasCommands&&(this._storyboardSprite.updateCommands(),this._storyboardSprite.adjustTimesToCommands(),this._storyboardSprite.resetValuesToCommands()),a){case gt.Video:{const o=t.getLayerByType(zt.Video),l=ae.parseInt(i[1]),c=i[2].replace(/"/g,"");o.elements.push(new ga(c,l));return}case gt.Sprite:{const o=t.getLayerByType(this.parseLayerType(i[1])),l=this.parseOrigin(i[2]),c=this.convertOrigin(l),p=i[3].replace(/"/g,""),g=ae.parseFloat(i[4],ae.MAX_COORDINATE_VALUE),h=ae.parseFloat(i[5],ae.MAX_COORDINATE_VALUE);this._storyboardSprite=new Bi(p,l,c,new Le(g,h)),o.elements.push(this._storyboardSprite);return}case gt.Animation:{const o=t.getLayerByType(this.parseLayerType(i[1])),l=this.parseOrigin(i[2]),c=this.convertOrigin(l),p=i[3].replace(/"/g,""),g=ae.parseFloat(i[4],ae.MAX_COORDINATE_VALUE),h=ae.parseFloat(i[5],ae.MAX_COORDINATE_VALUE),w=ae.parseInt(i[6]);let d=ae.parseFloat(i[7]);t.fileFormat<6&&(d=Math.round(.015*d)*1.186*(1e3/60));const S=this.parseLoopType(i[8]);this._storyboardSprite=new pa(p,l,c,new Le(g,h),w,d,S),o.elements.push(this._storyboardSprite);return}case gt.Sample:{const o=ae.parseFloat(i[1]),l=t.getLayerByType(this.parseLayerType(i[2])),c=i[3].replace(/"/g,""),p=i.length>4?ae.parseInt(i[4]):100,g=new _a(c,o,p);l.elements.push(g)}}}static _handleCompoundOrCommand(e){var a,s;const t=e.split(",");switch(t[0]){case nn.Trigger:{this._timelineGroup=(a=this._storyboardSprite)==null?void 0:a.addTrigger(t[1],t.length>2?ae.parseFloat(t[2]):-1/0,t.length>3?ae.parseFloat(t[3]):1/0,t.length>4?ae.parseInt(t[4]):0);return}case nn.Loop:{this._timelineGroup=(s=this._storyboardSprite)==null?void 0:s.addLoop(ae.parseFloat(t[1]),Math.max(0,ae.parseInt(t[2])-1));return}default:this._handleCommand(e)}}static _handleCommand(e){var l,c,p,g,h,w,d,S,v;const t=e.split(","),i=t[0],a=ae.parseInt(t[1]),s=ae.parseInt(t[2]),o=ae.parseInt(t[3]||t[2]);switch(i){case Ze.Fade:{const y=ae.parseFloat(t[4]),b=t.length>5?ae.parseFloat(t[5]):y;(l=this._timelineGroup)==null||l.alpha.add(i,a,s,o,y,b);return}case Ze.Scale:{const y=ae.parseFloat(t[4]),b=t.length>5?ae.parseFloat(t[5]):y;(c=this._timelineGroup)==null||c.scale.add(i,a,s,o,y,b);return}case Ze.VectorScale:{const y=ae.parseFloat(t[4]),b=ae.parseFloat(t[5]),M=t.length>6?ae.parseFloat(t[6]):y,L=t.length>7?ae.parseFloat(t[7]):b;(p=this._timelineGroup)==null||p.vectorScale.add(i,a,s,o,new Le(y,b),new Le(M,L));return}case Ze.Rotation:{const y=ae.parseFloat(t[4]),b=t.length>5?ae.parseFloat(t[5]):y;(g=this._timelineGroup)==null||g.rotation.add(i,a,s,o,y,b);return}case Ze.Movement:{const y=ae.parseFloat(t[4]),b=ae.parseFloat(t[5]),M=t.length>6?ae.parseFloat(t[6]):y,L=t.length>7?ae.parseFloat(t[7]):b;(h=this._timelineGroup)==null||h.x.add(Ze.MovementX,a,s,o,y,M),(w=this._timelineGroup)==null||w.y.add(Ze.MovementY,a,s,o,b,L);return}case Ze.MovementX:{const y=ae.parseFloat(t[4]),b=t.length>5?ae.parseFloat(t[5]):y;(d=this._timelineGroup)==null||d.x.add(i,a,s,o,y,b);return}case Ze.MovementY:{const y=ae.parseFloat(t[4]),b=t.length>5?ae.parseFloat(t[5]):y;(S=this._timelineGroup)==null||S.y.add(i,a,s,o,y,b);return}case Ze.Color:{const y=ae.parseFloat(t[4]),b=ae.parseFloat(t[5]),M=ae.parseFloat(t[6]),L=t.length>7?ae.parseFloat(t[7]):y,z=t.length>8?ae.parseFloat(t[8]):b,x=t.length>9?ae.parseFloat(t[9]):M;(v=this._timelineGroup)==null||v.color.add(i,a,s,o,new ur(y,b,M,1),new ur(L,z,x,1));return}case Ze.Parameter:return this._handleParameterCommand(t)}throw new Error(`Unknown command type: ${i}`)}static _handleParameterCommand(e){var l,c,p;const t=Ze.Parameter,i=ae.parseInt(e[1]),a=ae.parseInt(e[2]),s=ae.parseInt(e[3]||e[2]),o=e[4];switch(o){case cr.BlendingMode:{const g=tn.Additive,h=a===s?tn.Additive:tn.Inherit;(l=this._timelineGroup)==null||l.blendingParameters.add(t,i,a,s,g,h,o);return}case cr.HorizontalFlip:(c=this._timelineGroup)==null||c.flipH.add(t,i,a,s,!0,a===s,o);return;case cr.VerticalFlip:{(p=this._timelineGroup)==null||p.flipV.add(t,i,a,s,!0,a===s,o);return}}throw new Error(`Unknown parameter type: ${o}`)}static parseEventType(e){if(e.startsWith(" ")||e.startsWith("_"))return gt.StoryboardCommand;try{return ae.parseEnum(gt,e)}catch{throw new Error(`Unknown event type: ${e}`)}}static parseLayerType(e){try{return ae.parseEnum(zt,e)}catch{throw new Error(`Unknown layer type: ${e}`)}}static parseOrigin(e){try{return ae.parseEnum(yt,e)}catch{return yt.TopLeft}}static convertOrigin(e){switch(e){case yt.TopLeft:return Rt.TopLeft;case yt.TopCentre:return Rt.TopCentre;case yt.TopRight:return Rt.TopRight;case yt.CentreLeft:return Rt.CentreLeft;case yt.Centre:return Rt.Centre;case yt.CentreRight:return Rt.CentreRight;case yt.BottomLeft:return Rt.BottomLeft;case yt.BottomCentre:return Rt.BottomCentre;case yt.BottomRight:return Rt.BottomRight}return Rt.TopLeft}static parseLoopType(e){try{return ae.parseEnum(bn,e)}catch{return bn.LoopForever}}static _getDepth(e){let t=0;for(const i of e){if(i!==" "&&i!=="_")break;++t}return t}}class po{static handleLine(e,t,i,a){const s=e.split(",").map((l,c)=>c?l.trim():l);switch(Ma.parseEventType(s[0])){case gt.Background:t.events.backgroundPath=s[2].replace(/"/g,"");break;case gt.Break:{const l=ae.parseFloat(s[1])+a,c=Math.max(l,ae.parseFloat(s[2])+a),p=new zs(l,c);t.events.breaks||(t.events.breaks=[]),t.events.breaks.push(p);break}case gt.Video:case gt.Sample:case gt.Sprite:case gt.Animation:case gt.StoryboardCommand:i&&i.push(e)}}}class _o{static handleLine(e,t,i){const[a,...s]=e.split(":"),o=s.join(":").trim();switch(a.trim()){case"AudioFilename":t.general.audioFilename=o;break;case"AudioHash":t.general.audioHash=o;break;case"OverlayPosition":t.general.overlayPosition=o;break;case"SkinPreference":t.general.skinPreference=o;break;case"AudioLeadIn":t.general.audioLeadIn=ae.parseInt(o);break;case"PreviewTime":t.general.previewTime=ae.parseInt(o)+i;break;case"Countdown":t.general.countdown=ae.parseInt(o);break;case"StackLeniency":t.general.stackLeniency=ae.parseFloat(o);break;case"Mode":t.originalMode=ae.parseInt(o);break;case"CountdownOffset":t.general.countdownOffset=ae.parseInt(o);break;case"SampleSet":t.general.sampleSet=qe[o];break;case"LetterboxInBreaks":t.general.letterboxInBreaks=o==="1";break;case"StoryFireInFront":t.general.storyFireInFront=o==="1";break;case"UseSkinSprites":t.general.useSkinSprites=o==="1";break;case"AlwaysShowPlayfield":t.general.alwaysShowPlayfield=o==="1";break;case"EpilepsyWarning":t.general.epilepsyWarning=o==="1";break;case"SpecialStyle":t.general.specialStyle=o==="1";break;case"WidescreenStoryboard":t.general.widescreenStoryboard=o==="1";break;case"SamplesMatchPlaybackRate":t.general.samplesMatchPlaybackRate=o==="1"}}}class go extends kn{constructor(){super(...arguments);m(this,"isNewCombo",!1);m(this,"comboOffset",0)}clone(){const t=super.clone();return t.isNewCombo=this.isNewCombo,t.comboOffset=this.comboOffset,t}}class vo extends kn{constructor(){super(...arguments);m(this,"endTime",0);m(this,"nodeSamples",[])}get duration(){return this.endTime-this.startTime}clone(){const t=super.clone();return t.endTime=this.endTime,t.nestedHitObjects=this.nestedHitObjects.map(i=>i.clone()),t.nodeSamples=this.nodeSamples.map(i=>i.map(a=>a.clone())),t}}const qn=class qn extends kn{constructor(){super(...arguments);m(this,"repeats",0);m(this,"velocity",1);m(this,"path",new ei);m(this,"legacyLastTickOffset",36);m(this,"nodeSamples",[]);m(this,"isNewCombo",!1);m(this,"comboOffset",0)}get duration(){return this.spans*this.spanDuration}get endTime(){return this.startTime+this.duration}get spans(){return this.repeats+1}set spans(t){this.repeats=t-1}get spanDuration(){return this.distance/this.velocity}get distance(){return this.path.distance}set distance(t){this.path.distance=t}applyDefaultsToSelf(t,i){super.applyDefaultsToSelf(t,i);const a=t.timingPointAt(this.startTime),s=t.difficultyPointAt(this.startTime),o=qn.BASE_SCORING_DISTANCE*i.sliderMultiplier*s.sliderVelocity;this.velocity=o/a.beatLength}clone(){const t=super.clone();return t.legacyLastTickOffset=this.legacyLastTickOffset,t.nodeSamples=this.nodeSamples.map(i=>i.map(a=>a.clone())),t.velocity=this.velocity,t.repeats=this.repeats,t.path=this.path.clone(),t.isNewCombo=this.isNewCombo,t.comboOffset=this.comboOffset,t}};m(qn,"BASE_SCORING_DISTANCE",100);let ki=qn;class bo extends kn{constructor(){super(...arguments);m(this,"endTime",0);m(this,"isNewCombo",!1);m(this,"comboOffset",0)}get duration(){return this.endTime-this.startTime}clone(){const t=super.clone();return t.endTime=this.endTime,t.isNewCombo=this.isNewCombo,t.comboOffset=this.comboOffset,t}}let Gt;(function(n){n.Beatmap=".osu",n.Storyboard=".osb",n.Replay=".osr"})(Gt||(Gt={}));let Xt;(function(n){n[n.FileFormat=0]="FileFormat",n[n.Section=1]="Section",n[n.Empty=2]="Empty",n[n.Data=3]="Data",n[n.Break=4]="Break"})(Xt||(Xt={}));let Qe;(function(n){n.General="General",n.Editor="Editor",n.Metadata="Metadata",n.Difficulty="Difficulty",n.Events="Events",n.TimingPoints="TimingPoints",n.Colours="Colours",n.HitObjects="HitObjects",n.Variables="Variables",n.Fonts="Fonts",n.CatchTheBeat="CatchTheBeat",n.Mania="Mania"})(Qe||(Qe={}));const rn=function(){throw new Error("Filesystem operations are not available in a browser environment")};class wo{static encodeColors(e){const t=e.colors;if(Object.keys(t).length===1&&!t.comboColors.length)return"";const i=["[Colours]"];return t.comboColors.forEach((a,s)=>{i.push(`Combo${s+1}:${a}`)}),t.sliderTrackColor&&i.push(`SliderTrackOverride:${t.sliderTrackColor}`),t.sliderBorderColor&&i.push(`SliderBorder:${t.sliderBorderColor}`),i.join(`
`)}}class So{static encodeDifficultySection(e){const t=["[Difficulty]"],i=e.difficulty;return t.push(`HPDrainRate:${i.drainRate}`),t.push(`CircleSize:${i.circleSize}`),t.push(`OverallDifficulty:${i.overallDifficulty}`),t.push(`ApproachRate:${i.approachRate}`),t.push(`SliderMultiplier:${i.sliderMultiplier}`),t.push(`SliderTickRate:${i.sliderTickRate}`),t.join(`
`)}}class yo{static encodeEditorSection(e){const t=["[Editor]"],i=e.editor;return t.push(`Bookmarks:${i.bookmarks.join(",")}`),t.push(`DistanceSpacing:${i.distanceSpacing}`),t.push(`BeatDivisor:${i.beatDivisor}`),t.push(`GridSize:${i.gridSize}`),t.push(`TimelineZoom:${i.timelineZoom}`),t.join(`
`)}}class ta{static encodeEventSection(e){const t=[];return t.push("[Events]"),t.push("//Background and Video events"),t.push(this.encodeVideos(e)),t.push(this.encodeStoryboard(e)),t.join(`
`)}static encodeVideos(e){const t=[],i=e.getLayerByType(zt.Video);return i.elements.length>0&&t.push(this.encodeStoryboardLayer(i)),t.join(`
`)}static encodeStoryboard(e){const t=[];t.push("//Storyboard Layer 0 (Background)");const i=e.getLayerByType(zt.Background);i.elements.length>0&&t.push(this.encodeStoryboardLayer(i)),t.push("//Storyboard Layer 1 (Fail)");const a=e.getLayerByType(zt.Fail);a.elements.length>0&&t.push(this.encodeStoryboardLayer(a)),t.push("//Storyboard Layer 2 (Pass)");const s=e.getLayerByType(zt.Pass);s.elements.length>0&&t.push(this.encodeStoryboardLayer(s)),t.push("//Storyboard Layer 3 (Foreground)");const o=e.getLayerByType(zt.Foreground);o.elements.length>0&&t.push(this.encodeStoryboardLayer(o)),t.push("//Storyboard Layer 4 (Overlay)");const l=e.getLayerByType(zt.Overlay);return l.elements.length>0&&t.push(this.encodeStoryboardLayer(l)),t.join(`
`)}static encodeStoryboardLayer(e){const t=[];return e.elements.forEach(i=>{var s,o,l;t.push(this.encodeStoryboardElement(i,e.name));const a=i;(s=a==null?void 0:a.loops)==null||s.forEach(c=>{c.commands.length>0&&(t.push(this.encodeCompound(c)),t.push(this.encodeTimelineGroup(c,2)))}),((o=a==null?void 0:a.timelineGroup)==null?void 0:o.commands.length)>0&&t.push(this.encodeTimelineGroup(a.timelineGroup)),(l=a==null?void 0:a.triggers)==null||l.forEach(c=>{c.commands.length>0&&(t.push(this.encodeCompound(c)),t.push(this.encodeTimelineGroup(c,2)))})}),t.join(`
`)}static encodeStoryboardElement(e,t){return e instanceof pa?["Animation",t,yt[e.origin],`"${e.filePath}"`,e.startPosition,e.frameCount,e.frameDelay,e.loopType].join(","):e instanceof Bi?["Sprite",t,yt[e.origin],`"${e.filePath}"`,e.startPosition].join(","):e instanceof _a?["Sample",e.startTime,t,`"${e.filePath}"`,e.volume].join(","):e instanceof ga?["Video",e.startTime,e.filePath,"0,0"].join(","):""}static encodeCompound(e,t=1){const i="".padStart(t," ");return e instanceof da?i+[e.type,e.loopStartTime,e.totalIterations].join(","):e instanceof ma?i+[e.type,e.triggerName,e.triggerStartTime,e.triggerEndTime,e.groupNumber].join(","):""}static encodeTimelineGroup(e,t=1){const i="".padStart(t," "),a=[],s=e.commands;let o=!1;for(let l=0;l<s.length;++l){if(o){o=!1;continue}if(l<s.length-1){const c=s[l],p=s[l+1],g=c.type===Ze.MovementX,h=p.type===Ze.MovementY,w=c.easing===p.easing,d=c.startTime===p.startTime,S=c.endTime===p.endTime;if(g&&h&&(w&&d&&S)){a.push(i+this.encodeMoveCommand(c,p)),o=!0;continue}}a.push(i+this.encodeCommand(s[l]))}return a.join(`
`)}static encodeMoveCommand(e,t){const i=[Ze.Movement,e.easing,e.startTime,e.startTime!==e.endTime?e.endTime:"",e.startValue,t.startValue],a=e.startValue===e.endValue,s=t.startValue===t.endValue;return(!a||!s)&&i.push(`${e.endValue},${t.endValue}`),i.join(",")}static encodeCommand(e){return[e.type,e.easing,e.startTime,e.startTime!==e.endTime?e.endTime:"",this._encodeCommandParams(e)].join(",")}static _encodeCommandParams(e){if(e.type===Ze.Parameter)return e.parameter;if(e.type===Ze.Color){const t=o=>`${o.red},${o.green},${o.blue}`,i=e,a=i.startValue,s=i.endValue;return this._areValuesEqual(e)?t(a):t(a)+","+t(s)}return this._areValuesEqual(e)?`${e.startValue}`:`${e.startValue},${e.endValue}`}static _areValuesEqual(e){if(e.type===Ze.VectorScale){const t=e;return t.startValue.equals(t.endValue)}if(e.type===Ze.Color){const t=e;return t.startValue.equals(t.endValue)}return e.startValue===e.endValue}}class Po{static encodeEventSection(e){const t=[],i=e.events;return t.push("[Events]"),t.push("//Background and Video events"),i.backgroundPath&&t.push(`0,0,"${i.backgroundPath}",0,0`),i.storyboard&&t.push(ta.encodeVideos(i.storyboard)),t.push("//Break Periods"),i.breaks&&i.breaks.length>0&&i.breaks.forEach(a=>{t.push(`${gt[gt.Break]},${a.startTime},${a.endTime}`)}),i.storyboard&&t.push(ta.encodeStoryboard(i.storyboard)),t.join(`
`)}}class ko{static encodeGeneralSection(e){const t=["[General]"],i=e.general;return t.push(`AudioFilename:${i.audioFilename}`),t.push(`AudioLeadIn:${i.audioLeadIn}`),i.audioHash&&t.push(`AudioHash:${i.audioHash}`),t.push(`PreviewTime:${i.previewTime}`),t.push(`Countdown:${i.countdown}`),t.push(`SampleSet:${qe[i.sampleSet]}`),t.push(`StackLeniency:${i.stackLeniency}`),t.push(`Mode:${e.mode}`),t.push(`LetterboxInBreaks:${+i.letterboxInBreaks}`),i.storyFireInFront&&t.push(`StoryFireInFront:${+i.storyFireInFront}`),t.push(`UseSkinSprites:${+i.useSkinSprites}`),i.alwaysShowPlayfield&&t.push(`AlwaysShowPlayfield:${+i.alwaysShowPlayfield}`),t.push(`OverlayPosition:${i.overlayPosition}`),t.push(`SkinPreference:${i.skinPreference}`),t.push(`EpilepsyWarning:${+i.epilepsyWarning}`),t.push(`CountdownOffset:${i.countdownOffset}`),t.push(`SpecialStyle:${+i.specialStyle}`),t.push(`WidescreenStoryboard:${+i.widescreenStoryboard}`),t.push(`SamplesMatchPlaybackRate:${+i.samplesMatchPlaybackRate}`),t.join(`
`)}}class Mo{static encodeHitObjects(e){const t=["[HitObjects]"];return e.difficulty,e.hitObjects.forEach(a=>{const s=[],l=a.startPosition,c=new Le(l?l.x:256,l?l.y:192);s.push(c.toString()),s.push(a.startTime.toString()),s.push(a.hitType.toString()),s.push(a.hitSound.toString());const p=[];if(a.hitType&nt.Slider){const b=a;p.push(this.encodePathData(b,c))}else if(a.hitType&nt.Spinner){const b=a;p.push(this.encodeEndTimeData(b))}else if(a.hitType&nt.Hold){const b=a;p.push(this.encodeEndTimeData(b))}const g=[],h=a.samples.find(b=>b.hitSound===rt[rt.Normal]),w=a.samples.find(b=>b.hitSound!==rt[rt.Normal]);let d=qe.None,S=qe.None;h&&(d=qe[h.sampleSet]),w&&(S=qe[w.sampleSet]),g[0]=d.toString(),g[1]=S.toString(),g[2]=a.samples[0].customIndex.toString(),g[3]=a.samples[0].volume.toString(),g[4]=a.samples[0].filename,p.push(g.join(":"));const v=s.join(","),y=a.hitType&nt.Hold?p.join(":"):p.join(",");t.push([v,y].join(","))}),t.join(`
`)}static encodePathData(e,t){const i=[];let a;e.path.controlPoints.forEach((c,p)=>{if(c.type!==null){let g=c.type!==a||c.type===Pt.PerfectCurve;if(p>1){const h=t.add(e.path.controlPoints[p-1].position),w=t.add(e.path.controlPoints[p-2].position);~~h.x===~~w.x&&~~h.y===~~w.y&&(g=!0)}g?(i.push(e.path.curveType),a=c.type):i.push(`${t.x+c.position.x}:${t.y+c.position.y}`)}p!==0&&i.push(`${t.x+c.position.x}:${t.y+c.position.y}`)});const s=[];s.push(i.join("|")),s.push((e.repeats+1).toString()),s.push(e.distance.toString());const o=[],l=[];return e.nodeSamples.forEach((c,p)=>{o[p]=rt.None,l[p]=[qe.None,qe.None],c.forEach((g,h)=>{h===0?l[p][0]=qe[g.sampleSet]:(o[p]|=rt[g.hitSound],l[p][1]=qe[g.sampleSet])})}),s.push(o.join("|")),s.push(l.map(c=>c.join(":")).join("|")),s.join(",")}static encodeEndTimeData(e){return e.endTime.toString()}}class To{static encodeMetadataSection(e){const t=["[Metadata]"],i=e.metadata;return t.push(`Title:${i.title}`),t.push(`TitleUnicode:${i.titleUnicode}`),t.push(`Artist:${i.artist}`),t.push(`ArtistUnicode:${i.artistUnicode}`),t.push(`Creator:${i.creator}`),t.push(`Version:${i.version}`),t.push(`Source:${i.source}`),t.push(`Tags:${i.tags.join(" ")}`),t.push(`BeatmapID:${i.beatmapId}`),t.push(`BeatmapSetID:${i.beatmapSetId}`),t.join(`
`)}}class Gn{static encodeControlPoints(e){const t=["[TimingPoints]"];return e.controlPoints.groups.forEach(i=>{i.controlPoints.find(o=>o.beatLength)&&t.push(this.encodeGroup(i,!0)),t.push(this.encodeGroup(i))}),t.join(`
`)}static encodeGroup(e,t=!1){const{difficultyPoint:i,effectPoint:a,samplePoint:s,timingPoint:o}=this.updateActualPoints(e),l=e.startTime;let c=-100;i!==null&&(c/=i.sliderVelocity);let p=qe.None,g=0,h=100;s!==null&&(p=qe[s.sampleSet],g=s.customIndex,h=s.volume);let w=tr.None;if(a!==null){const v=a.kiai?tr.Kiai:tr.None,y=a.omitFirstBarLine?tr.OmitFirstBarLine:tr.None;w|=v|y}let d=Sn.SimpleQuadruple,S=0;return t&&o!==null&&(c=o.beatLength,d=o.timeSignature,S=1),[l,c,d,p,g,h,S,w].join(",")}static updateActualPoints(e){let t=null;return e.controlPoints.forEach(i=>{i.pointType===ot.DifficultyPoint&&!i.isRedundant(this.lastDifficultyPoint)&&(this.lastDifficultyPoint=i),i.pointType===ot.EffectPoint&&!i.isRedundant(this.lastEffectPoint)&&(this.lastEffectPoint=i),i.pointType===ot.SamplePoint&&!i.isRedundant(this.lastSamplePoint)&&(this.lastSamplePoint=i),i.pointType===ot.TimingPoint&&(t=i)}),{timingPoint:t,difficultyPoint:this.lastDifficultyPoint,effectPoint:this.lastEffectPoint,samplePoint:this.lastSamplePoint}}}m(Gn,"lastDifficultyPoint",null),m(Gn,"lastEffectPoint",null),m(Gn,"lastSamplePoint",null);const Eo=new TextDecoder;function Mi(n){return typeof n=="string"?n:Eo.decode(n)}const Qn=class Qn{async encodeToPath(e,t){e.endsWith(Gt.Beatmap)||(e+=Gt.Beatmap);try{await rn(rn(e),{recursive:!0}),await rn(e,await this.encodeToString(t))}catch(i){const a=i.message||i;throw new Error(`Failed to encode a beatmap: ${a}`)}}encodeToString(e){return e!=null&&e.fileFormat?[`osu file format v${e.fileFormat??Qn.FIRST_LAZER_VERSION}`,ko.encodeGeneralSection(e),yo.encodeEditorSection(e),To.encodeMetadataSection(e),So.encodeDifficultySection(e),Po.encodeEventSection(e),Gn.encodeControlPoints(e),wo.encodeColors(e),Mo.encodeHitObjects(e)].join(`

`)+`
`:""}};m(Qn,"FIRST_LAZER_VERSION",128);let Ti=Qn;class Ei{static handleLine(e,t,i){const a=e.split(",").map(c=>c.trim()),s=ae.parseInt(a[3]),o=this.createHitObject(s);o.startX=ae.parseInt(a[0],ae.MAX_COORDINATE_VALUE),o.startY=ae.parseInt(a[1],ae.MAX_COORDINATE_VALUE),o.startTime=ae.parseFloat(a[2])+i,o.hitType=s,o.hitSound=ae.parseInt(a[4]);const l=new Ni;this.addExtras(a.slice(5),o,l,i,t.fileFormat),this.addComboOffset(o,t),o.samples.length===0&&(o.samples=this.convertSoundType(o.hitSound,l)),t.hitObjects.push(o)}static addComboOffset(e,t){const i=t.originalMode===0,a=t.originalMode===2;if(!i&&!a)return;const s=e,o=Math.trunc((e.hitType&nt.ComboOffset)>>4),l=!!(e.hitType&nt.NewCombo);(e.hitType&nt.Normal||e.hitType&nt.Slider)&&(s.isNewCombo=l||this._forceNewCombo,s.comboOffset=o+this._extraComboOffset,this._forceNewCombo=!1,this._extraComboOffset=0),e.hitType&nt.Spinner&&(this._forceNewCombo=t.fileFormat<=8||l||!1,this._extraComboOffset+=o)}static addExtras(e,t,i,a,s){if(t.hitType&nt.Normal&&e.length>0&&this.readCustomSampleBanks(e[0],i),t.hitType&nt.Slider)return this.addSliderExtras(e,t,i,s);if(t.hitType&nt.Spinner)return this.addSpinnerExtras(e,t,i,a);if(t.hitType&nt.Hold)return this.addHoldExtras(e,t,i,a)}static addSliderExtras(e,t,i,a){const s=e[0],o=t.startPosition,l=ae.parseInt(e[1]);if(t.repeats>9e3)throw new Error("Repeat count is way too high");if(t.repeats=Math.max(0,l-1),t.path.controlPoints=this.convertPathString(s,o,a),t.path.curveType=t.path.controlPoints[0].type,e.length>2){const c=ae.parseFloat(e[2],ae.MAX_COORDINATE_VALUE);t.path.expectedDistance=Math.max(0,c)}e.length>5&&this.readCustomSampleBanks(e[5],i),t.samples=this.convertSoundType(t.hitSound,i),t.nodeSamples=this.getSliderNodeSamples(e,t,i)}static addSpinnerExtras(e,t,i,a){t.endTime=ae.parseInt(e[0])+a,e.length>1&&this.readCustomSampleBanks(e[1],i)}static addHoldExtras(e,t,i,a){if(t.endTime=t.startTime,e.length>0&&e[0]){const s=e[0].split(":");t.endTime=Math.max(t.endTime,ae.parseFloat(s[0]))+a,this.readCustomSampleBanks(s.slice(1).join(":"),i)}}static getSliderNodeSamples(e,t,i){const a=t.repeats+2,s=[];for(let c=0;c<a;++c)s.push(i.clone());if(e.length>4&&e[4].length>0){const c=e[4].split("|");for(let p=0;p<a&&!(p>=c.length);++p)this.readCustomSampleBanks(c[p],s[p])}const o=[];for(let c=0;c<a;++c)o.push(t.hitSound);if(e.length>3&&e[3].length>0){const c=e[3].split("|");for(let p=0;p<a&&!(p>=c.length);++p)o[p]=parseInt(c[p])||rt.None}const l=[];for(let c=0;c<a;c++)l.push(this.convertSoundType(o[c],s[c]));return l}static convertPathString(e,t,i){const a=e.split("|").map(p=>p.trim()),s=[];let o=0,l=0,c=!0;for(;++l<a.length;){if(a[l].length>1)continue;const p=a.slice(o,l),g=l<a.length-1?a[l+1]:null,h=this.convertPoints(p,g,c,t,i);for(const w of h)s.push(...w);o=l,c=!1}if(l>o){const p=a.slice(o,l),g=this.convertPoints(p,null,c,t,i);for(const h of g)s.push(...h)}return s}static*convertPoints(e,t,i,a,s){const o=i?1:0,l=t!==null?1:0,c=[];o===1&&(c[0]=new Pi);for(let S=1;S<e.length;++S)c[o+S-1]=w(e[S],a);t!==null&&(c[c.length-1]=w(t,a));let p=this.convertPathType(e[0]);p===Pt.PerfectCurve&&(c.length!==3?p=Pt.Bezier:d(c)&&(p=Pt.Linear)),c[0].type=p;let g=0,h=0;for(;++h<c.length-l;){if(!c[h].position.equals(c[h-1].position))continue;const S=s<Ti.FIRST_LAZER_VERSION;p===Pt.Catmull&&h>1&&S||h!==c.length-l-1&&(c[h-1].type=p,yield c.slice(g,h),g=h+1)}h>g&&(yield c.slice(g,h));function w(S,v){const y=S.split(":").map(M=>Math.trunc(ae.parseFloat(M,ae.MAX_COORDINATE_VALUE))),b=new Le(y[0],y[1]).fsubtract(v);return new Pi(b)}function d(S){const v=(S[1].position.y-S[0].position.y)*(S[2].position.x-S[0].position.x),y=(S[1].position.x-S[0].position.x)*(S[2].position.y-S[0].position.y);return Math.abs(v-y)<.001}}static convertPathType(e){switch(e){default:case"C":return Pt.Catmull;case"B":return Pt.Bezier;case"L":return Pt.Linear;case"P":return Pt.PerfectCurve}}static readCustomSampleBanks(e,t){if(!e)return;const i=e.split(":");t.normalSet=ae.parseInt(i[0]),t.additionSet=ae.parseInt(i[1]),t.additionSet===qe.None&&(t.additionSet=t.normalSet),i.length>2&&(t.customIndex=ae.parseInt(i[2])),i.length>3&&(t.volume=Math.max(0,ae.parseInt(i[3]))),t.filename=i.length>4?i[4]:""}static convertSoundType(e,t){if(t.filename){const a=new Br;return a.filename=t.filename,a.volume=t.volume,[a]}const i=[new Br];if(i[0].hitSound=rt[rt.Normal],i[0].sampleSet=qe[t.normalSet],i[0].isLayered=e!==rt.None&&!(e&rt.Normal),e&rt.Finish){const a=new Br;a.hitSound=rt[rt.Finish],i.push(a)}if(e&rt.Whistle){const a=new Br;a.hitSound=rt[rt.Whistle],i.push(a)}if(e&rt.Clap){const a=new Br;a.hitSound=rt[rt.Clap],i.push(a)}return i.forEach((a,s)=>{a.sampleSet=s!==0?qe[t.additionSet]:qe[t.normalSet],a.volume=t.volume,a.customIndex=0,t.customIndex>=2&&(a.customIndex=t.customIndex)}),i}static createHitObject(e){if(e&nt.Normal)return new go;if(e&nt.Slider)return new ki;if(e&nt.Spinner)return new bo;if(e&nt.Hold)return new vo;throw new Error(`Unknown hit object type: ${e}!`)}}m(Ei,"_forceNewCombo",!1),m(Ei,"_extraComboOffset",0);class Io{static handleLine(e,t){const[i,...a]=e.split(":"),s=a.join(":").trim();switch(i.trim()){case"Title":t.metadata.title=s;break;case"TitleUnicode":t.metadata.titleUnicode=s;break;case"Artist":t.metadata.artist=s;break;case"ArtistUnicode":t.metadata.artistUnicode=s;break;case"Creator":t.metadata.creator=s;break;case"Version":t.metadata.version=s;break;case"Source":t.metadata.source=s;break;case"Tags":t.metadata.tags=s.split(" ");break;case"BeatmapID":t.metadata.beatmapId=ae.parseInt(s);break;case"BeatmapSetID":t.metadata.beatmapSetId=ae.parseInt(s)}}}class Qr{static handleLine(e,t,i){this.controlPoints=t.controlPoints;const a=e.split(",");let s=Sn.SimpleQuadruple,o=qe[qe.None],l=0,c=100,p=!0,g=tr.None;if(a.length>2)switch(a.length){default:case 8:g=ae.parseInt(a[7]);case 7:p=a[6]==="1";case 6:c=ae.parseInt(a[5]);case 5:l=ae.parseInt(a[4]);case 4:o=qe[ae.parseInt(a[3])];case 3:s=ae.parseInt(a[2])}if(s<1)throw new Error("The numerator of a time signature must be positive.");const h=ae.parseFloat(a[0])+i,w=ae.parseFloat(a[1],ae.MAX_PARSE_VALUE,!0);let d=1,S=1;if(w<0&&(S=100/-w,d=Math.min(Math.fround(-w),1e4),d=Math.max(10,d)/100),p&&Number.isNaN(w))throw new Error("Beat length cannot be NaN in a timing control point");if(p){const M=new zr;M.beatLength=w,M.timeSignature=s,this.addControlPoint(M,h,!0)}const v=new Vn;v.bpmMultiplier=d,v.sliderVelocity=S,v.generateTicks=!Number.isNaN(w),v.isLegacy=!0,this.addControlPoint(v,h,p);const y=new Wn;y.kiai=(g&tr.Kiai)>0,y.omitFirstBarLine=(g&tr.OmitFirstBarLine)>0,(t.originalMode===1||t.originalMode===3)&&(y.scrollSpeed=S),this.addControlPoint(y,h,p);const b=new Yn;b.sampleSet=o,b.customIndex=l,b.volume=c,this.addControlPoint(b,h,p)}static addControlPoint(e,t,i){t!==this.pendingTime&&this.flushPendingPoints(),i?this.pendingPoints.unshift(e):this.pendingPoints.push(e),this.pendingTime=t}static flushPendingPoints(){const e=this.pendingTime,t=this.pendingPoints,i=this.controlPoints,a=this.pendingTypes;let s=t.length;for(;--s>=0;)a.includes(t[s].pointType)||(a.push(t[s].pointType),i.add(t[s],e));this.pendingPoints=[],this.pendingTypes=[]}}m(Qr,"pendingTime",0),m(Qr,"pendingTypes",[]),m(Qr,"pendingPoints",[]),m(Qr,"controlPoints");class Do{static handleLine(e,t){const[i,...a]=e.split(":").map(o=>o.trim()),s=a.join(" ");switch(i){case"UseSkinSprites":t.useSkinSprites=s==="1"}}}class ra{static handleLine(e,t){if(!e.startsWith("$"))return;const i=e.split("=");i.length===2&&t.set(i[0],i[1].trimEnd())}static decodeVariables(e,t){return!e.includes("$")||!t.size||t.forEach((i,a)=>{e=e.replace(a,i)}),e}}class xo{async _getFileBuffer(e){try{await rn(e)}catch{throw new Error("File doesn't exist!")}try{return await rn(e)}catch{throw new Error("File can't be read!")}}async _getFileUpdateDate(e){try{return(await rn(e)).mtime}catch{throw new Error("Failed to get last file update date!")}}}class Ao extends Map{constructor(){super(...arguments);m(this,"currentSection",null)}get(t){return super.get(t)??!1}set(t,i=!0){return super.set(t,i)}reset(){return this.forEach((t,i,a)=>{a.set(i,!0)}),this.currentSection=null,this}get hasEnabledSections(){for(const t of this.values())if(t)return!0;return!1}get isSectionEnabled(){return this.currentSection?this.get(this.currentSection):!1}}class Ta extends xo{constructor(){super(...arguments);m(this,"_lines",null);m(this,"_foundFirstNonEmptyLine",!1);m(this,"_sectionMap",new Ao)}_getLines(t){let i=null;if(t.constructor===Array&&(i=t),!i||!i.length)throw new Error("Data not found!");return i}_parseLine(t,i){if(!this._foundFirstNonEmptyLine&&t.includes("osu file format v")){const a=t.trim();try{return a.startsWith("osu file format v")&&(i.fileFormat=ae.parseInt(a.split("v")[1])),Xt.FileFormat}catch{throw new Error("Wrong file format version!")}}if(!this._foundFirstNonEmptyLine&&!this._isEmptyLine(t)&&(this._foundFirstNonEmptyLine=!0),this._shouldSkipLine(t))return Xt.Empty;if(t=this._preprocessLine(t),t.startsWith("[")&&t.endsWith("]")){const a=t.slice(1,-1);return this._sectionMap.currentSection&&(this._sectionMap.set(this._sectionMap.currentSection,!1),this._sectionMap.currentSection=null),this._sectionMap.hasEnabledSections?(a in Qe&&(this._sectionMap.currentSection=a),Xt.Section):Xt.Break}if(!this._sectionMap.isSectionEnabled)return Xt.Empty;try{return this._parseSectionData(t,i),Xt.Data}catch{return Xt.Empty}}_parseSectionData(t,i){const a=i;this._sectionMap.currentSection===Qe.Colours&&a!=null&&a.colors&&fo.handleLine(t,a)}_preprocessLine(t){return this._sectionMap.currentSection!==Qe.Metadata&&(t=this._stripComments(t)),t.trimEnd()}_shouldSkipLine(t){return this._isEmptyLine(t)||t.startsWith("//")}_isEmptyLine(t){return typeof t!="string"||!t}_stripComments(t){const i=t.indexOf("//");return i>0?t.substring(0,i):t}_reset(){this._sectionMap.reset(),this._lines=null,this._foundFirstNonEmptyLine=!1}_setEnabledSections(t){this._sectionMap.set(Qe.Colours,t==null?void 0:t.parseColours)}}class Bo extends Ta{constructor(){super(...arguments);m(this,"_variables",new Map)}async decodeFromPath(t,i){if(!t.endsWith(Gt.Beatmap)&&!t.endsWith(Gt.Storyboard))throw new Error(`Wrong format of the first file! Only ${Gt.Beatmap} and ${Gt.Storyboard} files are supported!`);if(typeof i=="string"&&!i.endsWith(Gt.Storyboard))throw new Error(`Wrong format of the second file! Only ${Gt.Storyboard} files are supported as a second argument!`);try{const a=await this._getFileBuffer(t),s=typeof i=="string"?await this._getFileBuffer(t):void 0;return this.decodeFromBuffer(a,s)}catch(a){const s=a.message||a;throw new Error(`Failed to decode a storyboard: '${s}'`)}}decodeFromBuffer(t,i){const a=Mi(t),s=i?Mi(i):void 0;return this.decodeFromString(a,s)}decodeFromString(t,i){typeof t!="string"&&(t=String(t)),typeof i!="string"&&typeof i<"u"&&(i=String(i));const a=t.split(/\r?\n/),s=i==null?void 0:i.split(/\r?\n/);return this.decodeFromLines(a,s)}decodeFromLines(t,i){const a=new As;this._reset(),this._setEnabledSections(),this._lines=[...this._getLines(t),...i?this._getLines(i):[]];for(let s=0;s<this._lines.length&&this._parseLine(this._lines[s],a)!==Xt.Break;++s);return a.variables=this._variables,a}_parseSectionData(t,i){switch(this._sectionMap.currentSection){case Qe.General:return Do.handleLine(t,i);case Qe.Events:return Ma.handleLine(t,i);case Qe.Variables:return ra.handleLine(t,this._variables)}super._parseSectionData(t,i)}_setEnabledSections(){super._setEnabledSections(),this._sectionMap.set(Qe.General),this._sectionMap.set(Qe.Variables),this._sectionMap.set(Qe.Events)}_preprocessLine(t){return t=ra.decodeVariables(t,this._variables),super._preprocessLine(t)}_reset(){super._reset(),this._sectionMap.currentSection=Qe.Events}}class Ii extends Ta{constructor(){super(...arguments);m(this,"_offset",0);m(this,"_sbLines",null)}async decodeFromPath(t,i){if(!t.endsWith(Gt.Beatmap))throw new Error(`Wrong file format! Only ${Gt.Beatmap} files are supported!`);try{const a=await this._getFileBuffer(t),s=this.decodeFromBuffer(a,i);return s.fileUpdateDate=await this._getFileUpdateDate(t),s}catch(a){const s=a.message||a;throw new Error(`Failed to decode a beatmap: ${s}`)}}decodeFromBuffer(t,i){return this.decodeFromString(Mi(t),i)}decodeFromString(t,i){return t=typeof t!="string"?String(t):t,this.decodeFromLines(t.split(/\r?\n/),i)}decodeFromLines(t,i){const a=new wa;this._reset(),this._lines=this._getLines(t),this._setEnabledSections(typeof i!="boolean"?i:{}),this._sbLines=this._shouldParseStoryboard(i)?[]:null;for(let s=0;s<this._lines.length&&this._parseLine(this._lines[s],a)!==Xt.Break;++s);Qr.flushPendingPoints();for(let s=0;s<a.hitObjects.length;++s)a.hitObjects[s].applyDefaults(a.controlPoints,a.difficulty);if(a.hitObjects.sort((s,o)=>s.startTime-o.startTime),this._sbLines&&this._sbLines.length){const s=new Bo;a.events.storyboard=s.decodeFromLines(this._sbLines),a.events.storyboard.useSkinSprites=a.general.useSkinSprites,a.events.storyboard.colors=a.colors,a.events.storyboard.fileFormat=a.fileFormat}return a}_parseSectionData(t,i){switch(this._sectionMap.currentSection){case Qe.General:return _o.handleLine(t,i,this._offset);case Qe.Editor:return mo.handleLine(t,i);case Qe.Metadata:return Io.handleLine(t,i);case Qe.Difficulty:return ho.handleLine(t,i);case Qe.Events:return po.handleLine(t,i,this._sbLines,this._offset);case Qe.TimingPoints:return Qr.handleLine(t,i,this._offset);case Qe.HitObjects:return Ei.handleLine(t,i,this._offset)}super._parseSectionData(t,i)}_setEnabledSections(t){super._setEnabledSections(t),this._sectionMap.set(Qe.General,t==null?void 0:t.parseGeneral),this._sectionMap.set(Qe.Editor,t==null?void 0:t.parseEditor),this._sectionMap.set(Qe.Metadata,t==null?void 0:t.parseMetadata),this._sectionMap.set(Qe.Difficulty,t==null?void 0:t.parseDifficulty),this._sectionMap.set(Qe.Events,t==null?void 0:t.parseEvents),this._sectionMap.set(Qe.TimingPoints,t==null?void 0:t.parseTimingPoints),this._sectionMap.set(Qe.HitObjects,t==null?void 0:t.parseHitObjects)}_shouldParseStoryboard(t){const i=t,a=(i==null?void 0:i.parseStoryboard)??t,s=typeof a=="boolean"?a:!0;return((i==null?void 0:i.parseEvents)??!0)&&s}}m(Ii,"EARLY_VERSION_TIMING_OFFSET",24);class Lo extends ro{}class Ea extends to{}class Ia extends qs{}class Da{constructor(){this.name="Touch Device",this.acronym="TD",this.bitwise=de.TouchDevice,this.type=pt.System,this.multiplier=1,this.isRanked=!0,this.incompatibles=de.None}}class rr extends $s{applyToBeatmap(e){for(const t of e.hitObjects)this._applyFadeAdjustments(t)}_applyFadeAdjustments(e){e.timeFadeIn=e.timePreempt*rr.FADE_IN_DURATION_MULTIPLIER;for(const t of e.nestedHitObjects)this._applyFadeAdjustments(t)}}rr.FADE_IN_DURATION_MULTIPLIER=.4;rr.FADE_OUT_DURATION_MULTIPLIER=.3;class nr extends Xn{isHitResultAllowed(e){switch(e){case Ie.Great:case Ie.Ok:case Ie.Meh:case Ie.Miss:return!0}return!1}_getRanges(){return nr.OSU_RANGES}}nr.OSU_RANGES=[new xt(Ie.Great,80,50,20),new xt(Ie.Ok,140,100,60),new xt(Ie.Meh,200,150,100),new xt(Ie.Miss,400,400,400)];class Ft extends kn{constructor(){super(...arguments),this.timePreempt=600,this.timeFadeIn=400,this._scale=.5,this._stackHeight=0,this._stackOffset=new Le(0,0),this.currentComboIndex=0,this.comboIndex=0,this.comboIndexWithOffsets=0,this.comboOffset=0,this.lastInCombo=!1,this.isNewCombo=!1,this.hitWindows=new nr}get endPosition(){return this.startPosition}get endX(){return this.endPosition.x}set endX(e){this.endPosition.x=e}get endY(){return this.endPosition.y}set endY(e){this.endPosition.y=e}get scale(){return this._scale}set scale(e){this._scale=e;const t=Math.fround(Math.fround(this._stackHeight*this._scale)*Math.fround(-6.4));this._stackOffset.x=this._stackOffset.y=t}get radius(){return Ft.OBJECT_RADIUS*this._scale}get stackHeight(){return this._stackHeight}set stackHeight(e){this._stackHeight=e;const t=Math.fround(Math.fround(this._stackHeight*this._scale)*Math.fround(-6.4));this._stackOffset.x=this._stackOffset.y=t,this.nestedHitObjects.forEach(i=>{i.stackHeight=this._stackHeight})}get stackedOffset(){return this._stackOffset}set stackedOffset(e){this._stackOffset=e}get stackedStartPosition(){return this.startPosition.fadd(this.stackedOffset)}get stackedEndPosition(){return this.endPosition.fadd(this.stackedOffset)}applyDefaultsToSelf(e,t){super.applyDefaultsToSelf(e,t),this.timePreempt=Math.fround(vn.range(t.approachRate,1800,1200,450)),this.timeFadeIn=400*Math.min(1,this.timePreempt/Ft.PREEMPT_MIN);const i=Math.fround(Math.fround(.7)*Math.fround(t.circleSize-5));this.scale=Math.fround(Math.fround(1-Math.fround(i/5))/2)}clone(){const e=super.clone();return e.stackHeight=this.stackHeight,e.scale=this.scale,e.currentComboIndex=this.currentComboIndex,e.comboIndex=this.comboIndex,e.comboIndexWithOffsets=this.comboIndexWithOffsets,e.comboOffset=this.comboOffset,e.lastInCombo=this.lastInCombo,e}}Ft.OBJECT_RADIUS=64;Ft.BASE_SCORING_DISTANCE=100;Ft.PREEMPT_MIN=450;class jr extends Ft{}class xa extends jr{}class Aa extends Ft{constructor(){super(...arguments),this.spanIndex=0,this.spanStartTime=0,this.hitWindows=nr.empty}applyDefaultsToSelf(e,t){super.applyDefaultsToSelf(e,t);const i=this.spanIndex>0?200:this.timePreempt*Math.fround(.66);this.timePreempt=(this.startTime-this.spanStartTime)/2+i}clone(){const e=super.clone();return e.spanIndex=this.spanIndex,e.spanStartTime=this.spanStartTime,e}}class Ba extends jr{constructor(e){super(),this.repeatIndex=0,this.hitWindows=nr.empty,this._slider=e}get spanDuration(){return this._slider.spanDuration}applyDefaultsToSelf(e,t){if(super.applyDefaultsToSelf(e,t),this.repeatIndex>0){this.timeFadeIn=0,this.timePreempt=this.spanDuration*2;return}const i=Math.fround(2/3);this.timePreempt=this.startTime-this._slider.startTime+this._slider.timePreempt*i}}class zi extends Ba{}class La extends Ba{}class Ra extends Ft{constructor(){super(...arguments),this.hitWindows=nr.empty}}class Ro extends Ra{}class Oa extends yi{static*generateSliderTicks(e){for(const t of yi.generate(e)){const i=e.path.positionAt(t.progress);switch(t.eventType){case Zt.Head:{const a=new xa;a.startPosition=e.startPosition,a.startTime=t.startTime,yield a;break}case Zt.Repeat:{const a=new zi(e);a.repeatIndex=t.spanIndex,a.startTime=t.startTime,a.startPosition=e.startPosition.fadd(i),a.scale=e.scale,yield a;break}case Zt.LegacyLastTick:{const a=new La(e);a.repeatIndex=t.spanIndex,a.startTime=t.startTime,a.startPosition=e.endPosition,yield a;break}case Zt.Tick:{const a=new Aa;a.spanIndex=t.spanIndex,a.spanStartTime=t.spanStartTime,a.startTime=t.startTime,a.startPosition=e.startPosition.fadd(i),a.scale=e.scale,yield a}}}}static*generateSpinnerTicks(e){const t=e.maximumBonusSpins+e.spinsRequired;for(let i=0;i<t;++i){const a=i<e.spinsRequired?new Ra:new Ro;a.startTime=e.startTime+(i+1/t)*e.duration,yield a}}}class ht extends Ft{constructor(){super(...arguments),this.tickDistance=0,this.tickRate=1,this.velocity=1,this.lazyTravelDistance=0,this.lazyTravelTime=0,this.hitWindows=nr.empty,this.path=new ei,this.nodeSamples=[],this.repeats=0,this.startPosition=new Le(0,0)}get startX(){return this._updateHeadPosition(),this.startPosition.floatX}set startX(e){this.startPosition.x=e,this._updateHeadPosition()}get startY(){return this._updateHeadPosition(),this.startPosition.floatY}set startY(e){this.startPosition.y=e,this._updateHeadPosition()}get endX(){return this._updateTailPosition(),this.endPosition.floatX}set endX(e){this.endPosition.x=e,this._updateTailPosition()}get endY(){return this._updateTailPosition(),this.endPosition.floatY}set endY(e){this.endPosition.y=e,this._updateTailPosition()}get head(){return this.nestedHitObjects.find(t=>t instanceof xa)||null}get tail(){return this.nestedHitObjects.find(t=>t instanceof La)||null}get distance(){return this.path.distance}set distance(e){this.path.distance=e}get spans(){return this.repeats+1}get spanDuration(){return this.duration/this.spans}get duration(){return this.endTime-this.startTime}get endPosition(){const e=this.path.curvePositionAt(1,this.spans);if(isFinite(e.x)&&isFinite(e.y))return this.startPosition.fadd(e);const t=this.path.controlPoints;return t.length?t[t.length-1].position:this.startPosition}get endTime(){return this.startTime+this.spans*this.distance/this.velocity}applyDefaultsToSelf(e,t){super.applyDefaultsToSelf(e,t);const i=e.timingPointAt(this.startTime),a=e.difficultyPointAt(this.startTime),s=Ft.BASE_SCORING_DISTANCE*t.sliderMultiplier*a.sliderVelocity,o=a.generateTicks;this.velocity=s/i.beatLength,this.tickDistance=o?s/t.sliderTickRate*this.tickRate:1/0}createNestedHitObjects(){this.nestedHitObjects=[];for(const e of Oa.generateSliderTicks(this))this.nestedHitObjects.push(e)}_updateHeadPosition(){this.head!==null&&(this.head.startPosition=this.startPosition)}_updateTailPosition(){this.tail!==null&&(this.tail.startPosition=this.endPosition)}clone(){const e=super.clone();return e.nodeSamples=this.nodeSamples.map(t=>t.map(i=>i.clone())),e.velocity=this.velocity,e.repeats=this.repeats,e.path=this.path.clone(),e.tickDistance=this.tickDistance,e.tickRate=this.tickRate,e.legacyLastTickOffset=this.legacyLastTickOffset,e}}class at extends Ft{constructor(){super(...arguments),this.spinsRequired=1,this.maximumBonusSpins=1,this.endTime=0,this.hitWindows=nr.empty}get duration(){return this.endTime-this.startTime}applyDefaultsToSelf(e,t){super.applyDefaultsToSelf(e,t);const i=this.duration/1e3,a=at.STABLE_MATCHING_FUDGE*vn.range(t.overallDifficulty,3,5,7.5),s=at.MAXIMUM_ROTATIONS-a;this.spinsRequired=Math.trunc(i*a),this.maximumBonusSpins=Math.trunc(i*s)}createNestedHitObjects(){this.nestedHitObjects=[];for(const e of Oa.generateSpinnerTicks(this))this.nestedHitObjects.push(e)}clone(){const e=super.clone();return e.endTime=this.endTime,e.spinsRequired=this.spinsRequired,e.maximumBonusSpins=this.maximumBonusSpins,e}}at.STABLE_MATCHING_FUDGE=.6;at.MAXIMUM_ROTATIONS=8;class Ur extends Cs{applyToHitObjects(e){e.forEach(t=>{Ur._reflectVertically(t)})}static _reflectVertically(e){if(e.startY=Ur.BASE_SIZE.y-e.startY,!(e instanceof ht))return;const t=e;t.nestedHitObjects.forEach(a=>{(a instanceof Aa||a instanceof zi)&&(a.startY=Ur.BASE_SIZE.y-a.startY)}),t.path.controlPoints.forEach(a=>{a.position.y*=-1}),t.path.invalidate(),t.endY=t.endPosition.y}}Ur.BASE_SIZE=new Le(512,384);class Oo extends ao{}class Fa extends ya{}class Jr extends io{}class Na extends Js{}class Fo extends eo{}class yn extends Qs{}class No extends Zs{}class za{constructor(){this.name="Spun Out",this.acronym="SO",this.bitwise=de.SpunOut,this.type=pt.Automation,this.multiplier=.9,this.isRanked=!0,this.incompatibles=de.Autoplay|de.Cinema|de.Relax2}}class zo{constructor(){this.name="Autopilot",this.acronym="AP",this.bitwise=de.Relax2,this.type=pt.Automation,this.multiplier=1,this.isRanked=!1,this.incompatibles=de.NoFail|de.SuddenDeath|de.Perfect|de.Autoplay|de.Cinema|de.Relax|de.SpunOut}}class Uo extends no{}class jo extends Ks{}class Kn extends so{get mode(){return 0}get _availableMods(){return[new Lo,new Ea,new Ia,new Da,new rr,new Ur,new Oo,new Fa,new Jr,new Na,new Fo,new yn,new No,new za,new zo,new Uo,new jo]}}class Go extends Us{constructor(){super(...arguments),this.mods=new Kn,this.hitObjects=[]}get mode(){return 0}get maxCombo(){return this.hitObjects.reduce((e,t)=>t instanceof jr?e+1:t instanceof ht?e+t.nestedHitObjects.length:t instanceof at?e+1:e,0)}get circles(){return this.hitObjects.filter(e=>e instanceof jr)}get sliders(){return this.hitObjects.filter(e=>e instanceof ht)}get spinners(){return this.hitObjects.filter(e=>e instanceof at)}}class Ho extends Fs{canConvert(e){return e.hitObjects.every(t=>t.startPosition)}*convertHitObjects(e){const t=e.hitObjects;for(const i of t){if(i instanceof Ft){yield i.clone();continue}yield this._convertHitObject(i,e)}}_convertHitObject(e,t){const i=e,a=e;return i.path?this._convertSlider(i,t):typeof a.endTime=="number"?this._convertSpinner(a):this._convertCircle(e)}_convertCircle(e){const t=new jr;return this._copyProperties(t,e),t}_convertSlider(e,t){var i;const a=new ht;if(this._copyProperties(a,e),a.repeats=e.repeats,a.nodeSamples=e.nodeSamples,a.path=e.path,a.legacyLastTickOffset=(i=e==null?void 0:e.legacyLastTickOffset)!==null&&i!==void 0?i:0,a.tickRate=1,t.fileFormat<8){const s=t.controlPoints.difficultyPointAt(e.startTime);a.tickRate=Math.fround(1/s.sliderVelocity)}return a}_convertSpinner(e){const t=new at;return this._copyProperties(t,e),t.endTime=e.endTime,t}_copyProperties(e,t){var i,a,s;const o=t,l=t;e.startPosition=(i=o==null?void 0:o.startPosition)!==null&&i!==void 0?i:new Le(0,0),e.startTime=t.startTime,e.hitType=t.hitType,e.hitSound=t.hitSound,e.samples=t.samples,e.comboOffset=(a=l==null?void 0:l.comboOffset)!==null&&a!==void 0?a:0,e.isNewCombo=(s=l==null?void 0:l.isNewCombo)!==null&&s!==void 0?s:!1}createBeatmap(){return new Go}}class Pn extends Ns{postProcess(e){return super.postProcess(e),e.fileFormat>=6?this._applyStackingNew(e):this._applyStackingOld(e),e}_applyStackingNew(e){const t=e.hitObjects,i=e.general.stackLeniency,a=Pn.STACK_DISTANCE,s=0,o=t.length-1;let l=o;if(o<t.length-1)for(let p=o;p>=s;--p){let g=p;for(let h=g+1;h<t.length;++h){const w=t[g];if(w instanceof at)break;const d=t[h];if(d instanceof at)continue;const S=w.endTime||w.startTime,v=d.timePreempt*i;if(d.startTime-S>v)break;const y=w.startPosition.fdistance(d.startPosition)<a,b=w instanceof ht&&w.endPosition.fdistance(d.startPosition)<a;(y||b)&&(g=h,d.stackHeight=0)}if(g>l&&(l=g,l===t.length-1))break}let c=s;for(let p=l;p>s;--p){let g=p,h=t[p];if(h.stackHeight!==0||h instanceof at)continue;const w=h.timePreempt*i;if(h instanceof jr)for(;--g>=0;){const d=t[g];if(d instanceof at)continue;const S=d.endTime||d.startTime;if(h.startTime-S>w)break;g<c&&(d.stackHeight=0,c=g);const v=d.endPosition.fdistance(h.startPosition);if(d instanceof ht&&v<a){const y=h.stackHeight-d.stackHeight+1;for(let b=g+1;b<=p;++b){const M=t[b];d.endPosition.fdistance(M.startPosition)<a&&(M.stackHeight-=y)}break}d.startPosition.fdistance(h.startPosition)<a&&(d.stackHeight=h.stackHeight+1,h=d)}else if(h instanceof ht)for(;--g>=s;){const d=t[g];if(d instanceof at)continue;if(h.startTime-d.startTime>w)break;d.endPosition.fdistance(h.startPosition)<a&&(d.stackHeight=h.stackHeight+1,h=d)}}}_applyStackingOld(e){const t=e.hitObjects,i=e.general.stackLeniency,a=Pn.STACK_DISTANCE;for(let s=0,o=t.length;s<o;++s){const l=t[s];if(l.stackHeight!==0&&!(l instanceof ht))continue;let c=l.endTime||l.startTime,p=0;for(let g=s+1;g<o;++g){const h=t[s].timePreempt*i;if(t[g].startTime-h>c)break;const w=l.endPosition;t[g].startPosition.fdistance(l.startPosition)<a?(++l.stackHeight,c=t[g].endTime||t[g].startTime):t[g].startPosition.fdistance(w)<a&&(t[g].stackHeight-=++p,c=t[g].endTime||t[g].startTime)}}}}Pn.STACK_DISTANCE=3;class na extends js{constructor(){super(...arguments),this.aimDifficulty=0,this.speedDifficulty=0,this.speedNoteCount=0,this.flashlightDifficulty=0,this.sliderFactor=0,this.approachRate=0,this.overallDifficulty=0,this.drainRate=0,this.hitCircleCount=0,this.sliderCount=0,this.spinnerCount=0}}class ia extends Gs{constructor(e,t){super(e,t),this.aimPerformance=0,this.speedPerformance=0,this.accuracyPerformance=0,this.flashlightPerformance=0,this.effectiveMissCount=0,this.mods=e}}var Ot;class ln extends Ys{constructor(e,t,i,a,s,o){super(e,t,a,s,o),this.lazyJumpDistance=0,this.minimumJumpDistance=0,this.minimumJumpTime=0,this.travelDistance=0,this.travelTime=0,this.angle=null,this.hitWindowGreat=0,this.baseObject=e,this.lastObject=t,this._lastLastObject=i,this.strainTime=Math.max(this.deltaTime,Ot.MIN_DELTA_TIME),this.hitWindowGreat=this.baseObject instanceof ht&&this.baseObject.head?2*this.baseObject.head.hitWindows.windowFor(Ie.Great)/a:2*this.baseObject.hitWindows.windowFor(Ie.Great)/a,this._setDistances(a)}opacityAt(e,t){if(e>this.baseObject.startTime)return 0;const i=this.baseObject.startTime-this.baseObject.timePreempt,a=this.baseObject.timeFadeIn;if(t){const s=this.baseObject.startTime-this.baseObject.timePreempt+this.baseObject.timeFadeIn,o=this.baseObject.timePreempt*rr.FADE_OUT_DURATION_MULTIPLIER;return Math.min(Fr.clamp((e-i)/a,0,1),1-Fr.clamp((e-s)/o,0,1))}return Fr.clamp((e-i)/a,0,1)}_setDistances(e){var t,i;const a=this.baseObject,s=this.lastObject;if(a instanceof ht&&(this._computeSliderCursorPosition(a),this.travelDistance=Math.fround(Math.fround(a.lazyTravelDistance)*Math.fround(Math.pow(1+a.repeats/2.5,1/2.5))),this.travelTime=Math.max(a.lazyTravelTime/e,Ot.MIN_DELTA_TIME)),a instanceof at||s instanceof at)return;let o=Math.fround(Ot.NORMALIZED_RADIUS/Math.fround(a.radius));if(a.radius<30){const g=Math.fround(Math.min(Math.fround(30-Math.fround(a.radius)),5)/50);o=Math.fround(o*Math.fround(1+g))}const l=this._getEndCursorPosition(s),c=a.stackedStartPosition.fscale(o),p=l.fscale(o);if(this.lazyJumpDistance=c.fsubtract(p).flength(),this.minimumJumpTime=this.strainTime,this.minimumJumpDistance=this.lazyJumpDistance,s instanceof ht){const g=Math.max(s.lazyTravelTime/e,Ot.MIN_DELTA_TIME);this.minimumJumpTime=Math.max(this.strainTime-g,Ot.MIN_DELTA_TIME);const h=(i=(t=s.tail)===null||t===void 0?void 0:t.stackedStartPosition)!==null&&i!==void 0?i:s.stackedStartPosition,w=a.stackedStartPosition,d=Math.fround(h.fsubtract(w).flength()*o),S=Ot.MAXIMUM_SLIDER_RADIUS,v=Ot.ASSUMED_SLIDER_RADIUS;this.minimumJumpDistance=Fr.clamp(this.lazyJumpDistance-(S-v),0,Math.fround(d-S))}if(this._lastLastObject!==null&&!(this._lastLastObject instanceof at)){const h=this._getEndCursorPosition(this._lastLastObject).fsubtract(s.stackedStartPosition),w=a.stackedStartPosition.fsubtract(l),d=h.fdot(w),S=Math.fround(Math.fround(h.floatX*w.floatY)-Math.fround(h.floatY*w.floatX));this.angle=Math.abs(Math.atan2(S,d))}}_computeSliderCursorPosition(e){if(e.lazyEndPosition)return;const t=e.nestedHitObjects[e.nestedHitObjects.length-1];e.lazyTravelTime=t.startTime-e.startTime;let i=e.lazyTravelTime/e.spanDuration;i=i%2>=1?1-i%1:i%1;const a=e.path.positionAt(i);e.lazyEndPosition=e.stackedStartPosition.fadd(a);let s=e.stackedStartPosition;const o=Ot.NORMALIZED_RADIUS/e.radius;for(let l=1;l<e.nestedHitObjects.length;++l){const c=e.nestedHitObjects[l];let p=c.stackedStartPosition.fsubtract(s),g=o*p.flength(),h=Ot.ASSUMED_SLIDER_RADIUS;if(l===e.nestedHitObjects.length-1){const w=e.lazyEndPosition.fsubtract(s);w.flength()<p.flength()&&(p=w),g=o*p.flength()}else c instanceof zi&&(h=Ot.NORMALIZED_RADIUS);if(g>h){const w=Math.fround((g-h)/g);s=s.fadd(p.fscale(w)),g*=(g-h)/g,e.lazyTravelDistance=Math.fround(e.lazyTravelDistance+Math.fround(g))}l===e.nestedHitObjects.length-1&&(e.lazyEndPosition=s)}}_getEndCursorPosition(e){var t;return e instanceof ht?(this._computeSliderCursorPosition(e),(t=e.lazyEndPosition)!==null&&t!==void 0?t:e.stackedStartPosition):e.stackedStartPosition}}Ot=ln;ln.NORMALIZED_RADIUS=50;ln.MIN_DELTA_TIME=25;ln.MAXIMUM_SLIDER_RADIUS=Math.fround(Ot.NORMALIZED_RADIUS*Math.fround(2.4));ln.ASSUMED_SLIDER_RADIUS=Math.fround(Ot.NORMALIZED_RADIUS*Math.fround(1.8));class cn extends Sa{constructor(){super(...arguments),this._reducedSectionCount=10,this._reducedStrainBaseline=.75,this._difficultyMultiplier=cn.DEFAULT_DIFFICULTY_MULTIPLIER}get difficultyValue(){let e=0,t=1;const i=[...this.getCurrentStrainPeaks()].filter(o=>o>0).sort((o,l)=>l-o),a=(o,l,c)=>o+(l-o)*c,s=Math.min(i.length,this._reducedSectionCount);for(let o=0;o<s;++o){const l=Math.fround(o/this._reducedSectionCount),c=Fr.clamp01(l),p=Math.log10(a(1,10,c));i[o]*=a(this._reducedStrainBaseline,1,p)}return i.sort((o,l)=>l-o),i.forEach(o=>{e+=o*t,t*=this._decayWeight}),e*this._difficultyMultiplier}}cn.DEFAULT_DIFFICULTY_MULTIPLIER=1.06;class Mn{static evaluateDifficultyOf(e,t){var i;if(e.baseObject instanceof at||e.index<=1||((i=e.previous(0))===null||i===void 0?void 0:i.baseObject)instanceof at)return 0;const a=e,s=e.previous(0),o=e.previous(1);let l=a.lazyJumpDistance/a.strainTime;if(s.baseObject instanceof ht&&t){const L=s.travelDistance/s.travelTime,z=a.minimumJumpDistance/a.minimumJumpTime;l=Math.max(l,z+L)}let c=s.lazyJumpDistance/s.strainTime;if(o.baseObject instanceof ht&&t){const L=o.travelDistance/o.travelTime,z=s.minimumJumpDistance/s.minimumJumpTime;c=Math.max(c,z+L)}let p=0,g=0,h=0,w=0,d=l;const S=Math.max(a.strainTime,s.strainTime),v=Math.min(a.strainTime,s.strainTime);if(S<1.25*v&&a.angle!==null&&s.angle!==null&&o.angle!==null){const L=a.angle,z=s.angle,x=o.angle,W=Math.min(l,c);if(p=this._calcWideAngleBonus(L),g=this._calcAcuteAngleBonus(L),a.strainTime>100)g=0;else{g*=this._calcAcuteAngleBonus(z),g*=Math.min(W,125/a.strainTime);const G=Math.PI/2*Math.min(1,(100-a.strainTime)/25);g*=Math.pow(Math.sin(G),2);const ee=Math.min(Math.max(a.lazyJumpDistance,50),100),_e=Math.PI/2*(ee-50)/50;g*=Math.pow(Math.sin(_e),2)}const H=Math.pow(this._calcWideAngleBonus(z),3);p*=W*(1-Math.min(p,H));const K=Math.pow(this._calcAcuteAngleBonus(x),3);g*=.5+.5*(1-Math.min(g,K))}if(Math.max(c,l)!==0){c=(s.lazyJumpDistance+o.travelDistance)/s.strainTime,l=(a.lazyJumpDistance+s.travelDistance)/a.strainTime;const L=Math.abs(c-l),z=Math.max(c,l),x=Math.pow(Math.sin(Math.PI/2*L/z),2),W=Math.min(a.strainTime,s.strainTime),H=Math.abs(c-l);w=Math.min(125/W,H)*x;const G=Math.min(a.strainTime,s.strainTime),ee=Math.max(a.strainTime,s.strainTime);w*=Math.pow(G/ee,2)}s.baseObject instanceof ht&&(h=s.travelDistance/s.travelTime);const y=g*this.ACUTE_ANGLE_MULTIPLIER,b=p*this.WIDE_ANGLE_MULTIPLIER,M=w*this.VELOCITY_CHANGE_MULTIPLIER;return d+=Math.max(y,b+M),t&&(d+=h*this.SLIDER_MULTIPLIER),d}static _calcWideAngleBonus(e){const t=Math.min(.8333333333333334*Math.PI,Math.max(Math.PI/6,e)),i=3/4*(t-Math.PI/6);return Math.pow(Math.sin(i),2)}static _calcAcuteAngleBonus(e){return 1-this._calcWideAngleBonus(e)}}Mn.WIDE_ANGLE_MULTIPLIER=1.5;Mn.ACUTE_ANGLE_MULTIPLIER=1.95;Mn.SLIDER_MULTIPLIER=1.35;Mn.VELOCITY_CHANGE_MULTIPLIER=.75;class un{static evaluateDifficultyOf(e,t){if(e.baseObject instanceof at)return 0;const i=e,a=i.baseObject,s=52/a.radius;let o=1,l=0,c=0,p=0,g=i;for(let w=0;w<Math.min(e.index,10);w++){const d=e.previous(w),S=d.baseObject;if(!(d.baseObject instanceof at)){const v=a.stackedStartPosition.fsubtract(S.stackedEndPosition).flength();l+=g.strainTime,w===0&&(o=Math.min(1,v/75));const y=Math.min(1,d.lazyJumpDistance/s/25),b=i.opacityAt(S.startTime,t),M=1+this.MAX_OPACITY_BONUS*(1-b);c+=y*M*s*v/l,d.angle!==null&&i.angle!==null&&Math.abs(d.angle-i.angle)<.02&&(p+=Math.max(1-.1*w,0))}g=d}c=Math.pow(o*c,2),t&&(c*=1+this.HIDDEN_BONUS),c*=this.MIN_ANGLE_MULTIPLIER+(1-this.MIN_ANGLE_MULTIPLIER)/(p+1);let h=0;if(i.baseObject instanceof ht){const w=i.baseObject,d=w.lazyTravelDistance/s,S=Math.max(0,d/i.travelTime-this.MIN_VELOCITY);h=Math.pow(S,.5),h*=d,w.repeats>0&&(h/=w.repeats+1)}return c+=h*this.SLIDER_MULTIPLIER,c}}un.MAX_OPACITY_BONUS=.4;un.HIDDEN_BONUS=.2;un.MIN_VELOCITY=.5;un.SLIDER_MULTIPLIER=1.3;un.MIN_ANGLE_MULTIPLIER=.2;class Ui{static evaluateDifficultyOf(e){var t,i,a,s;if(e.baseObject instanceof at)return 0;let o=0,l=!1,c=0,p=0,g=0,h=1;const w=Math.min(e.index,32);for(;c<w-2&&e.startTime-((i=(t=e.previous(c))===null||t===void 0?void 0:t.startTime)!==null&&i!==void 0?i:0)<this.HISTORY_TIME_MAX;)c++;for(let d=c;d>0;--d){const S=e.previous(d-1),v=e.previous(d),y=e.previous(d+1);let b=(this.HISTORY_TIME_MAX-(e.startTime-S.startTime))/this.HISTORY_TIME_MAX;b=Math.min((w-d)/w,b);const M=S.strainTime,L=v.strainTime,z=y.strainTime,x=Math.min(L,M)/Math.max(L,M),W=1+6*Math.min(.5,Math.pow(Math.sin(Math.PI/x),2)),H=Math.max(0,Math.abs(L-M)-S.hitWindowGreat*.3);let K=Math.min(1,H/(S.hitWindowGreat*.3));K=Math.min(1,K);let G=K*W;if(l)if(!(L>1.25*M||L*1.25<M))h<7&&h++;else{((a=e.previous(d-1))===null||a===void 0?void 0:a.baseObject)instanceof ht&&(G*=.125),((s=e.previous(d))===null||s===void 0?void 0:s.baseObject)instanceof ht&&(G*=.25),p===h&&(G*=.25),p%2===h%2&&(G*=.5),z>L+10&&L>M+10&&(G*=.125);const ee=Math.sqrt(G*o),_e=Math.sqrt(4+h),B=Math.sqrt(4+p);g+=ee*b*_e/2*B/2,o=G,p=h,L*1.25<M&&(l=!1),h=1}else L>1.25*M&&(l=!0,o=G,h=1)}return Math.sqrt(4+g*this.RHYTHM_MULTIPLIER)/2}}Ui.HISTORY_TIME_MAX=5e3;Ui.RHYTHM_MULTIPLIER=.75;class ti{static evaluateDifficultyOf(e){var t;if(e.baseObject instanceof at)return 0;const i=e,a=e.index>0?e.previous(0):null,s=e.next(0);let o=i.strainTime,l=1;if(s!==null){const w=Math.max(1,i.deltaTime),d=Math.max(1,s.deltaTime),S=Math.abs(d-w),v=w/Math.max(w,S),y=Math.pow(Math.min(1,w/i.hitWindowGreat),2);l=Math.pow(v,1-y)}o/=Fr.clamp(o/i.hitWindowGreat/.93,.92,1);let c=1;o<this.MIN_SPEED_BONUS&&(c=1+.75*Math.pow((this.MIN_SPEED_BONUS-o)/this.SPEED_BALANCING_FACTOR,2));const p=(t=a==null?void 0:a.travelDistance)!==null&&t!==void 0?t:0,g=Math.min(this.SINGLE_SPACING_THRESHOLD,p+i.minimumJumpDistance),h=Math.pow(g/this.SINGLE_SPACING_THRESHOLD,3.5);return(c+c*h)*l/o}}ti.SINGLE_SPACING_THRESHOLD=125;ti.MIN_SPEED_BONUS=75;ti.SPEED_BALANCING_FACTOR=40;class Gr extends cn{constructor(e,t){super(e),this._currentStrain=0,this._withSliders=t}_strainDecay(e){return Math.pow(Gr.STRAIN_DECAY_BASE,e/1e3)}_calculateInitialStrain(e,t){var i,a;return this._currentStrain*this._strainDecay(e-((a=(i=t.previous(0))===null||i===void 0?void 0:i.startTime)!==null&&a!==void 0?a:0))}_strainValueAt(e){this._currentStrain*=this._strainDecay(e.deltaTime);const t=Mn.evaluateDifficultyOf(e,this._withSliders);return this._currentStrain+=t*Gr.SKILL_MULTIPLIER,this._currentStrain}}Gr.SKILL_MULTIPLIER=23.55;Gr.STRAIN_DECAY_BASE=.15;class an extends Sa{constructor(e){super(e),this._currentStrain=0,this._hasHiddenMod=e.any(rr)}_strainDecay(e){return Math.pow(an.STRAIN_DECAY_BASE,e/1e3)}_calculateInitialStrain(e,t){var i,a;return this._currentStrain*this._strainDecay(e-((a=(i=t.previous(0))===null||i===void 0?void 0:i.startTime)!==null&&a!==void 0?a:0))}_strainValueAt(e){this._currentStrain*=this._strainDecay(e.deltaTime);const t=un.evaluateDifficultyOf(e,this._hasHiddenMod);return this._currentStrain+=t*an.SKILL_MULTIPLIER,this._currentStrain}get difficultyValue(){return[...this.getCurrentStrainPeaks()].reduce((t,i)=>t+i)*cn.DEFAULT_DIFFICULTY_MULTIPLIER}}an.SKILL_MULTIPLIER=.052;an.STRAIN_DECAY_BASE=.15;class sn extends cn{constructor(){super(...arguments),this._currentStrain=0,this._currentRhythm=0,this._reducedSectionCount=5,this._difficultyMultiplier=1.04,this._objectStrains=[]}_strainDecay(e){return Math.pow(sn.STRAIN_DECAY_BASE,e/1e3)}_calculateInitialStrain(e,t){var i,a;const s=this._strainDecay(e-((a=(i=t.previous(0))===null||i===void 0?void 0:i.startTime)!==null&&a!==void 0?a:0));return this._currentStrain*this._currentRhythm*s}_strainValueAt(e){const t=e;this._currentStrain*=this._strainDecay(t.strainTime);const i=ti.evaluateDifficultyOf(e);this._currentStrain+=i*sn.SKILL_MULTIPLIER,this._currentRhythm=Ui.evaluateDifficultyOf(e);const a=this._currentStrain*this._currentRhythm;return this._objectStrains.push(a),a}relevantNoteCount(){if(this._objectStrains.length===0)return 0;const e=Math.max(...this._objectStrains);return e===0?0:this._objectStrains.reduce((t,i)=>t+1/(1+Math.exp(6-i/e*12)),0)}}sn.SKILL_MULTIPLIER=1375;sn.STRAIN_DECAY_BASE=.3;class Tn extends Ws{constructor(e,t,i){super(e,t,i),this._mods=new Kn,this._scoreMaxCombo=0,this._countGreat=0,this._countOk=0,this._countMeh=0,this._countMiss=0,this._accuracy=1,this._effectiveMissCount=0,this.attributes=t,this._addParams(t,i)}calculateAttributes(e,t){if(this._addParams(e,t),!this.attributes)return new ia(this._mods,0);let i=Tn.PERFORMANCE_BASE_MULTIPLIER;if(this._mods.any(Ea)&&(i*=Math.max(.9,1-.02*this._effectiveMissCount)),this._mods.any(za)&&this._totalHits>0&&(i*=1-Math.pow(this.attributes.spinnerCount/this._totalHits,.85)),this._mods.any(Jr)){const g=Math.max(0,this.attributes.overallDifficulty>0?1-Math.pow(this.attributes.overallDifficulty/13.33,1.8):1),h=Math.max(0,this.attributes.overallDifficulty>0?1-Math.pow(this.attributes.overallDifficulty/13.33,5):1),w=this._countOk*g,d=this._countMeh*h;this._effectiveMissCount=Math.min(this._effectiveMissCount+w+d,this._totalHits)}const a=this._computeAimValue(this.attributes),s=this._computeSpeedValue(this.attributes),o=this._computeAccuracyValue(this.attributes),l=this._computeFlashlightValue(this.attributes),c=Math.pow(Math.pow(a,1.1)+Math.pow(s,1.1)+Math.pow(o,1.1)+Math.pow(l,1.1),1/1.1)*i,p=new ia(this._mods,c);return p.aimPerformance=a,p.speedPerformance=s,p.accuracyPerformance=o,p.flashlightPerformance=l,p.effectiveMissCount=this._effectiveMissCount,p}_computeAimValue(e){const t=Math.max(1,e.aimDifficulty/.0675);let i=Math.pow(5*t-4,3)/1e5;const a=.95+.4*Math.min(1,this._totalHits/2e3)+(this._totalHits>2e3?Math.log10(this._totalHits/2e3)*.5:0);if(i*=a,this._effectiveMissCount>0){const l=Math.pow(this._effectiveMissCount/this._totalHits,.775);i*=.97*Math.pow(1-l,this._effectiveMissCount)}i*=this._getComboScalingFactor(e);let s=0;e.approachRate>10.33?s=.3*(e.approachRate-10.33):e.approachRate<8&&(s=.05*(8-e.approachRate)),this._mods.any(Jr)&&(s=0),i*=1+s*a,this._mods.any(rr)&&(i*=1+.04*(12-e.approachRate));const o=e.sliderCount*.15;if(e.sliderCount>0){const l=this._countOk+this._countMeh+this._countMiss,c=e.maxCombo-this._scoreMaxCombo,p=Math.min(l,c),g=Fr.clamp(p,0,o),h=Math.pow(1-g/o,3),w=(1-e.sliderFactor)*h+e.sliderFactor;i*=w}return i*=this._accuracy,i*=.98+Math.pow(e.overallDifficulty,2)/2500,i}_computeSpeedValue(e){if(this._mods.any(Jr))return 0;const t=Math.max(1,e.speedDifficulty/.0675);let i=Math.pow(5*t-4,3)/1e5;const a=.95+.4*Math.min(1,this._totalHits/2e3)+(this._totalHits>2e3?Math.log10(this._totalHits/2e3)*.5:0);if(i*=a,this._effectiveMissCount>0){const v=Math.pow(this._effectiveMissCount/this._totalHits,.775);i*=.97*Math.pow(1-v,Math.pow(this._effectiveMissCount,.875))}i*=this._getComboScalingFactor(e);let s=0;e.approachRate>10.33&&(s=.3*(e.approachRate-10.33)),i*=1+s*a,this._mods.any(rr)&&(i*=1+.04*(12-e.approachRate));const o=this._totalHits-e.speedNoteCount,l=Math.max(0,this._countGreat-o),c=Math.max(0,this._countOk-Math.max(0,o-this._countGreat)),p=Math.max(0,this._countMeh-Math.max(0,o-this._countGreat-this._countOk)),g=e.speedNoteCount!==0?(l*6+c*2+p)/(e.speedNoteCount*6):0,h=.95+Math.pow(e.overallDifficulty,2)/750,w=(this._accuracy+g)/2,d=(14.5-Math.max(e.overallDifficulty,8))/2;i*=h*Math.pow(w,d);const S=this._countMeh<this._totalHits/500?0:this._countMeh-this._totalHits/500;return i*=Math.pow(.99,S),i}_computeAccuracyValue(e){if(this._mods.any(Jr))return 0;let t=0;const i=e.hitCircleCount;i>0&&(t=(this._countGreat-(this._totalHits-i))*6+this._countOk*2+this._countMeh,t/=i*6),t=Math.max(0,t);let a=Math.pow(1.52163,e.overallDifficulty)*Math.pow(t,24)*2.83;return a*=Math.min(1.15,Math.pow(i/1e3,.3)),this._mods.any(rr)&&(a*=1.08),this._mods.any(yn)&&(a*=1.02),a}_computeFlashlightValue(e){if(!this._mods.any(yn))return 0;let t=Math.pow(e.flashlightDifficulty,2)*25;if(this._effectiveMissCount>0){const i=Math.pow(this._effectiveMissCount/this._totalHits,.775),a=Math.pow(this._effectiveMissCount,.875);t*=.97*Math.pow(1-i,a)}return t*=this._getComboScalingFactor(e),t*=.7+.1*Math.min(1,this._totalHits/200)+(this._totalHits>200?.2*Math.min(1,(this._totalHits-200)/200):0),t*=.5+this._accuracy/2,t*=.98+Math.pow(e.overallDifficulty,2)/2500,t}_calculateEffectiveMissCount(e){let t=0;if(e.sliderCount>0){const i=e.maxCombo-.1*e.sliderCount;this._scoreMaxCombo<i&&(t=i/Math.max(1,this._scoreMaxCombo))}return t=Math.min(t,this._countOk+this._countMeh+this._countMiss),Math.max(this._countMiss,t)}_addParams(e,t){var i,a,s,o,l,c,p;t&&(this._mods=(i=t==null?void 0:t.mods)!==null&&i!==void 0?i:new Kn,this._scoreMaxCombo=(a=t.maxCombo)!==null&&a!==void 0?a:this._scoreMaxCombo,this._countGreat=(s=t.statistics.get(Ie.Great))!==null&&s!==void 0?s:this._countGreat,this._countOk=(o=t.statistics.get(Ie.Ok))!==null&&o!==void 0?o:this._countOk,this._countMeh=(l=t.statistics.get(Ie.Meh))!==null&&l!==void 0?l:this._countMeh,this._countMiss=(c=t.statistics.get(Ie.Miss))!==null&&c!==void 0?c:this._countMiss,this._accuracy=(p=t.accuracy)!==null&&p!==void 0?p:this._accuracy),e&&(this.attributes=e,this._effectiveMissCount=this._calculateEffectiveMissCount(this.attributes))}_getComboScalingFactor(e){return e.maxCombo<=0?1:Math.min(Math.pow(this._scoreMaxCombo,.8)/Math.pow(e.maxCombo,.8),1)}get _totalHits(){return this._countGreat+this._countOk+this._countMeh+this._countMiss}}Tn.PERFORMANCE_BASE_MULTIPLIER=1.14;class Vo extends Vs{constructor(){super(...arguments),this._DIFFICULTY_MULTIPLIER=.0675}_createDifficultyAttributes(e,t,i,a){if(e.hitObjects.length===0)return new na(t,0);let s=Math.sqrt(i[0].difficultyValue)*this._DIFFICULTY_MULTIPLIER,o=Math.sqrt(i[2].difficultyValue)*this._DIFFICULTY_MULTIPLIER,l=Math.sqrt(i[3].difficultyValue)*this._DIFFICULTY_MULTIPLIER;const c=Math.sqrt(i[1].difficultyValue)*this._DIFFICULTY_MULTIPLIER,p=i[2].relevantNoteCount(),g=s>0?c/s:1;t.any(Da)&&(s=Math.pow(s,.8),l=Math.pow(l,.8)),t.any(Jr)&&(s*=.9,o=0,l*=.7);const h=Math.pow(5*Math.max(1,s/.0675)-4,3)/1e5,w=Math.pow(5*Math.max(1,o/.0675)-4,3)/1e5;let d=0;t.any(yn)&&(d=Math.pow(l,2)*25);const S=Math.pow(Math.pow(h,1.1)+Math.pow(w,1.1)+Math.pow(d,1.1),1/1.1),v=Tn.PERFORMANCE_BASE_MULTIPLIER,y=S>1e-5?Math.cbrt(v)*.027*(Math.cbrt(1e5/Math.pow(2,1/1.1)*S)+4):0,b=e.difficulty.approachRate,M=xt.map(b,1800,1200,450)/a,L=e.hitObjects.filter(ee=>ee instanceof jr),z=e.hitObjects.filter(ee=>ee instanceof ht),x=e.hitObjects.filter(ee=>ee instanceof at),W=z.reduce((ee,_e)=>ee+_e.nestedHitObjects.length,0),H=new nr;H.setDifficulty(e.difficulty.overallDifficulty);const K=H.windowFor(Ie.Great)/a,G=new na(t,y);return G.aimDifficulty=s,G.speedDifficulty=o,G.speedNoteCount=p,G.flashlightDifficulty=l,G.sliderFactor=g,G.hitCircleCount=L.length,G.sliderCount=z.length,G.spinnerCount=x.length,G.maxCombo=L.length+x.length+W,G.drainRate=e.difficulty.drainRate,G.overallDifficulty=(80-K)/6,G.approachRate=M>1200?(1800-M)/120:(1200-M)/150+5,G}_createDifficultyHitObjects(e,t){const i=[];for(let a=1;a<e.hitObjects.length;++a){const s=a>1?e.hitObjects[a-2]:null,o=e.hitObjects[a-1],l=e.hitObjects[a],c=new ln(l,o,s,t,i,i.length);i.push(c)}return i}_createSkills(e,t){return[new Gr(t,!0),new Gr(t,!1),new sn(t),new an(t)]}get difficultyMods(){return[new Fa,new Na,new Ia,new Ur,new yn]}}var br;(function(n){n[n.LeftButton=0]="LeftButton",n[n.RightButton=1]="RightButton",n[n.Smoke=2]="Smoke"})(br||(br={}));class aa extends Pa{constructor(){super(...arguments),this.position=new Le(0,0),this.actions=new Set}fromLegacy(e){return this.startTime=e.startTime,this.interval=e.interval,this.position=e.position,e.mouseLeft&&this.actions.add(br.LeftButton),e.mouseRight&&this.actions.add(br.RightButton),e.smoke&&this.actions.add(br.Smoke),this}toLegacy(){let e=jt.None;return this.actions.has(br.LeftButton)&&(e|=jt.Left1),this.actions.has(br.RightButton)&&(e|=jt.Right1),this.actions.has(br.Smoke)&&(e|=jt.Smoke),new ka(this.startTime,this.interval,this.position,e)}}class Wo extends lo{_createConvertibleReplayFrame(){return new aa}_isConvertedReplayFrame(e){return e instanceof aa}}class Yo extends co{get id(){return 0}applyToBeatmap(e){return super.applyToBeatmap(e)}applyToBeatmapWithMods(e,t){return super.applyToBeatmapWithMods(e,t)}resetMods(e){return super.resetMods(e)}createModCombination(e){return new Kn(e)}_createBeatmapProcessor(){return new Pn}_createBeatmapConverter(){return new Ho}_createReplayConverter(){return new Wo}createDifficultyCalculator(e){return new Vo(e,this)}createPerformanceCalculator(e,t){return new Tn(this,e,t)}}window.onload=async()=>{if(!window.top||window.top.location.origin!==window.location.origin)throw new Error("engine cannot be loaded here");const n=async()=>await Un.getItem("beatmapSets")??[],e=async a=>(await n()).find(s=>s.beatmapSetId===a),t=async a=>{const s=await n();if(await e(a.beatmapSetId))throw new Error("a beatmap set already exists with that id");s.push(a),Un.setItem("beatmapSets",s)},i={getBeatmapSets:async()=>await n(),uploadBeatmapSet:async({osz:a})=>{if(!a||!(a instanceof ArrayBuffer))throw new Error("osz must be an ArrayBuffer");if(a.byteLength>10*1024*1024)throw new Error("osz is too large");const s=new Xa,o=await s.loadAsync(a),l=Object.entries(o.files).filter(([S,v])=>S.endsWith(".osu")&&v._data.uncompressedSize<1*1024*1024);if(l.length===0)throw new Error("invalid number of maps in osz");const p=(await Promise.all(l.map(([S])=>s.file(S).async("uint8array")))).map(S=>({osu:S,map:new Ii().decodeFromBuffer(S)})).filter(S=>S.map.originalMode===0);if(p.length===0)throw new Error("only standard maps are supported :(");if(p.length>16)throw new Error("please be serious");if(!p[0].map.metadata.beatmapSetId)throw new Error("beatmap set id is missing");const h=await s.file(p[0].map.events.backgroundPath);if(!h||!h._data.uncompressedSize||h._data.uncompressedSize>4*1024*1024)throw new Error("invalid background image");const w=await h.async("uint8array"),d={backgroundPath:p[0].map.events.backgroundPath,background:w,artist:p[0].map.metadata.artist,beatmapSetId:p[0].map.metadata.beatmapSetId,creator:p[0].map.metadata.creator,title:p[0].map.metadata.title,maps:p.map(S=>({beatmapId:S.map.metadata.beatmapId,version:S.map.metadata.version,osu:S.osu}))};return await t(d),await n()},viewBeatmapSet:async({beatmapSetId:a})=>{if(!a||typeof a!="number")throw new Error("beatmapSetId must be a number");const s=await e(a);if(!s)throw new Error("could not find beatmap set with that id");return s.maps.map(o=>{const l=o.osu,c=new Ii().decodeFromBuffer(l),p=new Yo,g=p.applyToBeatmap(c),w=p.createDifficultyCalculator(g).calculate();w.circleSize=c.difficulty._CS,o.difficulty=w}),s},deleteBeatmapSet:async({beatmapSetId:a})=>{if(!a||typeof a!="number")throw new Error("beatmapSetId must be a number");const s=await n(),o=s.findIndex(l=>l.beatmapSetId===a);if(o===-1)throw new Error("could not find beatmap set with that id");return s.splice(o,1),await Un.setItem("beatmapSets",s),!0},search:async({query:a})=>{if(!a||typeof a!="string")throw new Error("query must be a string");return(await n()).filter(o=>{const l=a.toLowerCase();return!!(o.artist.toLowerCase().includes(l)||o.creator.toLowerCase().includes(l)||o.title.toLowerCase().includes(l)||o.maps.some(c=>c.version.toLowerCase().includes(l)))})},clear:async()=>(await Un.clear(),!0)};window.onmessage=async a=>{const{type:s}=a.data;if(!s||typeof s!="string")return;if(s==="ping"){window.top.postMessage({type:"ready"},window.location.origin);return}const o=i[s];if(o)try{const l=await o(a.data);window.top.postMessage({type:s,result:l},window.location.origin)}catch(l){window.top.postMessage({type:s,error:l.message},window.location.origin)}}};
//# sourceMappingURL=engine.js.map
