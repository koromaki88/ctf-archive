/* =========================================================
   Senmonten — Realistic 2D Shop Scene + Festival Runner
   Pure CSS (no JS). Vivid colors, smooth animation.
   ========================================================= */

/* ---------- Palette ---------- */
:root{
  --ink:#10131f;         /* deep night */
  --indigo:#1e3a8a;      /* rich indigo */
  --lapis:#2b6dd8;       /* bright indigo */
  --verm:#d7372f;        /* vermilion */
  --gold:#f6c445;        /* festival gold */
  --yuzu:#f4b400;        /* saffron */
  --pine:#166b57;        /* pine green */
  --paper:#fff7eb;       /* warm card */
  --paper-2:#fffbf5;     /* lighter */
  --wall-1:#f7e1c6;      /* wall top */
  --wall-2:#f1cda4;      /* wall mid */
  --wall-3:#e7b988;      /* wall base */
  --wood-l:#e2b784;      /* shelf light */
  --wood:#c28a57;        /* shelf mid */
  --wood-d:#99673a;      /* shelf dark */
  --plank-1:#b48760;     /* floor plank light */
  --plank-2:#9b6f4b;     /* floor plank dark */
  --stone:rgba(0,0,0,.14);
  --radius:16px;
  --radius-sm:12px;
  --shadow:0 16px 34px rgba(0,0,0,.18);
  --maxw:1200px;
  --noren-h:88px;        /* banner height controlling header offset */
}

/* ---------- Base ---------- */
*{box-sizing:border-box}
html,body{height:100%}
html{color-scheme:light}
body{
  margin:0;
  font-family:"Noto Sans JP", system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
  color:#1f1c1b;
  background: linear-gradient(180deg, #fffaf2, #ffe9cf 60%, #ffdbb3);
  line-height:1.55;
  overflow-x:hidden;
}

/* Raise content above background layers */
.header, .container, .footer{ position:relative; z-index:8 }

/* ---------- Scene (fixed) ---------- */
.scene{
  position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden;
  background:
    radial-gradient(1400px 600px at 50% -8%, rgba(255,255,255,.6), rgba(255,255,255,0) 70%),
    linear-gradient(180deg, var(--wall-1), var(--wall-2) 45%, var(--wall-3));
}

/* Ceiling beams to ground the top */
.ceiling{
  position:absolute; left:0; right:0; top:0; height:46px;
  background:
    linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,0)),
    repeating-linear-gradient(
      to right,
      #7b5634 0 24px, #8a6039 24px 48px
    );
  filter: saturate(1.1);
  box-shadow: 0 10px 16px rgba(0,0,0,.18);
}

/* Multi-panel noren banner (does not push content; header sits below via margin) */
.noren{
  position:absolute; left:0; right:0; top:0; height:var(--noren-h);
  background:
    linear-gradient(180deg, rgba(0,0,0,.16), rgba(0,0,0,0)),
    repeating-linear-gradient(
      to right,
      #15306d 0 140px, #d83d35 140px 280px, #f3b323 280px 420px, #137b62 420px 560px, #203f8d 560px 700px
    );
  transform-origin: top center;
  animation: noren-sway 7s ease-in-out infinite alternate;
  box-shadow: 0 14px 22px rgba(0,0,0,.22);
}
.noren::after{
  content:"";
  position:absolute; left:0; right:0; bottom:-10px; height:10px;
  background: repeating-linear-gradient(to right, rgba(0,0,0,.22) 0 2px, transparent 2px 20px);
  opacity:.3;
}

/* Shelves grid — realistic wood with cavity and lip */
.shelves{
  position:absolute; left:50%; top:calc(var(--noren-h) + 6vh);
  width:min(1400px, 96vw);
  transform:translateX(-50%);
  display:grid; gap:4vh; padding:0 2vw; z-index:1;
}
.shelf-row{ display:grid; grid-template-columns:repeat(5, 1fr); gap:2vw }
.shelf{
  position:relative; height:18vh; min-height:140px; border-radius:12px;
  background:
    /* colorful object silhouettes */
    radial-gradient(closest-side, rgba(242,127,177,.3), transparent 65%) 14% 44%/64px 64px no-repeat,
    radial-gradient(closest-side, rgba(248,191,44,.3), transparent 65%) 40% 38%/70px 70px no-repeat,
    radial-gradient(closest-side, rgba(27,154,107,.3), transparent 65%) 66% 46%/58px 58px no-repeat,
    radial-gradient(closest-side, rgba(43,109,216,.3), transparent 65%) 82% 52%/54px 54px no-repeat,
    /* plank base */
    linear-gradient(180deg, var(--wood-l), var(--wood) 55%, var(--wood-d));
  border:1px solid rgba(0,0,0,.08);
  box-shadow: inset 0 -12px 16px rgba(0,0,0,.1), inset 0 10px 12px rgba(255,255,255,.55), 0 12px 20px rgba(0,0,0,.08);
  overflow:hidden;
}
.shelf::after{
  /* cavity panel */
  content:"";
  position:absolute; inset:10px 10px 28px 10px; border-radius:10px;
  background:
    linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.18)),
    repeating-linear-gradient(to right, rgba(0,0,0,.06) 0 2px, transparent 2px 16px);
  filter: blur(.25px);
}
.shelf::before{
  /* front lip */
  content:"";
  position:absolute; left:0; right:0; bottom:0; height:26px;
  background: linear-gradient(180deg, #e6b985, #c58f58 70%, #9d6f3f);
  box-shadow: 0 4px 8px rgba(0,0,0,.14);
  border-bottom-left-radius:12px; border-bottom-right-radius:12px;
}

/* Festival aisle runner (carpet) with gold edges & weave, in perspective */
.aisle-runner{
  position:absolute; left:50%; transform:translateX(-50%) perspective(1300px) rotateX(18deg);
  width:min(820px, 80vw); height:58vh; bottom:12vh;
  background:
    linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,0)),
    repeating-linear-gradient(90deg, rgba(255,255,255,.06) 0 2px, rgba(255,255,255,0) 2px 6px),
    linear-gradient(180deg, #e84a3f, #c22e27);
  border-left: 8px solid var(--gold);
  border-right: 8px solid var(--gold);
  border-radius:18px;
  box-shadow:
    0 30px 40px rgba(0,0,0,.22),
    inset 0 10px 18px rgba(255,255,255,.18);
  animation: runner-shimmer 9s ease-in-out infinite;
}

/* Floor planks beneath */
.floor{
  position:absolute; left:0; right:0; bottom:0; height:22vh;
  background:
    linear-gradient(0deg, rgba(0,0,0,.12), rgba(0,0,0,0)),
    repeating-linear-gradient(
      -8deg,
      var(--plank-1) 0 20px,
      var(--plank-2) 20px 40px
    );
  transform-origin:center bottom;
  transform:perspective(1200px) rotateX(12deg);
  box-shadow: inset 0 22px 28px rgba(0,0,0,.14);
}

/* Lanterns with glow + sway */
.lantern{
  position:absolute; top:calc(var(--noren-h) - 10px); width:74px; height:112px;
  background:url("/images/lantern.svg") center/contain no-repeat;
  transform-origin:50% -14px;
  animation: lantern-sway 6s ease-in-out infinite alternate;
  filter: drop-shadow(0 12px 14px rgba(0,0,0,.22));
}
.lantern::after{
  content:""; position:absolute; inset:-22% -20% -12% -20%;
  background: radial-gradient(60% 60% at 50% 45%, rgba(255,209,102,.55), rgba(255,140,66,.18), transparent 70%);
  z-index:-1; animation: glow 2.8s ease-in-out infinite alternate;
}
.lantern::before{
  content:""; position:absolute; left:50%; top:-18px; width:2px; height:18px; transform:translateX(-50%);
  background: linear-gradient(180deg, rgba(60,60,60,.7), rgba(60,60,60,.2)); border-radius:2px;
}
.lantern.l-left{ left:calc(50% - 540px); animation-duration:6.6s }
.lantern.l-right{ right:calc(50% - 540px); animation-duration:5.9s; animation-delay:.35s }

/* Dust motes for life */
.dust{ position:absolute; inset:0; overflow:hidden }
.speck{
  position:absolute; top:-8vh; width:6px; height:6px; border-radius:50%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.9), rgba(255,255,255,.2));
  filter: blur(.3px);
  animation: mote 18s linear infinite;
  opacity:.45;
}
.speck:nth-child(odd){ width:4px; height:4px; opacity:.35 }
.speck:nth-child(1){ left:6%;  animation-delay:.2s }
.speck:nth-child(2){ left:12%; animation-delay:1.3s }
.speck:nth-child(3){ left:18%; animation-delay:.8s }
.speck:nth-child(4){ left:26%; animation-delay:1.6s }
.speck:nth-child(5){ left:34%; animation-delay:.4s }
.speck:nth-child(6){ left:42%; animation-delay:1.1s }
.speck:nth-child(7){ left:51%; animation-delay:.9s }
.speck:nth-child(8){ left:60%; animation-delay:1.8s }
.speck:nth-child(9){ left:68%; animation-delay:.6s }
.speck:nth-child(10){ left:76%; animation-delay:1.4s }
.speck:nth-child(11){ left:84%; animation-delay:.3s }
.speck:nth-child(12){ left:92%; animation-delay:1.0s }
.speck:nth-child(13){ left:20%; animation-delay:2.0s }
.speck:nth-child(14){ left:70%; animation-delay:2.6s }
.speck:nth-child(15){ left:38%; animation-delay:3.1s }
.speck:nth-child(16){ left:58%; animation-delay:3.6s }
.speck:nth-child(17){ left:8%;  animation-delay:4.1s }
.speck:nth-child(18){ left:88%; animation-delay:4.6s }

/* ---------- HUD & Menu (unchanged behavior, stronger look) ---------- */
.hud{ position:fixed; top:12px; right:14px; z-index:6; display:flex; gap:10px }
.hud-btn{
  display:inline-block; padding:9px 16px; border-radius:999px;
  color:#fff; font-weight:800; text-decoration:none; letter-spacing:.02em;
  background: linear-gradient(180deg, var(--indigo), #132a7e);
  border:1px solid rgba(255,255,255,.25);
  box-shadow: 0 10px 18px rgba(33,59,154,.25);
  transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
}
.hud-btn:hover{ transform: translateY(-1px); filter: brightness(1.05); box-shadow: 0 16px 26px rgba(33,59,154,.35) }
.hud-btn:active{ transform: translateY(0) scale(.98) }

.menu-overlay{ position:fixed; inset:0; z-index:10; pointer-events:none; opacity:0; transition:opacity .25s ease }
.menu-overlay:target{ opacity:1; pointer-events:auto }
.menu-backdrop{
  position:absolute; inset:0;
  background: radial-gradient(1200px 600px at 50% -10%, rgba(255,223,154,.35), rgba(0,0,0,.45));
  backdrop-filter: blur(8px) saturate(125%);
}
.menu-panel{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  width:min(560px, 92vw);
  background:
    linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.84)),
    radial-gradient(120% 80% at 50% 0%, rgba(255,184,0,.15), rgba(255,255,255,0));
  border:1px solid rgba(255,255,255,.55);
  border-radius:18px;
  box-shadow: 0 30px 60px rgba(10,18,38,.45), inset 0 1px 0 rgba(255,255,255,.8);
  padding:22px;
}
.menu-title{ margin:0 0 12px 0; font-family:"Noto Serif JP", serif; letter-spacing:.06em; color:var(--indigo) }
.menu-list{ list-style:none; margin:0; padding:6px 0; display:flex; flex-direction:column; gap:10px }
.menu-link{
  display:flex; align-items:center; justify-content:space-between;
  text-decoration:none; color:#1a1a1a; font-weight:800;
  padding:14px 16px; border-radius:14px;
  border:1px solid rgba(0,0,0,.06);
  background: linear-gradient(180deg, #ffffff, #fff7eb);
  box-shadow: 0 8px 18px rgba(0,0,0,.08);
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease, background .12s ease;
}
.menu-link::after{ content:"›"; font-size:18px; color:var(--verm) }
.menu-link:hover, .menu-link:focus-visible{
  outline:none; transform: translateY(-1px);
  border-color: rgba(215,55,47,.35);
  background: linear-gradient(180deg, #fffdf8, #ffe4c8);
  box-shadow: 0 14px 28px rgba(215,55,47,.22);
}
.menu-hint{ margin:10px 2px 0 2px; font-size:.92rem; opacity:.8 }

/* ---------- Header: align with scene ---------- */
.header{
  max-width:var(--maxw); margin:calc(var(--noren-h) + 6px) auto 0; padding:12px 16px 0;
  position:relative;
}
.logo{ font-family:"Noto Serif JP", serif; letter-spacing:.06em; margin:0 0 2px 0; color:var(--verm) }
.subtitle{ font-size:.95rem; opacity:.85; color:#5b4a3c }

/* ---------- App Content ---------- */
.container{
  max-width:var(--maxw); margin:16px auto 46px; padding:16px;
  display:grid; grid-template-columns: 2fr 1fr; gap:32px;
}
@media (max-width: 960px){ .container{ grid-template-columns:1fr } }
.gallery{ min-width:0 }

/* Cards */
.grid-2{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:24px }
.card{
  background:var(--paper);
  border:1px solid rgba(0,0,0,.08);
  border-radius:var(--radius);
  box-shadow: var(--shadow);
  overflow:hidden;
  transition:transform .15s ease, box-shadow .15s ease, border-color .2s ease, filter .15s ease;
}
.card:hover{ transform:translateY(-3px); box-shadow:0 18px 34px rgba(0,0,0,.2); filter: saturate(1.06) }
.imgwrap{ background:var(--paper-2); aspect-ratio:4/3; display:flex; align-items:center; justify-content:center; border-bottom:1px solid rgba(0,0,0,.08) }
.imgwrap img{ max-width:100%; max-height:100%; display:block }
.card-body{ padding:16px }
.item-name{ font-family:"Noto Serif JP", serif; font-size:1.18rem; margin:0 0 6px 0; color:#2d2a29 }
.price{ margin:0 0 12px 0; font-weight:800; color:var(--indigo) }

/* Forms & Buttons */
.form-inline{ display:flex; gap:10px; align-items:center }
.qty, .qty-small{
  width:78px; padding:8px 10px; border:1px solid rgba(0,0,0,.12); background:#fff; border-radius:10px; font:inherit
}
.qty-small{ width:66px; padding:6px 8px }
.btn{
  appearance:none; border:1px solid transparent; background:linear-gradient(180deg, var(--indigo), #1b2e83); color:#fff;
  padding:8px 14px; border-radius:999px; font-weight:800; cursor:pointer;
  box-shadow: 0 10px 18px rgba(33,59,154,.25);
  transition:transform .15s ease, box-shadow .15s ease, filter .15s ease;
}
.btn:hover{ transform:translateY(-1px); filter:brightness(1.05); box-shadow: 0 16px 28px rgba(33,59,154,.35) }
.btn.btn-update{ background:linear-gradient(180deg, #444, #2b2b2b) }
.btn.btn-update:hover{ box-shadow:0 16px 28px rgba(0,0,0,.3) }
.btn.btn-add .plus{ font-weight:900; margin-right:6px }

/* Sidebar (Kakejiku) */
.sidebar{
  background: linear-gradient(180deg, #fff6e7, #ffecd3);
  border:1px solid rgba(0,0,0,.08);
  border-radius:var(--radius);
  padding:16px;
  position:sticky; top:16px;
  box-shadow: var(--shadow);
}
.track-head{ font-family:"Noto Serif JP", serif; margin:4px 0 12px; color:#5b4332 }
.track{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px }
.track-row{
  background:#fff; border:1px solid rgba(0,0,0,.08); border-radius:var(--radius-sm); padding:10px 10px 8px 12px;
  box-shadow: 0 8px 14px rgba(0,0,0,.08);
}
.row-main{ display:flex; align-items:center; gap:8px; justify-content:space-between }
.row-main .name{ font-weight:800; color:#2b2b2b }
.remove-form{ margin:0 }
.remove-btn{
  appearance:none; border:none; background:transparent; color:var(--verm);
  font-size:18px; line-height:1; cursor:pointer; padding:6px 8px; border-radius:8px; transition:background .15s ease, transform .12s ease
}
.remove-btn:hover{ background:rgba(215,55,47,.1); transform: translateY(-1px) }
.row-sub{ margin-top:8px; display:flex; align-items:center; justify-content:space-between; gap:10px }
.lineprice{ font-weight:800; color:var(--indigo) }
.sep{ border:0; border-top:1px solid rgba(0,0,0,.12); margin:14px 0 8px }
.total-row{ display:flex; justify-content:space-between; align-items:center }
.total-label{ font-family:"Noto Serif JP", serif; letter-spacing:.08em; color:#4a3a2d }
.total-amount{ color:var(--verm); font-size:1.2rem; text-shadow: 0 1px 0 rgba(255,255,255,.7) }

/* Accessibility helpers */
.sr-only{
  position:absolute!important; height:1px;width:1px;overflow:hidden;
  clip:rect(1px,1px,1px,1px); white-space:nowrap; border:0; padding:0; margin:-1px;
}

/* Calm :target feedback */
[id^="added-"]:target, [id^="cart-item-"]:target{
  outline:2px solid var(--lapis); outline-offset:2px; animation: fadePulse 1.1s ease 1;
}

/* Footer */
.footer{ max-width:var(--maxw); margin:24px auto 40px; padding:0 16px; opacity:.9; font-size:.95rem; color:#5b4a3c }

/* ---------- Keyframes ---------- */
@keyframes fadePulse{
  0%{ box-shadow:0 0 0 0 rgba(43,109,216,.32) }
  60%{ box-shadow:0 0 0 10px rgba(43,109,216,0) }
  100%{ box-shadow:none }
}
@keyframes lantern-sway{ 0%{ transform: rotate(-3deg) } 100%{ transform: rotate(3deg) } }
@keyframes glow{ 0%{ opacity:.55 } 100%{ opacity:.9 } }
@keyframes noren-sway{ 0%{ transform: rotate(-0.7deg) } 100%{ transform: rotate(0.7deg) } }
@keyframes mote{
  0%{ transform: translateY(-8vh) translateX(0); opacity:.0 }
  10%{ opacity:.45 }
  100%{ transform: translateY(120vh) translateX(10vw); opacity:.0 }
}
@keyframes runner-shimmer{
  0%{ filter: saturate(1) brightness(1) }
  50%{ filter: saturate(1.08) brightness(1.05) }
  100%{ filter: saturate(1) brightness(1) }
}

/* Motion preferences */
@media (prefers-reduced-motion: reduce){
  .noren, .lantern, .lantern::after, .speck, .aisle-runner{ animation:none !important }
}


/* --- Buy button (full-width, festival vibe) --- */
.btn.btn-buy{
  width:100%;
  background: linear-gradient(180deg, #d83d35, #b92b25);
  color:#fff;
  border:1px solid rgba(255,255,255,.22);
  box-shadow: 0 12px 24px rgba(216,61,53,.28);
  margin-top:12px;
}
.btn.btn-buy:hover{
  transform: translateY(-1px);
  filter: brightness(1.05);
  box-shadow: 0 16px 28px rgba(216,61,53,.38);
}

/* --- Purchase success toast (no JS; shown via #purchased) --- */
a#purchased{ position:absolute; inset:auto } /* invisible anchor */
.toast{
  position:fixed; top:12px; left:50%;
  transform: translate(-50%, -10px);
  background: linear-gradient(180deg, #ffffff, #fff6e0);
  border:1px solid rgba(0,0,0,.12);
  border-radius:999px;
  padding:10px 16px;
  box-shadow: 0 14px 28px rgba(0,0,0,.18);
  z-index:20;
  opacity:0; pointer-events:none;
  transition: opacity .2s ease, transform .2s ease;
  font-weight:700; color:#2b2b2b;
}
.toast-success{ border-color: rgba(34,197,94,.35) }
#purchased:target + .toast{
  opacity:1;
  transform: translate(-50%, 0);
}
